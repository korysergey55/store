/*! For license information please see 692.368c4a27.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkstore=self.webpackChunkstore||[]).push([[692],{3397:(e,t,n)=>{n.d(t,{$:()=>it,A:()=>u,G:()=>h,K:()=>xe,L:()=>Me,N:()=>Ge,P:()=>Bn,R:()=>xn,U:()=>ae,V:()=>Ye,W:()=>Ze,X:()=>et,Y:()=>tt,Z:()=>$e,_:()=>rt,a:()=>cn,a0:()=>ct,a1:()=>yt,a2:()=>vt,a3:()=>wt,a4:()=>_t,a5:()=>At,a6:()=>Ct,a7:()=>kt,a8:()=>Nt,a9:()=>Dt,aA:()=>we,aB:()=>y,aC:()=>b,aD:()=>dr,aE:()=>se,aF:()=>ce,aG:()=>lr,aH:()=>rr,aI:()=>nr,aJ:()=>Se,aN:()=>ln,aQ:()=>nt,aa:()=>Rt,ab:()=>Pt,ac:()=>xt,ad:()=>Ot,ae:()=>Lt,af:()=>Mt,ag:()=>Ft,ah:()=>Vt,ak:()=>Ut,al:()=>Bt,am:()=>qt,ap:()=>dt,aq:()=>Yt,as:()=>$t,at:()=>tn,au:()=>E,av:()=>ve,aw:()=>ge,ax:()=>m,ay:()=>Mr,az:()=>gr,b:()=>on,c:()=>Qn,d:()=>Jn,e:()=>Yn,f:()=>or,g:()=>cr,h:()=>ar,i:()=>Tn,j:()=>ur,k:()=>Vr,l:()=>Mn,m:()=>qr,p:()=>c,r:()=>Fn,s:()=>Ln,u:()=>Un});var r=n(7150),i=n(7700),s=n(443),o=n(6326),a=n(8812);const c={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},u={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};function l(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const h=function(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}},d=l,f=new i.FA("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),p=new s.Vy("@firebase/auth");function g(e){if(p.logLevel<=s.$b.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];p.error("Auth (".concat(r.SDK_VERSION,"): ").concat(e),...n)}}function m(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];throw I(e,...n)}function y(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return I(e,...n)}function v(e,t,n){const r=Object.assign(Object.assign({},d()),{[t]:n});return new i.FA("auth","Firebase",r).create(t,{appName:e.name})}function w(e){return v(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function _(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&m(e,"argument-error"),v(e,"argument-error","Type of ".concat(t.constructor.name," does not match expected instance.")+"Did you pass a reference from a different Auth SDK?")}function I(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if("string"!==typeof e){const t=n[0],r=[...n.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(t,...r)}return f.create(e,...n)}function b(e,t){if(!e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];throw I(t,...r)}}function T(e){const t="INTERNAL ASSERTION FAILED: "+e;throw g(t),new Error(t)}function E(e,t){e||T(t)}function S(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function A(){return"http:"===C()||"https:"===C()}function C(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class k{constructor(e,t){this.shortDelay=e,this.longDelay=t,E(t>e,"Short delay should be less than long delay!"),this.isMobile=(0,i.jZ)()||(0,i.lV)()}get(){return"undefined"!==typeof navigator&&navigator&&"onLine"in navigator&&"boolean"===typeof navigator.onLine&&(A()||(0,i.sr)()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function N(e,t){E(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?"".concat(n).concat(t.startsWith("/")?t.slice(1):t):n}class D{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!==typeof self&&"fetch"in self?self.fetch:"undefined"!==typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!==typeof fetch?fetch:void T("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!==typeof self&&"Headers"in self?self.Headers:"undefined"!==typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!==typeof Headers?Headers:void T("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!==typeof self&&"Response"in self?self.Response:"undefined"!==typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!==typeof Response?Response:void T("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const R={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},P=new k(3e4,6e4);function x(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function O(e,t,n,r){return L(e,arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},(async()=>{let s={},o={};r&&("GET"===t?o=r:s={body:JSON.stringify(r)});const a=(0,i.Am)(Object.assign({key:e.config.apiKey},o)).slice(1),c=await e._getAdditionalHeaders();return c["Content-Type"]="application/json",e.languageCode&&(c["X-Firebase-Locale"]=e.languageCode),D.fetch()(F(e,e.config.apiHost,n,a),Object.assign({method:t,headers:c,referrerPolicy:"no-referrer"},s))}))}async function L(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},R),t);try{const t=new U(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw B(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw B(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw B(e,"email-already-in-use",s);if("USER_DISABLED"===n)throw B(e,"user-disabled",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw v(e,a,o);m(e,a)}}catch(s){if(s instanceof i.g)throw s;m(e,"network-request-failed",{message:String(s)})}}async function M(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const s=await O(e,t,n,r,i);return"mfaPendingCredential"in s&&m(e,"multi-factor-auth-required",{_serverResponse:s}),s}function F(e,t,n,r){const i="".concat(t).concat(n,"?").concat(r);return e.config.emulator?N(e.config,i):"".concat(e.config.apiScheme,"://").concat(i)}function V(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class U{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(y(this.auth,"network-request-failed"))),P.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function B(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=y(e,t,r);return i.customData._tokenResponse=n,i}function q(e){return void 0!==e&&void 0!==e.getResponse}function j(e){return void 0!==e&&void 0!==e.enterprise}class z{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return V(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}}async function K(e,t){return O(e,"GET","/v2/recaptchaConfig",x(e,t))}async function G(e,t){return O(e,"POST","/v1/accounts:lookup",t)}function W(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(t){}}function H(e){return 1e3*Number(e)}function Q(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return g("JWT malformed, contained fewer than 3 sections"),null;try{const e=(0,i.u)(n);return e?JSON.parse(e):(g("Failed to decode base64 JWT payload"),null)}catch(s){return g("Caught error parsing JWT payload as JSON",null===s||void 0===s?void 0:s.toString()),null}}function Y(e){const t=Q(e);return b(t,"internal-error"),b("undefined"!==typeof t.exp,"internal-error"),b("undefined"!==typeof t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function J(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2])return t;try{return await t}catch(n){throw n instanceof i.g&&function(e){let{code:t}=e;return t==="auth/".concat("user-disabled")||t==="auth/".concat("user-token-expired")}(n)&&e.auth.currentUser===e&&await e.auth.signOut(),n}}class X{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void((null===e||void 0===e?void 0:e.code)==="auth/".concat("network-request-failed")&&this.schedule(!0))}this.schedule()}}class ${constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=W(this.lastLoginAt),this.creationTime=W(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Z(e){var t;const n=e.auth,r=await e.getIdToken(),i=await J(e,G(n,{idToken:r}));b(null===i||void 0===i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?ee(s.providerUserInfo):[],a=(c=e.providerData,u=o,[...c.filter((e=>!u.some((t=>t.providerId===e.providerId)))),...u]);var c,u;const l=e.isAnonymous,h=!(e.email&&s.passwordHash)&&!(null===a||void 0===a?void 0:a.length),d=!!l&&h,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new $(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(e,f)}function ee(e){return e.map((e=>{var{providerId:t}=e,n=(0,o.Tt)(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}}))}class te{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){b(e.idToken,"internal-error"),b("undefined"!==typeof e.idToken,"internal-error"),b("undefined"!==typeof e.refreshToken,"internal-error");const t="expiresIn"in e&&"undefined"!==typeof e.expiresIn?Number(e.expiresIn):Y(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){b(0!==e.length,"internal-error");const t=Y(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]||!this.accessToken||this.isExpired?(b(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:s}=await async function(e,t){const n=await L(e,{},(async()=>{const n=(0,i.Am)({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:s}=e.config,o=F(e,r,"/v1/token","key=".concat(s)),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",D.fetch()(o,{method:"POST",headers:a,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(s))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new te;return n&&(b("string"===typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(b("string"===typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(b("number"===typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new te,this.toJSON())}_performRefresh(){return T("not implemented")}}function ne(e,t){b("string"===typeof e||"undefined"===typeof e,"internal-error",{appName:t})}class re{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=(0,o.Tt)(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new X(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new $(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await J(this,this.stsTokenManager.getToken(this.auth,e));return b(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=(0,i.Ku)(e),r=await n.getIdToken(t),s=Q(r);b(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const o="object"===typeof s.firebase?s.firebase:void 0,a=null===o||void 0===o?void 0:o.sign_in_provider;return{claims:s,token:r,authTime:W(H(s.auth_time)),issuedAtTime:W(H(s.iat)),expirationTime:W(H(s.exp)),signInProvider:a||null,signInSecondFactor:(null===o||void 0===o?void 0:o.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=(0,i.Ku)(e);await Z(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(b(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new re(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){b(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await Z(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if((0,r._isFirebaseServerApp)(this.auth.app))return Promise.reject(w(this.auth));const e=await this.getIdToken();return await J(this,async function(e,t){return O(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,c,u;const l=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,f=null!==(s=t.photoURL)&&void 0!==s?s:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,g=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,m=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:v,emailVerified:w,isAnonymous:_,providerData:I,stsTokenManager:T}=t;b(v&&T,e,"internal-error");const E=te.fromJSON(this.name,T);b("string"===typeof v,e,"internal-error"),ne(l,e.name),ne(h,e.name),b("boolean"===typeof w,e,"internal-error"),b("boolean"===typeof _,e,"internal-error"),ne(d,e.name),ne(f,e.name),ne(p,e.name),ne(g,e.name),ne(m,e.name),ne(y,e.name);const S=new re({uid:v,auth:e,email:h,emailVerified:w,displayName:l,isAnonymous:_,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:E,createdAt:m,lastLoginAt:y});return I&&Array.isArray(I)&&(S.providerData=I.map((e=>Object.assign({},e)))),g&&(S._redirectEventId=g),S}static async _fromIdTokenResponse(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=new te;r.updateFromServerResponse(t);const i=new re({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await Z(i),i}static async _fromGetAccountInfoResponse(e,t,n){const r=t.users[0];b(void 0!==r.localId,"internal-error");const i=void 0!==r.providerUserInfo?ee(r.providerUserInfo):[],s=!(r.email&&r.passwordHash)&&!(null===i||void 0===i?void 0:i.length),o=new te;o.updateFromIdToken(n);const a=new re({uid:r.localId,auth:e,stsTokenManager:o,isAnonymous:s}),c={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new $(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!(null===i||void 0===i?void 0:i.length)};return Object.assign(a,c),a}}const ie=new Map;function se(e){E(e instanceof Function,"Expected a class definition");let t=ie.get(e);return t?(E(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,ie.set(e,t),t)}class oe{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}oe.type="NONE";const ae=oe;function ce(e,t,n){return"firebase".concat(":",e,":").concat(t,":").concat(n)}class ue{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=ce(this.userKey,r.apiKey,i),this.fullPersistenceKey=ce("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?re._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"authUser";if(!t.length)return new ue(se(ae),e,n);const r=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let i=r[0]||se(ae);const s=ce(n,e.config.apiKey,e.name);let o=null;for(const u of t)try{const t=await u._get(s);if(t){const n=re._fromJSON(e,t);u!==i&&(o=n),i=u;break}}catch(c){}const a=r.filter((e=>e._shouldAllowMigration));return i._shouldAllowMigration&&a.length?(i=a[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==i)try{await e._remove(s)}catch(c){}}))),new ue(i,e,n)):new ue(i,e,n)}}function le(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(pe(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(he(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(me(t))return"Blackberry";if(ye(t))return"Webos";if(de(t))return"Safari";if((t.includes("chrome/")||fe(t))&&!t.includes("edge/"))return"Chrome";if(ge(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null===n||void 0===n?void 0:n.length))return n[1]}return"Other"}function he(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,i.ZQ)();return/firefox\//i.test(e)}function de(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,i.ZQ)()).toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function fe(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,i.ZQ)();return/crios\//i.test(e)}function pe(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,i.ZQ)();return/iemobile/i.test(e)}function ge(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,i.ZQ)();return/android/i.test(e)}function me(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,i.ZQ)();return/blackberry/i.test(e)}function ye(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,i.ZQ)();return/webos/i.test(e)}function ve(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,i.ZQ)();return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function we(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,i.ZQ)();return/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)}function _e(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,i.ZQ)();return ve(e)||ge(e)||ye(e)||me(e)||/windows phone/i.test(e)||pe(e)}function Ie(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];switch(e){case"Browser":t=le((0,i.ZQ)());break;case"Worker":t="".concat(le((0,i.ZQ)()),"-").concat(e);break;default:t=e}const s=n.length?n.join(","):"FirebaseCore-web";return"".concat(t,"/","JsCore","/").concat(r.SDK_VERSION,"/").concat(s)}class be{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,r)=>{try{n(e(t))}catch(i){r(i)}}));n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const e of t)try{e()}catch(r){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null===n||void 0===n?void 0:n.message})}}}class Te{constructor(e){var t,n,r,i;const s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=s.minPasswordLength)&&void 0!==t?t:6,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),void 0!==s.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),void 0!==s.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),void 0!==s.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),void 0!==s.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(r=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==r?r:"",this.forceUpgradeOnSignin=null!==(i=e.forceUpgradeOnSignin)&&void 0!==i&&i,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,r,i,s,o;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,a),this.validatePasswordCharacterOptions(e,a),a.isValid&&(a.isValid=null===(t=a.meetsMinPasswordLength)||void 0===t||t),a.isValid&&(a.isValid=null===(n=a.meetsMaxPasswordLength)||void 0===n||n),a.isValid&&(a.isValid=null===(r=a.containsLowercaseLetter)||void 0===r||r),a.isValid&&(a.isValid=null===(i=a.containsUppercaseLetter)||void 0===i||i),a.isValid&&(a.isValid=null===(s=a.containsNumericCharacter)||void 0===s||s),a.isValid&&(a.isValid=null===(o=a.containsNonAlphanumericCharacter)||void 0===o||o),a}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class Ee{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Ae(this),this.idTokenSubscription=new Ae(this),this.beforeStateQueue=new be(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=f,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=se(t)),this._initializationPromise=this.queue((async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await ue.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(i){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await G(this,{idToken:e}),n=await re._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if((0,r._isFirebaseServerApp)(this.app)){const e=this.app.settings.authIdToken;return e?new Promise((t=>{setTimeout((()=>this.initializeCurrentUserFromIdToken(e).then(t,t)))})):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let i=n,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,r=null===i||void 0===i?void 0:i._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==r||!(null===o||void 0===o?void 0:o.user)||(i=o.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(i)}catch(o){i=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(o)))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return b(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(n){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Z(e)}catch(t){if((null===t||void 0===t?void 0:t.code)!=="auth/".concat("network-request-failed"))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"===typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if((0,r._isFirebaseServerApp)(this.app))return Promise.reject(w(this));const t=e?(0,i.Ku)(e):null;return t&&b(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._deleted)return e&&b(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return(0,r._isFirebaseServerApp)(this.app)?Promise.reject(w(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return(0,r._isFirebaseServerApp)(this.app)?Promise.reject(w(this)):this.queue((async()=>{await this.assertedPersistence.setPersistence(se(e))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e){return O(e,"GET","/v2/passwordPolicy",x(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}(this),t=new Te(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new i.FA("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise(((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged((()=>{n(),e()}),t)}}))}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return O(e,"POST","/v2/accounts:revokeToken",x(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&se(e)||this._popupRedirectResolver;b(t,this,"argument-error"),this.redirectPersistenceManager=await ue.create(this,[se(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return"".concat(this.config.authDomain,":").concat(this.config.apiKey,":").concat(this.name)}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"===typeof t?t:t.next.bind(t);let s=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(b(o,this,"internal-error"),o.then((()=>{s||i(this.currentUser)})),"function"===typeof t){const i=e.addObserver(t,n,r);return()=>{s=!0,i()}}{const n=e.addObserver(t);return()=>{s=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return b(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Ie(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null===t||void 0===t?void 0:t.error)&&function(e){if(p.logLevel<=s.$b.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];p.warn("Auth (".concat(r.SDK_VERSION,"): ").concat(e),...n)}}("Error while retrieving App Check token: ".concat(t.error)),null===t||void 0===t?void 0:t.token}}function Se(e){return(0,i.Ku)(e)}class Ae{constructor(e){this.auth=e,this.observer=null,this.addObserver=(0,i.tD)((e=>this.observer=e))}get next(){return b(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Ce={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function ke(e){return Ce.loadJS(e)}function Ne(e){return"__".concat(e).concat(Math.floor(1e6*Math.random()))}class De{constructor(e){this.type="recaptcha-enterprise",this.auth=Se(e)}async verify(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"verify",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];function n(t,n,r){const i=window.grecaptcha;j(i)?i.enterprise.ready((()=>{i.enterprise.execute(t,{action:e}).then((e=>{n(e)})).catch((()=>{n("NO_RECAPTCHA")}))})):r(Error("No reCAPTCHA enterprise script loaded."))}return new Promise(((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((async(t,n)=>{K(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((r=>{if(void 0!==r.recaptchaKey){const n=new z(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((e=>{n(e)}))}))})(this.auth).then((i=>{if(!t&&j(window.grecaptcha))n(i,e,r);else{if("undefined"===typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));let t=Ce.recaptchaEnterpriseScript;0!==t.length&&(t+=i),ke(t).then((()=>{n(i,e,r)})).catch((e=>{r(e)}))}})).catch((e=>{r(e)}))}))}}async function Re(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=new De(e);let s;try{s=await i.verify(n)}catch(a){s=await i.verify(n,!0)}const o=Object.assign({},t);return r?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function Pe(e,t,n,r){var i;if(null===(i=e._getRecaptchaConfig())||void 0===i?void 0:i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await Re(e,t,n,"getOobCode"===n);return r(e,i)}return r(e,t).catch((async i=>{if(i.code==="auth/".concat("missing-recaptcha-token")){console.log("".concat(n," is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow."));const i=await Re(e,t,n,"getOobCode"===n);return r(e,i)}return Promise.reject(i)}))}function xe(e,t,n){const r=Se(e);b(r._canInitEmulator,r,"emulator-config-failed"),b(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null===n||void 0===n?void 0:n.disableWarnings),s=Oe(t),{host:o,port:a}=function(e){const t=Oe(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:Le(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:Le(t)}}}(t),c=null===a?"":":".concat(a);r.config.emulator={url:"".concat(s,"//").concat(o).concat(c,"/")},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!==typeof console&&"function"===typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!==typeof window&&"undefined"!==typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function Oe(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Le(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Me{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return T("not implemented")}_getIdTokenResponse(e){return T("not implemented")}_linkToIdToken(e,t){return T("not implemented")}_getReauthenticationResolver(e){return T("not implemented")}}async function Fe(e,t){return O(e,"POST","/v1/accounts:resetPassword",x(e,t))}async function Ve(e,t){return O(e,"POST","/v1/accounts:signUp",t)}async function Ue(e,t){return M(e,"POST","/v1/accounts:signInWithPassword",x(e,t))}async function Be(e,t){return O(e,"POST","/v1/accounts:sendOobCode",x(e,t))}async function qe(e,t){return Be(e,t)}async function je(e,t){return Be(e,t)}class ze extends Me{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new ze(e,t,"password")}static _fromEmailAndCode(e,t){return new ze(e,t,"emailLink",arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e;if((null===t||void 0===t?void 0:t.email)&&(null===t||void 0===t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return Pe(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",Ue);case"emailLink":return async function(e,t){return M(e,"POST","/v1/accounts:signInWithEmailLink",x(e,t))}(e,{email:this._email,oobCode:this._password});default:m(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Pe(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Ve);case"emailLink":return async function(e,t){return M(e,"POST","/v1/accounts:signInWithEmailLink",x(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:m(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Ke(e,t){return M(e,"POST","/v1/accounts:signInWithIdp",x(e,t))}class Ge extends Me{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Ge(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):m("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=(0,o.Tt)(t,["providerId","signInMethod"]);if(!n||!r)return null;const s=new Ge(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return Ke(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Ke(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ke(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=(0,i.Am)(t)}return e}}const We={USER_NOT_FOUND:"user-not-found"};class He extends Me{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new He({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new He({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return M(e,"POST","/v1/accounts:signInWithPhoneNumber",x(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await M(e,"POST","/v1/accounts:signInWithPhoneNumber",x(e,t));if(n.temporaryProof)throw B(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return M(e,"POST","/v1/accounts:signInWithPhoneNumber",x(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),We)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"===typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new He({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class Qe{constructor(e){var t,n,r,s,o,a;const c=(0,i.I9)((0,i.hp)(e)),u=null!==(t=c.apiKey)&&void 0!==t?t:null,l=null!==(n=c.oobCode)&&void 0!==n?n:null,h=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=c.mode)&&void 0!==r?r:null);b(u&&l&&h,"argument-error"),this.apiKey=u,this.operation=h,this.code=l,this.continueUrl=null!==(s=c.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(o=c.languageCode)&&void 0!==o?o:null,this.tenantId=null!==(a=c.tenantId)&&void 0!==a?a:null}static parseLink(e){const t=function(e){const t=(0,i.I9)((0,i.hp)(e)).link,n=t?(0,i.I9)((0,i.hp)(t)).deep_link_id:null,r=(0,i.I9)((0,i.hp)(e)).deep_link_id;return(r?(0,i.I9)((0,i.hp)(r)).link:null)||r||n||t||e}(e);try{return new Qe(t)}catch(n){return null}}}class Ye{constructor(){this.providerId=Ye.PROVIDER_ID}static credential(e,t){return ze._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=Qe.parseLink(t);return b(n,"argument-error"),ze._fromEmailAndCode(e,n.code,n.tenantId)}}Ye.PROVIDER_ID="password",Ye.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Ye.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Je{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Xe extends Je{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class $e extends Xe{static credentialFromJSON(e){const t="string"===typeof e?JSON.parse(e):e;return b("providerId"in t&&"signInMethod"in t,"argument-error"),Ge._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return b(e.idToken||e.accessToken,"argument-error"),Ge._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return $e.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return $e.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthIdToken:n,oauthAccessToken:r,oauthTokenSecret:i,pendingToken:s,nonce:o,providerId:a}=t;if(!r&&!i&&!n&&!s)return null;if(!a)return null;try{return new $e(a)._credential({idToken:n,accessToken:r,nonce:o,pendingToken:s})}catch(c){return null}}}class Ze extends Xe{constructor(){super("facebook.com")}static credential(e){return Ge._fromParams({providerId:Ze.PROVIDER_ID,signInMethod:Ze.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ze.credentialFromTaggedObject(e)}static credentialFromError(e){return Ze.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return Ze.credential(t.oauthAccessToken)}catch(n){return null}}}Ze.FACEBOOK_SIGN_IN_METHOD="facebook.com",Ze.PROVIDER_ID="facebook.com";class et extends Xe{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Ge._fromParams({providerId:et.PROVIDER_ID,signInMethod:et.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return et.credentialFromTaggedObject(e)}static credentialFromError(e){return et.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthIdToken:n,oauthAccessToken:r}=t;if(!n&&!r)return null;try{return et.credential(n,r)}catch(i){return null}}}et.GOOGLE_SIGN_IN_METHOD="google.com",et.PROVIDER_ID="google.com";class tt extends Xe{constructor(){super("github.com")}static credential(e){return Ge._fromParams({providerId:tt.PROVIDER_ID,signInMethod:tt.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return tt.credentialFromTaggedObject(e)}static credentialFromError(e){return tt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return tt.credential(t.oauthAccessToken)}catch(n){return null}}}tt.GITHUB_SIGN_IN_METHOD="github.com",tt.PROVIDER_ID="github.com";class nt extends Me{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return Ke(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Ke(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ke(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r,pendingToken:i}=t;return n&&r&&i&&n===r?new nt(n,i):null}static _create(e,t){return new nt(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class rt extends Je{constructor(e){b(e.startsWith("saml."),"argument-error"),super(e)}static credentialFromResult(e){return rt.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return rt.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=nt.fromJSON(e);return b(t,"argument-error"),t}static samlCredentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{pendingToken:n,providerId:r}=t;if(!n||!r)return null;try{return nt._create(r,n)}catch(i){return null}}}class it extends Xe{constructor(){super("twitter.com")}static credential(e,t){return Ge._fromParams({providerId:it.PROVIDER_ID,signInMethod:it.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return it.credentialFromTaggedObject(e)}static credentialFromError(e){return it.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=t;if(!n||!r)return null;try{return it.credential(n,r)}catch(i){return null}}}async function st(e,t){return M(e,"POST","/v1/accounts:signUp",x(e,t))}it.TWITTER_SIGN_IN_METHOD="twitter.com",it.PROVIDER_ID="twitter.com";class ot{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=await re._fromIdTokenResponse(e,n,r),s=at(n);return new ot({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=at(n);return new ot({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function at(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}async function ct(e){var t;if((0,r._isFirebaseServerApp)(e.app))return Promise.reject(w(e));const n=Se(e);if(await n._initializationPromise,null===(t=n.currentUser)||void 0===t?void 0:t.isAnonymous)return new ot({user:n.currentUser,providerId:null,operationType:"signIn"});const i=await st(n,{returnSecureToken:!0}),s=await ot._fromIdTokenResponse(n,"signIn",i,!0);return await n._updateCurrentUser(s.user),s}class ut extends i.g{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,ut.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new ut(e,t,n,r)}}function lt(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if(n.code==="auth/".concat("multi-factor-auth-required"))throw ut._fromErrorAndOperation(e,n,t,r);throw n}))}function ht(e){return new Set(e.map((e=>{let{providerId:t}=e;return t})).filter((e=>!!e)))}async function dt(e,t){const n=(0,i.Ku)(e);await pt(!0,n,t);const{providerUserInfo:r}=await async function(e,t){return O(e,"POST","/v1/accounts:update",t)}(n.auth,{idToken:await n.getIdToken(),deleteProvider:[t]}),s=ht(r||[]);return n.providerData=n.providerData.filter((e=>s.has(e.providerId))),s.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n}async function ft(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=await J(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return ot._forOperation(e,"link",r)}async function pt(e,t,n){await Z(t);const r=!1===e?"provider-already-linked":"no-such-provider";b(ht(t.providerData).has(n)===e,t.auth,r)}async function gt(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{auth:i}=e;if((0,r._isFirebaseServerApp)(i.app))return Promise.reject(w(i));const s="reauthenticate";try{const r=await J(e,lt(i,s,t,e),n);b(r.idToken,i,"internal-error");const o=Q(r.idToken);b(o,i,"internal-error");const{sub:a}=o;return b(e.uid===a,i,"user-mismatch"),ot._forOperation(e,s,r)}catch(o){throw(null===o||void 0===o?void 0:o.code)==="auth/".concat("user-not-found")&&m(i,"user-mismatch"),o}}async function mt(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if((0,r._isFirebaseServerApp)(e.app))return Promise.reject(w(e));const i="signIn",s=await lt(e,i,t),o=await ot._fromIdTokenResponse(e,i,s);return n||await e._updateCurrentUser(o.user),o}async function yt(e,t){return mt(Se(e),t)}async function vt(e,t){const n=(0,i.Ku)(e);return await pt(!1,n,t.providerId),ft(n,t)}async function wt(e,t){return gt((0,i.Ku)(e),t)}async function _t(e,t){if((0,r._isFirebaseServerApp)(e.app))return Promise.reject(w(e));const n=Se(e),i=await async function(e,t){return M(e,"POST","/v1/accounts:signInWithCustomToken",x(e,t))}(n,{token:t,returnSecureToken:!0}),s=await ot._fromIdTokenResponse(n,"signIn",i);return await n._updateCurrentUser(s.user),s}class It{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?bt._fromServerResponse(e,t):"totpInfo"in t?Tt._fromServerResponse(e,t):m(e,"internal-error")}}class bt extends It{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new bt(t)}}class Tt extends It{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new Tt(t)}}function Et(e,t,n){var r;b((null===(r=n.url)||void 0===r?void 0:r.length)>0,e,"invalid-continue-uri"),b("undefined"===typeof n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(b(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(b(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function St(e){const t=Se(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function At(e,t,n){const r=Se(e),i={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};n&&Et(r,i,n),await Pe(r,i,"getOobCode",qe)}async function Ct(e,t,n){await Fe((0,i.Ku)(e),{oobCode:t,newPassword:n}).catch((async t=>{throw t.code==="auth/".concat("password-does-not-meet-requirements")&&St(e),t}))}async function kt(e,t){await async function(e,t){return O(e,"POST","/v1/accounts:update",x(e,t))}((0,i.Ku)(e),{oobCode:t})}async function Nt(e,t){const n=(0,i.Ku)(e),r=await Fe(n,{oobCode:t}),s=r.requestType;switch(b(s,n,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":b(r.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":b(r.mfaInfo,n,"internal-error");default:b(r.email,n,"internal-error")}let o=null;return r.mfaInfo&&(o=It._fromServerResponse(Se(n),r.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.newEmail:r.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.email:r.newEmail)||null,multiFactorInfo:o},operation:s}}async function Dt(e,t){const{data:n}=await Nt((0,i.Ku)(e),t);return n.email}async function Rt(e,t,n){if((0,r._isFirebaseServerApp)(e.app))return Promise.reject(w(e));const i=Se(e),s=Pe(i,{returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",st),o=await s.catch((t=>{throw t.code==="auth/".concat("password-does-not-meet-requirements")&&St(e),t})),a=await ot._fromIdTokenResponse(i,"signIn",o);return await i._updateCurrentUser(a.user),a}function Pt(e,t,n){return(0,r._isFirebaseServerApp)(e.app)?Promise.reject(w(e)):yt((0,i.Ku)(e),Ye.credential(t,n)).catch((async t=>{throw t.code==="auth/".concat("password-does-not-meet-requirements")&&St(e),t}))}async function xt(e,t,n){const r=Se(e),i={requestType:"EMAIL_SIGNIN",email:t,clientType:"CLIENT_TYPE_WEB"};!function(e,t){b(t.handleCodeInApp,r,"argument-error"),t&&Et(r,e,t)}(i,n),await Pe(r,i,"getOobCode",je)}function Ot(e,t){const n=Qe.parseLink(t);return"EMAIL_SIGNIN"===(null===n||void 0===n?void 0:n.operation)}async function Lt(e,t,n){if((0,r._isFirebaseServerApp)(e.app))return Promise.reject(w(e));const s=(0,i.Ku)(e),o=Ye.credentialWithLink(t,n||S());return b(o._tenantId===(s.tenantId||null),s,"tenant-id-mismatch"),yt(s,o)}async function Mt(e,t){const n={identifier:t,continueUri:A()?S():"http://localhost"},{signinMethods:r}=await async function(e,t){return O(e,"POST","/v1/accounts:createAuthUri",x(e,t))}((0,i.Ku)(e),n);return r||[]}async function Ft(e,t){const n=(0,i.Ku)(e),r={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&Et(n.auth,r,t);const{email:s}=await async function(e,t){return Be(e,t)}(n.auth,r);s!==e.email&&await e.reload()}async function Vt(e,t,n){const r=(0,i.Ku)(e),s={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};n&&Et(r.auth,s,n);const{email:o}=await async function(e,t){return Be(e,t)}(r.auth,s);o!==e.email&&await e.reload()}async function Ut(e,t){let{displayName:n,photoURL:r}=t;if(void 0===n&&void 0===r)return;const s=(0,i.Ku)(e),o={idToken:await s.getIdToken(),displayName:n,photoUrl:r,returnSecureToken:!0},a=await J(s,async function(e,t){return O(e,"POST","/v1/accounts:update",t)}(s.auth,o));s.displayName=a.displayName||null,s.photoURL=a.photoUrl||null;const c=s.providerData.find((e=>{let{providerId:t}=e;return"password"===t}));c&&(c.displayName=s.displayName,c.photoURL=s.photoURL),await s._updateTokensIfNecessary(a)}function Bt(e,t){const n=(0,i.Ku)(e);return(0,r._isFirebaseServerApp)(n.auth.app)?Promise.reject(w(n.auth)):jt(n,t,null)}function qt(e,t){return jt((0,i.Ku)(e),null,t)}async function jt(e,t,n){const{auth:r}=e,i={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(i.email=t),n&&(i.password=n);const s=await J(e,async function(e,t){return O(e,"POST","/v1/accounts:update",t)}(r,i));await e._updateTokensIfNecessary(s,!0)}class zt{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.isNewUser=e,this.providerId=t,this.profile=n}}class Kt extends zt{constructor(e,t,n,r){super(e,t,n),this.username=r}}class Gt extends zt{constructor(e,t){super(e,"facebook.com",t)}}class Wt extends Kt{constructor(e,t){super(e,"github.com",t,"string"===typeof(null===t||void 0===t?void 0:t.login)?null===t||void 0===t?void 0:t.login:null)}}class Ht extends zt{constructor(e,t){super(e,"google.com",t)}}class Qt extends Kt{constructor(e,t,n){super(e,"twitter.com",t,n)}}function Yt(e){const{user:t,_tokenResponse:n}=e;return t.isAnonymous&&!n?{providerId:null,isNewUser:!1,profile:null}:function(e){var t,n;if(!e)return null;const{providerId:r}=e,i=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},s=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!r&&(null===e||void 0===e?void 0:e.idToken)){const r=null===(n=null===(t=Q(e.idToken))||void 0===t?void 0:t.firebase)||void 0===n?void 0:n.sign_in_provider;if(r)return new zt(s,"anonymous"!==r&&"custom"!==r?r:null)}if(!r)return null;switch(r){case"facebook.com":return new Gt(s,i);case"github.com":return new Wt(s,i);case"google.com":return new Ht(s,i);case"twitter.com":return new Qt(s,i,e.screenName||null);case"custom":case"anonymous":return new zt(s,null);default:return new zt(s,r,i)}}(n)}class Jt{constructor(e,t,n){this.type=e,this.credential=t,this.user=n}static _fromIdtoken(e,t){return new Jt("enroll",e,t)}static _fromMfaPendingCredential(e){return new Jt("signin",e)}toJSON(){const e="enroll"===this.type?"idToken":"pendingCredential";return{multiFactorSession:{[e]:this.credential}}}static fromJSON(e){var t,n;if(null===e||void 0===e?void 0:e.multiFactorSession){if(null===(t=e.multiFactorSession)||void 0===t?void 0:t.pendingCredential)return Jt._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null===(n=e.multiFactorSession)||void 0===n?void 0:n.idToken)return Jt._fromIdtoken(e.multiFactorSession.idToken)}return null}}class Xt{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,t){const n=Se(e),r=t.customData._serverResponse,i=(r.mfaInfo||[]).map((e=>It._fromServerResponse(n,e)));b(r.mfaPendingCredential,n,"internal-error");const s=Jt._fromMfaPendingCredential(r.mfaPendingCredential);return new Xt(s,i,(async e=>{const i=await e._process(n,s);delete r.mfaInfo,delete r.mfaPendingCredential;const o=Object.assign(Object.assign({},r),{idToken:i.idToken,refreshToken:i.refreshToken});switch(t.operationType){case"signIn":const e=await ot._fromIdTokenResponse(n,t.operationType,o);return await n._updateCurrentUser(e.user),e;case"reauthenticate":return b(t.user,n,"internal-error"),ot._forOperation(t.user,t.operationType,o);default:m(n,"internal-error")}}))}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function $t(e,t){var n;const r=(0,i.Ku)(e),s=t;return b(t.customData.operationType,r,"argument-error"),b(null===(n=s.customData._serverResponse)||void 0===n?void 0:n.mfaPendingCredential,r,"argument-error"),Xt._fromError(r,s)}class Zt{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload((t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map((t=>It._fromServerResponse(e.auth,t))))}))}static _fromUser(e){return new Zt(e)}async getSession(){return Jt._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const n=e,r=await this.getSession(),i=await J(this.user,n._process(this.user.auth,r,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t="string"===typeof e?e:e.uid,n=await this.user.getIdToken();try{const e=await J(this.user,(r=this.user.auth,i={idToken:n,mfaEnrollmentId:t},O(r,"POST","/v2/accounts/mfaEnrollment:withdraw",x(r,i))));this.enrolledFactors=this.enrolledFactors.filter((e=>{let{uid:n}=e;return n!==t})),await this.user._updateTokensIfNecessary(e),await this.user.reload()}catch(s){throw s}var r,i}}const en=new WeakMap;function tn(e){const t=(0,i.Ku)(e);return en.has(t)||en.set(t,Zt._fromUser(t)),en.get(t)}const nn="__sak";class rn{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(nn,"1"),this.storage.removeItem(nn),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class sn extends rn{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=(0,i.ZQ)();return de(e)||ve(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=_e(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},s=this.storage.getItem(n);(0,i.lT)()&&10===document.documentMode&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}sn.type="LOCAL";const on=sn;class an extends rn{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}an.type="SESSION";const cn=an;class un{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new un(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,s=this.handlersMap[r];if(!(null===s||void 0===s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(s).map((async e=>e(t.origin,i))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function ln(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n="";for(let r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}un.receivers=[];class hn{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;const r="undefined"!==typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,s;return new Promise(((o,a)=>{const c=ln("",20);r.port1.start();const u=setTimeout((()=>{a(new Error("unsupported_event"))}),n);s={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),i=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(i),o(t.data.response);break;default:clearTimeout(u),clearTimeout(i),a(new Error("invalid_response"))}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function dn(){return window}function fn(){return"undefined"!==typeof dn().WorkerGlobalScope&&"function"===typeof dn().importScripts}const pn="firebaseLocalStorageDb",gn="firebaseLocalStorage",mn="fbase_key";class yn{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function vn(e,t){return e.transaction([gn],t?"readwrite":"readonly").objectStore(gn)}function wn(){const e=indexedDB.open(pn,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(gn,{keyPath:mn})}catch(r){n(r)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(gn)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(pn);return new yn(e).toPromise()}(),t(await wn()))}))}))}async function _n(e,t,n){const r=vn(e,!0).put({[mn]:t,value:n});return new yn(r).toPromise()}function In(e,t){const n=vn(e,!0).delete(t);return new yn(n).toPromise()}class bn{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await wn()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(n){if(t++>3)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return fn()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=un._getInstance(fn()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new hn(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&function(){var e;return(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await wn();return await _n(e,nn,"1"),await In(e,nn),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>_n(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=vn(e,!1).get(t),r=await new yn(n).toPromise();return void 0===r?null:r.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>In(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=vn(e,!1).getAll();return new yn(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!n.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}bn.type="LOCAL";const Tn=bn;const En=1e12;class Sn{constructor(e){this.auth=e,this.counter=En,this._widgets=new Map}render(e,t){const n=this.counter;return this._widgets.set(n,new An(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t;const n=e||En;null===(t=this._widgets.get(n))||void 0===t||t.delete(),this._widgets.delete(n)}getResponse(e){var t;const n=e||En;return(null===(t=this._widgets.get(n))||void 0===t?void 0:t.getResponse())||""}async execute(e){var t;const n=e||En;return null===(t=this._widgets.get(n))||void 0===t||t.execute(),""}}class An{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const r="string"===typeof e?document.getElementById(e):e;b(r,"argument-error",{appName:t}),this.container=r,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout((()=>{this.responseToken=function(e){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<e;r++)t.push(n.charAt(Math.floor(Math.random()*n.length)));return t.join("")}(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(n){}this.timerId=window.setTimeout((()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(n){}this.isVisible&&this.execute()}),6e4)}),500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const Cn=Ne("rcb"),kn=new k(3e4,6e4);class Nn{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(null===(e=dn().grecaptcha)||void 0===e?void 0:e.render)}load(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return b(function(e){return e.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e)}(t),e,"argument-error"),this.shouldResolveImmediately(t)&&q(dn().grecaptcha)?Promise.resolve(dn().grecaptcha):new Promise(((n,r)=>{const s=dn().setTimeout((()=>{r(y(e,"network-request-failed"))}),kn.get());dn()[Cn]=()=>{dn().clearTimeout(s),delete dn()[Cn];const i=dn().grecaptcha;if(!i||!q(i))return void r(y(e,"internal-error"));const o=i.render;i.render=(e,t)=>{const n=o(e,t);return this.counter++,n},this.hostLanguage=t,n(i)};ke("".concat(Ce.recaptchaV2Script,"?").concat((0,i.Am)({onload:Cn,render:"explicit",hl:t}))).catch((()=>{clearTimeout(s),r(y(e,"internal-error"))}))}))}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(null===(t=dn().grecaptcha)||void 0===t?void 0:t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class Dn{async load(e){return new Sn(e)}clearedOneInstance(){}}const Rn="recaptcha",Pn={theme:"light",type:"image"};class xn{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object.assign({},Pn);this.parameters=n,this.type=Rn,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Se(e),this.isInvisible="invisible"===this.parameters.size,b("undefined"!==typeof document,this.auth,"operation-not-supported-in-this-environment");const r="string"===typeof t?document.getElementById(t):t;b(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new Dn:new Nn,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),n=t.getResponse(e);return n||new Promise((n=>{const r=e=>{e&&(this.tokenChangeListeners.delete(r),n(e))};this.tokenChangeListeners.add(r),this.isInvisible&&t.execute(e)}))}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch((e=>{throw this.renderPromise=null,e}))),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach((e=>{this.container.removeChild(e)}))}validateStartingState(){b(!this.parameters.sitekey,this.auth,"argument-error"),b(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),b("undefined"!==typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach((e=>e(t))),"function"===typeof e)e(t);else if("string"===typeof e){const n=dn()[e];"function"===typeof n&&n(t)}}}assertNotDestroyed(){b(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){b(A()&&!fn(),this.auth,"internal-error"),await function(){let e=null;return new Promise((t=>{"complete"!==document.readyState?(e=()=>t(),window.addEventListener("load",e)):t()})).catch((t=>{throw e&&window.removeEventListener("load",e),t}))}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await async function(e){return(await O(e,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}(this.auth);b(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return b(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class On{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=He._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function Ln(e,t,n){if((0,r._isFirebaseServerApp)(e.app))return Promise.reject(w(e));const s=Se(e),o=await Vn(s,t,(0,i.Ku)(n));return new On(o,(e=>yt(s,e)))}async function Mn(e,t,n){const r=(0,i.Ku)(e);await pt(!1,r,"phone");const s=await Vn(r.auth,t,(0,i.Ku)(n));return new On(s,(e=>vt(r,e)))}async function Fn(e,t,n){const s=(0,i.Ku)(e);if((0,r._isFirebaseServerApp)(s.auth.app))return Promise.reject(w(s.auth));const o=await Vn(s.auth,t,(0,i.Ku)(n));return new On(o,(e=>wt(s,e)))}async function Vn(e,t,n){var r;const i=await n.verify();try{let s;if(b("string"===typeof i,e,"argument-error"),b(n.type===Rn,e,"argument-error"),s="string"===typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s){b("enroll"===t.type,e,"internal-error");const n=await function(e,t){return O(e,"POST","/v2/accounts/mfaEnrollment:start",x(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:i}});return n.phoneSessionInfo.sessionInfo}{b("signin"===t.type,e,"internal-error");const n=(null===(r=s.multiFactorHint)||void 0===r?void 0:r.uid)||s.multiFactorUid;b(n,e,"missing-multi-factor-info");const o=await function(e,t){return O(e,"POST","/v2/accounts/mfaSignIn:start",x(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:i}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return O(e,"POST","/v1/accounts:sendVerificationCode",x(e,t))}(e,{phoneNumber:s.phoneNumber,recaptchaToken:i});return t}}finally{n._reset()}}async function Un(e,t){const n=(0,i.Ku)(e);if((0,r._isFirebaseServerApp)(n.auth.app))return Promise.reject(w(n.auth));await ft(n,t)}class Bn{constructor(e){this.providerId=Bn.PROVIDER_ID,this.auth=Se(e)}verifyPhoneNumber(e,t){return Vn(this.auth,e,(0,i.Ku)(t))}static credential(e,t){return He._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Bn.credentialFromTaggedObject(t)}static credentialFromError(e){return Bn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{phoneNumber:n,temporaryProof:r}=t;return n&&r?He._fromTokenResponse(n,r):null}}function qn(e,t){return t?se(t):(b(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Bn.PROVIDER_ID="phone",Bn.PHONE_SIGN_IN_METHOD="phone";class jn extends Me{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ke(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Ke(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Ke(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function zn(e){return mt(e.auth,new jn(e),e.bypassAuthState)}function Kn(e){const{auth:t,user:n}=e;return b(n,t,"internal-error"),gt(n,new jn(e),e.bypassAuthState)}async function Gn(e){const{auth:t,user:n}=e;return b(n,t,"internal-error"),ft(n,new jn(e),e.bypassAuthState)}class Wn{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return zn;case"linkViaPopup":case"linkViaRedirect":return Gn;case"reauthViaPopup":case"reauthViaRedirect":return Kn;default:m(this.auth,"internal-error")}}resolve(e){E(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){E(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Hn=new k(2e3,1e4);async function Qn(e,t,n){if((0,r._isFirebaseServerApp)(e.app))return Promise.reject(y(e,"operation-not-supported-in-this-environment"));const i=Se(e);_(e,t,Je);const s=qn(i,n);return new Xn(i,"signInViaPopup",t,s).executeNotNull()}async function Yn(e,t,n){const s=(0,i.Ku)(e);if((0,r._isFirebaseServerApp)(s.auth.app))return Promise.reject(y(s.auth,"operation-not-supported-in-this-environment"));_(s.auth,t,Je);const o=qn(s.auth,n);return new Xn(s.auth,"reauthViaPopup",t,o,s).executeNotNull()}async function Jn(e,t,n){const r=(0,i.Ku)(e);_(r.auth,t,Je);const s=qn(r.auth,n);return new Xn(r.auth,"linkViaPopup",t,s,r).executeNotNull()}class Xn extends Wn{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,Xn.currentPopupAction&&Xn.currentPopupAction.cancel(),Xn.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return b(e,this.auth,"internal-error"),e}async onExecution(){E(1===this.filter.length,"Popup operations only handle one event");const e=ln();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(y(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(y(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Xn.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(y(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(e,Hn.get())};e()}}Xn.currentPopupAction=null;const $n="pendingRedirect",Zn=new Map;class er extends Wn{constructor(e,t){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.eventId=null}async execute(){let e=Zn.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=sr(t),r=ir(e);if(!await r._isAvailable())return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}Zn.set(this.auth._key(),e)}return this.bypassAuthState||Zn.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function tr(e,t){return ir(e)._set(sr(t),"true")}function nr(){Zn.clear()}function rr(e,t){Zn.set(e._key(),t)}function ir(e){return se(e._redirectPersistence)}function sr(e){return ce($n,e.config.apiKey,e.name)}function or(e,t,n){return async function(e,t,n){if((0,r._isFirebaseServerApp)(e.app))return Promise.reject(w(e));const i=Se(e);_(e,t,Je),await i._initializationPromise;const s=qn(i,n);return await tr(s,i),s._openRedirect(i,t,"signInViaRedirect")}(e,t,n)}function ar(e,t,n){return async function(e,t,n){const s=(0,i.Ku)(e);if(_(s.auth,t,Je),(0,r._isFirebaseServerApp)(s.auth.app))return Promise.reject(w(s.auth));await s.auth._initializationPromise;const o=qn(s.auth,n);await tr(o,s.auth);const a=await hr(s);return o._openRedirect(s.auth,t,"reauthViaRedirect",a)}(e,t,n)}function cr(e,t,n){return async function(e,t,n){const r=(0,i.Ku)(e);_(r.auth,t,Je),await r.auth._initializationPromise;const s=qn(r.auth,n);await pt(!1,r,t.providerId),await tr(s,r.auth);const o=await hr(r);return s._openRedirect(r.auth,t,"linkViaRedirect",o)}(e,t,n)}async function ur(e,t){return await Se(e)._initializationPromise,lr(e,t,!1)}async function lr(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if((0,r._isFirebaseServerApp)(e.app))return Promise.reject(w(e));const i=Se(e),s=qn(i,t),o=new er(i,s,n),a=await o.execute();return a&&!n&&(delete a.user._redirectEventId,await i._persistUserIfCurrent(a.user),await i._setRedirectUser(null,t)),a}async function hr(e){const t=ln("".concat(e.uid,":::"));return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class dr{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return pr(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!pr(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(y(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(fr(e))}saveEventToCache(e){this.cachedEventUids.add(fr(e)),this.lastProcessedEventTime=Date.now()}}function fr(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function pr(e){let{type:t,error:n}=e;return"unknown"===t&&(null===n||void 0===n?void 0:n.code)==="auth/".concat("no-auth-event")}async function gr(e){return O(e,"GET","/v1/projects",arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}const mr=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,yr=/^https?/;function vr(e){const t=S(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!yr.test(n))return!1;if(mr.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const wr=new k(3e4,6e4);function _r(){const e=dn().___jsl;if(null===e||void 0===e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}function Ir(e){return new Promise(((t,n)=>{var r,i,s;function o(){_r(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{_r(),n(y(e,"network-request-failed"))},timeout:wr.get()})}if(null===(i=null===(r=dn().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=dn().gapi)||void 0===s?void 0:s.load)){const t=Ne("iframefcb");return dn()[t]=()=>{gapi.load?o():n(y(e,"network-request-failed"))},ke("".concat(Ce.gapiScript,"?onload=").concat(t)).catch((e=>n(e)))}o()}})).catch((e=>{throw br=null,e}))}let br=null;const Tr=new k(5e3,15e3),Er="__/auth/iframe",Sr="emulator/auth/iframe",Ar={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Cr=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function kr(e){const t=e.config;b(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?N(t,Sr):"https://".concat(e.config.authDomain,"/").concat(Er),s={apiKey:t.apiKey,appName:e.name,v:r.SDK_VERSION},o=Cr.get(e.config.apiHost);o&&(s.eid=o);const a=e._getFrameworks();return a.length&&(s.fw=a.join(",")),"".concat(n,"?").concat((0,i.Am)(s).slice(1))}async function Nr(e){const t=await function(e){return br=br||Ir(e),br}(e),n=dn().gapi;return b(n,e,"internal-error"),t.open({where:document.body,url:kr(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Ar,dontclear:!0},(t=>new Promise((async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=y(e,"network-request-failed"),s=dn().setTimeout((()=>{r(i)}),Tr.get());function o(){dn().clearTimeout(s),n(t)}t.ping(o).then(o,(()=>{r(i)}))}))))}const Dr={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Rr{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function Pr(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:600;const o=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let c="";const u=Object.assign(Object.assign({},Dr),{width:r.toString(),height:s.toString(),top:o,left:a}),l=(0,i.ZQ)().toLowerCase();n&&(c=fe(l)?"_blank":n),he(l)&&(t=t||"http://localhost",u.scrollbars="yes");const h=Object.entries(u).reduce(((e,t)=>{let[n,r]=t;return"".concat(e).concat(n,"=").concat(r,",")}),"");if(function(){var e;return ve(arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,i.ZQ)())&&!!(null===(e=window.navigator)||void 0===e?void 0:e.standalone)}(l)&&"_self"!==c)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",c),new Rr(null);const d=window.open(t||"",c,h);b(d,e,"popup-blocked");try{d.focus()}catch(f){}return new Rr(d)}const xr="__/auth/handler",Or="emulator/auth/handler",Lr=encodeURIComponent("fac");async function Mr(e,t,n,s,o,a){b(e.config.authDomain,e,"auth-domain-config-required"),b(e.config.apiKey,e,"invalid-api-key");const c={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:s,v:r.SDK_VERSION,eventId:o};if(t instanceof Je){t.setDefaultLanguage(e.languageCode),c.providerId=t.providerId||"",(0,i.Im)(t.getCustomParameters())||(c.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(a||{}))c[e]=t}if(t instanceof Xe){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(c.scopes=e.join(","))}e.tenantId&&(c.tid=e.tenantId);const u=c;for(const r of Object.keys(u))void 0===u[r]&&delete u[r];const l=await e._getAppCheckToken(),h=l?"#".concat(Lr,"=").concat(encodeURIComponent(l)):"";return"".concat(function(e){let{config:t}=e;if(!t.emulator)return"https://".concat(t.authDomain,"/").concat(xr);return N(t,Or)}(e),"?").concat((0,i.Am)(u).slice(1)).concat(h)}const Fr="webStorageSupport";const Vr=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=cn,this._completeRedirectFn=lr,this._overrideRedirectResult=rr}async _openPopup(e,t,n,r){var i;E(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()");return Pr(e,await Mr(e,t,n,S(),r),ln())}async _openRedirect(e,t,n,r){await this._originValidation(e);return function(e){dn().location.href=e}(await Mr(e,t,n,S(),r)),new Promise((()=>{}))}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(E(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await Nr(e),n=new dr(e);return t.register("authEvent",(t=>{b(null===t||void 0===t?void 0:t.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Fr,{type:Fr},(n=>{var r;const i=null===(r=null===n||void 0===n?void 0:n[0])||void 0===r?void 0:r[Fr];void 0!==i&&t(!!i),m(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await gr(e);for(const r of t)try{if(vr(r))return}catch(n){}m(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return _e()||de()||ve()}};class Ur{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return T("unexpected MultiFactorSessionType")}}}class Br extends Ur{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new Br(e)}_finalizeEnroll(e,t,n){return function(e,t){return O(e,"POST","/v2/accounts/mfaEnrollment:finalize",x(e,t))}(e,{idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return function(e,t){return O(e,"POST","/v2/accounts/mfaSignIn:finalize",x(e,t))}(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class qr{constructor(){}static assertion(e){return Br._fromCredential(e)}}qr.FACTOR_ID="phone";var jr="@firebase/auth",zr="1.7.0";class Kr{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null===t||void 0===t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){b(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}(0,i.XA)("authIdTokenMaxAge");var Gr;Ce={loadJS:e=>new Promise(((t,n)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=y("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(r)})),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},Gr="Browser",(0,r._registerComponent)(new a.uA("auth",((e,t)=>{let{options:n}=t;const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;b(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:o,authDomain:a,clientPlatform:Gr,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Ie(Gr)},u=new Ee(r,i,s,c);return function(e,t){const n=(null===t||void 0===t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(se);(null===t||void 0===t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null===t||void 0===t?void 0:t.popupRedirectResolver)}(u,n),u}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),(0,r._registerComponent)(new a.uA("auth-internal",(e=>(e=>new Kr(e))(Se(e.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),(0,r.registerVersion)(jr,zr,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(Gr)),(0,r.registerVersion)(jr,zr,"esm2017")},7700:(e,t,n)=>{n.d(t,{Am:()=>P,Bd:()=>v,FA:()=>A,Fy:()=>p,I9:()=>x,Im:()=>N,Ku:()=>V,Ll:()=>y,T9:()=>h,Uj:()=>o,XA:()=>d,ZQ:()=>g,bD:()=>D,cY:()=>f,eX:()=>E,g:()=>S,gR:()=>k,hp:()=>O,jZ:()=>m,lT:()=>I,lV:()=>_,nr:()=>b,sr:()=>w,tD:()=>L,u:()=>a,zW:()=>T,zw:()=>c});const r=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296===(64512&i)&&r+1<e.length&&56320===(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},i={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<e.length;i+=3){const t=e[i],s=i+1<e.length,o=s?e[i+1]:0,a=i+2<e.length,c=a?e[i+2]:0,u=t>>2,l=(3&t)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(h=64)),r.push(n[u],n[l],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(r(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<e.length;){const t=n[e.charAt(i++)],o=i<e.length?n[e.charAt(i)]:0;++i;const a=i<e.length?n[e.charAt(i)]:64;++i;const c=i<e.length?n[e.charAt(i)]:64;if(++i,null==t||null==o||null==a||null==c)throw new s;const u=t<<2|o>>4;if(r.push(u),64!==a){const e=o<<4&240|a>>2;if(r.push(e),64!==c){const e=a<<6&192|c;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class s extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const o=function(e){return function(e){const t=r(e);return i.encodeByteArray(t,!0)}(e).replace(/\./g,"")},a=function(e){try{return i.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function c(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=c(e[n],t[n]));return e}const u=()=>function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,l=()=>{try{return u()||(()=>{if("undefined"===typeof process)return;const e={NODE_ENV:"production",PUBLIC_URL:"/store",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_BASE_URL:"https://store-c430f-default-rtdb.europe-west1.firebasedatabase.app/",REACT_APP_WEB_API_KEY:"AIzaSyBTbTWaBdsiKu5y3-u8MOzijlRybA4xe-w"}.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"===typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(n){return}const t=e&&a(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info("Unable to get __FIREBASE_DEFAULTS__ due to: ".concat(e))}},h=()=>{var e;return null===(e=l())||void 0===e?void 0:e.config},d=e=>{var t;return null===(t=l())||void 0===t?void 0:t["_".concat(e)]};class f{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"===typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function p(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:"https://securetoken.google.com/".concat(n),aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[o(JSON.stringify({alg:"none",type:"JWT"})),o(JSON.stringify(s)),""].join(".")}function g(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function m(){return"undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(g())}function y(){var e;const t=null===(e=l())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(r){return!1}}function v(){return"object"===typeof self&&self.self===self}function w(){const e="object"===typeof chrome?chrome.runtime:"object"===typeof browser?browser.runtime:void 0;return"object"===typeof e&&void 0!==e.id}function _(){return"object"===typeof navigator&&"ReactNative"===navigator.product}function I(){const e=g();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function b(){return!y()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function T(){try{return"object"===typeof indexedDB}catch(e){return!1}}function E(){return new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(n){t(n)}}))}class S extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,S.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,A.prototype.create)}}class A{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e){const t=(arguments.length<=1?void 0:arguments[1])||{},n="".concat(this.service,"/").concat(e),r=this.errors[e],i=r?function(e,t){return e.replace(C,((e,n)=>{const r=t[n];return null!=r?String(r):"<".concat(n,"?>")}))}(r,t):"Error",s="".concat(this.serviceName,": ").concat(i," (").concat(n,").");return new S(n,s,t)}}const C=/\{\$([^}]+)}/g;function k(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function N(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function D(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(R(n)&&R(s)){if(!D(n,s))return!1}else if(n!==s)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function R(e){return null!==e&&"object"===typeof e}function P(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function x(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t}function O(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function L(e,t){const n=new M(e,t);return n.subscribe.bind(n)}class M{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!==typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"===typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=F),void 0===r.error&&(r.error=F),void 0===r.complete&&(r.complete=F);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}})),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(n){"undefined"!==typeof console&&console.error&&console.error(n)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function F(){}function V(e){return e&&e._delegate?e._delegate:e}},35:(e,t,n)=>{n.d(t,{A:()=>d});var r=n(7700),i=n(8812),s=n(7150),o=n(443);class a{constructor(e,t){this._delegate=e,this.firebase=t,(0,s._addComponent)(e,new i.uA("app-compat",(()=>this),"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise((e=>{this._delegate.checkDestroyed(),e()})).then((()=>(this.firebase.INTERNAL.removeApp(this.name),(0,s.deleteApp)(this._delegate))))}_getService(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s._DEFAULT_ENTRY_NAME;var n;this._delegate.checkDestroyed();const r=this._delegate.container.getProvider(e);return r.isInitialized()||"EXPLICIT"!==(null===(n=r.getComponent())||void 0===n?void 0:n.instantiationMode)||r.initialize(),r.getImmediate({identifier:t})}_removeServiceInstance(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s._DEFAULT_ENTRY_NAME;this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){(0,s._addComponent)(this._delegate,e)}_addOrOverwriteComponent(e){(0,s._addOrOverwriteComponent)(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const c={"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."},u=new r.FA("app-compat","Firebase",c);const l=function e(){const t=function(e){const t={},n={__esModule:!0,initializeApp:function(i){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=s.initializeApp(i,o);if((0,r.gR)(t,a.name))return t[a.name];const c=new e(a,n);return t[a.name]=c,c},app:i,registerVersion:s.registerVersion,setLogLevel:s.setLogLevel,onLog:s.onLog,apps:null,SDK_VERSION:s.SDK_VERSION,INTERNAL:{registerComponent:function(t){const o=t.name,a=o.replace("-compat","");if(s._registerComponent(t)&&"PUBLIC"===t.type){const s=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i();if("function"!==typeof e[a])throw u.create("invalid-app-argument",{appName:o});return e[a]()};void 0!==t.serviceProps&&(0,r.zw)(s,t.serviceProps),n[a]=s,e.prototype[a]=function(){const e=this._getService.bind(this,o);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return e.apply(this,t.multipleInstances?r:[])}}return"PUBLIC"===t.type?n[a]:null},removeApp:function(e){delete t[e]},useAsService:function(e,t){if("serverAuth"===t)return null;return t},modularAPIs:s}};function i(e){if(e=e||s._DEFAULT_ENTRY_NAME,!(0,r.gR)(t,e))throw u.create("no-app",{appName:e});return t[e]}return n.default=n,Object.defineProperty(n,"apps",{get:function(){return Object.keys(t).map((e=>t[e]))}}),i.App=e,n}(a);return t.INTERNAL=Object.assign(Object.assign({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){(0,r.zw)(t,e)},createSubscribe:r.tD,ErrorFactory:r.FA,deepExtend:r.zw}),t}(),h=new o.Vy("@firebase/app-compat");if((0,r.Bd)()&&void 0!==self.firebase){h.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");const e=self.firebase.SDK_VERSION;e&&e.indexOf("LITE")>=0&&h.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}const d=l;var f;(0,s.registerVersion)("@firebase/app-compat","0.2.30",f)},7150:(e,t,n)=>{n.r(t),n.d(t,{FirebaseError:()=>s.g,SDK_VERSION:()=>pe,_DEFAULT_ENTRY_NAME:()=>X,_addComponent:()=>ne,_addOrOverwriteComponent:()=>re,_apps:()=>Z,_clearComponents:()=>ue,_components:()=>te,_getProvider:()=>se,_isFirebaseApp:()=>ae,_isFirebaseServerApp:()=>ce,_registerComponent:()=>ie,_removeServiceInstance:()=>oe,_serverApps:()=>ee,deleteApp:()=>we,getApp:()=>ye,getApps:()=>ve,initializeApp:()=>ge,initializeServerApp:()=>me,onLog:()=>Ie,registerVersion:()=>_e,setLogLevel:()=>be});var r=n(8812),i=n(443),s=n(7700);const o=(e,t)=>t.some((t=>e instanceof t));let a,c;const u=new WeakMap,l=new WeakMap,h=new WeakMap,d=new WeakMap,f=new WeakMap;let p={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return l.get(e);if("objectStoreNames"===t)return e.objectStoreNames||h.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return y(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function g(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(c||(c=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(v(this),n),y(u.get(this))}:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return y(e.apply(v(this),n))}:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];const s=e.call(v(this),t,...r);return h.set(s,t.sort?t.sort():[t]),y(s)}}function m(e){return"function"===typeof e?g(e):(e instanceof IDBTransaction&&function(e){if(l.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)}));l.set(e,t)}(e),o(e,a||(a=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,p):e)}function y(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(y(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&u.set(t,e)})).catch((()=>{})),f.set(t,e),t}(e);if(d.has(e))return d.get(e);const t=m(e);return t!==e&&(d.set(e,t),f.set(t,e)),t}const v=e=>f.get(e);const w=["get","getKey","getAll","getAllKeys","count"],_=["put","add","delete","clear"],I=new Map;function b(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!==typeof t)return;if(I.get(t))return I.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=_.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!w.includes(n))return;const s=async function(e){const t=this.transaction(e,i?"readwrite":"readonly");let s=t.store;for(var o=arguments.length,a=new Array(o>1?o-1:0),c=1;c<o;c++)a[c-1]=arguments[c];return r&&(s=s.index(a.shift())),(await Promise.all([s[n](...a),i&&t.done]))[0]};return I.set(t,s),s}p=(e=>({...e,get:(t,n,r)=>b(t,n)||e.get(t,n,r),has:(t,n)=>!!b(t,n)||e.has(t,n)}))(p);class T{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){const t=e.getImmediate();return"".concat(t.library,"/").concat(t.version)}return null})).filter((e=>e)).join(" ")}}const E="@firebase/app",S="0.10.0",A=new i.Vy("@firebase/app"),C="@firebase/app-compat",k="@firebase/analytics-compat",N="@firebase/analytics",D="@firebase/app-check-compat",R="@firebase/app-check",P="@firebase/auth",x="@firebase/auth-compat",O="@firebase/database",L="@firebase/database-compat",M="@firebase/functions",F="@firebase/functions-compat",V="@firebase/installations",U="@firebase/installations-compat",B="@firebase/messaging",q="@firebase/messaging-compat",j="@firebase/performance",z="@firebase/performance-compat",K="@firebase/remote-config",G="@firebase/remote-config-compat",W="@firebase/storage",H="@firebase/storage-compat",Q="@firebase/firestore",Y="@firebase/firestore-compat",J="firebase",X="[DEFAULT]",$={[E]:"fire-core",[C]:"fire-core-compat",[N]:"fire-analytics",[k]:"fire-analytics-compat",[R]:"fire-app-check",[D]:"fire-app-check-compat",[P]:"fire-auth",[x]:"fire-auth-compat",[O]:"fire-rtdb",[L]:"fire-rtdb-compat",[M]:"fire-fn",[F]:"fire-fn-compat",[V]:"fire-iid",[U]:"fire-iid-compat",[B]:"fire-fcm",[q]:"fire-fcm-compat",[j]:"fire-perf",[z]:"fire-perf-compat",[K]:"fire-rc",[G]:"fire-rc-compat",[W]:"fire-gcs",[H]:"fire-gcs-compat",[Q]:"fire-fst",[Y]:"fire-fst-compat","fire-js":"fire-js",[J]:"fire-js-all"},Z=new Map,ee=new Map,te=new Map;function ne(e,t){try{e.container.addComponent(t)}catch(n){A.debug("Component ".concat(t.name," failed to register with FirebaseApp ").concat(e.name),n)}}function re(e,t){e.container.addOrOverwriteComponent(t)}function ie(e){const t=e.name;if(te.has(t))return A.debug("There were multiple attempts to register component ".concat(t,".")),!1;te.set(t,e);for(const n of Z.values())ne(n,e);for(const n of ee.values())ne(n,e);return!0}function se(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function oe(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X;se(e,t).clearInstance(n)}function ae(e){return void 0!==e.options}function ce(e){return void 0!==e.settings}function ue(){te.clear()}const le={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},he=new s.FA("app","Firebase",le);class de{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new r.uA("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw he.create("app-deleted",{appName:this._name})}}class fe extends de{constructor(e,t,n,r){const i=void 0!==t.automaticDataCollectionEnabled&&t.automaticDataCollectionEnabled,s={name:n,automaticDataCollectionEnabled:i};if(void 0!==e.apiKey)super(e,s,r);else{super(e.options,s,r)}this._serverConfig=Object.assign({automaticDataCollectionEnabled:i},t),this._finalizationRegistry=new FinalizationRegistry((()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,_e(E,S,"serverapp")}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){we(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw he.create("server-app-deleted")}}const pe="10.10.0";function ge(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;if("object"!==typeof t){t={name:t}}const i=Object.assign({name:X,automaticDataCollectionEnabled:!1},t),o=i.name;if("string"!==typeof o||!o)throw he.create("bad-app-name",{appName:String(o)});if(n||(n=(0,s.T9)()),!n)throw he.create("no-options");const a=Z.get(o);if(a){if((0,s.bD)(n,a.options)&&(0,s.bD)(i,a.config))return a;throw he.create("duplicate-app",{appName:o})}const c=new r.h1(o);for(const r of te.values())c.addComponent(r);const u=new de(n,i,c);return Z.set(o,u),u}function me(e,t){if((0,s.Bd)())throw he.create("invalid-server-app-environment");let n;void 0===t.automaticDataCollectionEnabled&&(t.automaticDataCollectionEnabled=!1),n=ae(e)?e.options:e;const i=Object.assign(Object.assign({},t),n);void 0!==i.releaseOnDeref&&delete i.releaseOnDeref;if(void 0!==t.releaseOnDeref&&"undefined"===typeof FinalizationRegistry)throw he.create("finalization-registry-not-supported",{});const o=""+(a=JSON.stringify(i),[...a].reduce(((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0),0));var a;const c=ee.get(o);if(c)return c.incRefCount(t.releaseOnDeref),c;const u=new r.h1(o);for(const r of te.values())u.addComponent(r);const l=new fe(n,t,o,u);return ee.set(o,l),l}function ye(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:X;const t=Z.get(e);if(!t&&e===X&&(0,s.T9)())return ge();if(!t)throw he.create("no-app",{appName:e});return t}function ve(){return Array.from(Z.values())}async function we(e){let t=!1;const n=e.name;if(Z.has(n))t=!0,Z.delete(n);else if(ee.has(n)){e.decRefCount()<=0&&(ee.delete(n),t=!0)}t&&(await Promise.all(e.container.getProviders().map((e=>e.delete()))),e.isDeleted=!0)}function _e(e,t,n){var i;let s=null!==(i=$[e])&&void 0!==i?i:e;n&&(s+="-".concat(n));const o=s.match(/\s|\//),a=t.match(/\s|\//);if(o||a){const e=['Unable to register library "'.concat(s,'" with version "').concat(t,'":')];return o&&e.push('library name "'.concat(s,'" contains illegal characters (whitespace or "/")')),o&&a&&e.push("and"),a&&e.push('version name "'.concat(t,'" contains illegal characters (whitespace or "/")')),void A.warn(e.join(" "))}ie(new r.uA("".concat(s,"-version"),(()=>({library:s,version:t})),"VERSION"))}function Ie(e,t){if(null!==e&&"function"!==typeof e)throw he.create("invalid-log-argument");(0,i.Ey)(e,t)}function be(e){(0,i.He)(e)}const Te="firebase-heartbeat-database",Ee=1,Se="firebase-heartbeat-store";let Ae=null;function Ce(){return Ae||(Ae=function(e,t){let{blocked:n,upgrade:r,blocking:i,terminated:s}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const o=indexedDB.open(e,t),a=y(o);return r&&o.addEventListener("upgradeneeded",(e=>{r(y(o.result),e.oldVersion,e.newVersion,y(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{s&&e.addEventListener("close",(()=>s())),i&&e.addEventListener("versionchange",(e=>i(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}(Te,Ee,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(Se)}catch(n){console.warn(n)}}}).catch((e=>{throw he.create("idb-open",{originalErrorMessage:e.message})}))),Ae}async function ke(e,t){try{const n=(await Ce()).transaction(Se,"readwrite"),r=n.objectStore(Se);await r.put(t,Ne(e)),await n.done}catch(n){if(n instanceof s.g)A.warn(n.message);else{const e=he.create("idb-set",{originalErrorMessage:null===n||void 0===n?void 0:n.message});A.warn(e.message)}}}function Ne(e){return"".concat(e.name,"!").concat(e.options.appId)}class De{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Pe(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){var e,t;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Re();if((null!=(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||(this._heartbeatsCache=await this._heartbeatsCachePromise,null!=(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))&&this._heartbeatsCache.lastSentHeartbeatDate!==r&&!this._heartbeatsCache.heartbeats.some((e=>e.date===r)))return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var e;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=Re(),{heartbeatsToSend:n,unsentEntries:r}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;const n=[];let r=e.slice();for(const i of e){const e=n.find((e=>e.agent===i.agent));if(e){if(e.dates.push(i.date),xe(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),xe(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=(0,s.Uj)(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function Re(){return(new Date).toISOString().substring(0,10)}class Pe{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,s.zW)()&&(0,s.eX)().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await Ce()).transaction(Se),n=await t.objectStore(Se).get(Ne(e));return await t.done,n}catch(t){if(t instanceof s.g)A.warn(t.message);else{const e=he.create("idb-get",{originalErrorMessage:null===t||void 0===t?void 0:t.message});A.warn(e.message)}}}(this.app);return(null===e||void 0===e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return ke(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return ke(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function xe(e){return(0,s.Uj)(JSON.stringify({version:2,heartbeats:e})).length}var Oe;Oe="",ie(new r.uA("platform-logger",(e=>new T(e)),"PRIVATE")),ie(new r.uA("heartbeat",(e=>new De(e)),"PRIVATE")),_e(E,S,Oe),_e(E,S,"esm2017"),_e("fire-js","")},8812:(e,t,n)=>{n.d(t,{h1:()=>a,uA:()=>i});var r=n(7700);class i{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const s="[DEFAULT]";class o{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new r.cY;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(n){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null===e||void 0===e?void 0:e.identifier),r=null!==(t=null===e||void 0===e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error("Service ".concat(this.name," is not available"))}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error("Mismatching Component ".concat(e.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:s})}catch(t){}for(const[e,n]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:r});n.resolve(e)}catch(t){}}}}clearInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s;return this.instances.has(e)}getOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s;return this.instancesOptions.get(e)||{}}initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error("".concat(this.name,"(").concat(n,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[i,s]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(i)&&s.resolve(r)}return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch(r){}}getOrInitializeService(e){let{instanceIdentifier:t,options:n={}}=e,r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(i=t,i===s?void 0:i),options:n}),this.instances.set(t,r),this.instancesOptions.set(t,n),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch(o){}var i;return r||null}normalizeInstanceIdentifier(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s;return this.component?this.component.multipleInstances?e:s:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class a{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component ".concat(e.name," has already been registered with ").concat(this.name));t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new o(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},443:(e,t,n)=>{n.d(t,{$b:()=>i,Ey:()=>h,He:()=>l,Vy:()=>u});const r=[];var i;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(i||(i={}));const s={debug:i.DEBUG,verbose:i.VERBOSE,info:i.INFO,warn:i.WARN,error:i.ERROR,silent:i.SILENT},o=i.INFO,a={[i.DEBUG]:"log",[i.VERBOSE]:"log",[i.INFO]:"info",[i.WARN]:"warn",[i.ERROR]:"error"},c=function(e,t){if(t<e.logLevel)return;const n=(new Date).toISOString(),r=a[t];if(!r)throw new Error("Attempted to log a message with an invalid logType (value: ".concat(t,")"));for(var i=arguments.length,s=new Array(i>2?i-2:0),o=2;o<i;o++)s[o-2]=arguments[o];console[r]("[".concat(n,"]  ").concat(e.name,":"),...s)};class u{constructor(e){this.name=e,this._logLevel=o,this._logHandler=c,this._userLogHandler=null,r.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in i))throw new TypeError('Invalid value "'.concat(e,'" assigned to `logLevel`'));this._logLevel=e}setLogLevel(e){this._logLevel="string"===typeof e?s[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,i.DEBUG,...t),this._logHandler(this,i.DEBUG,...t)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,i.VERBOSE,...t),this._logHandler(this,i.VERBOSE,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,i.INFO,...t),this._logHandler(this,i.INFO,...t)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,i.WARN,...t),this._logHandler(this,i.WARN,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,i.ERROR,...t),this._logHandler(this,i.ERROR,...t)}}function l(e){r.forEach((t=>{t.setLogLevel(e)}))}function h(e,t){for(const n of r){let r=null;t&&t.level&&(r=s[t.level]),n.userLogHandler=null===e?null:function(t,n){for(var s=arguments.length,o=new Array(s>2?s-2:0),a=2;a<s;a++)o[a-2]=arguments[a];const c=o.map((e=>{if(null==e)return null;if("string"===typeof e)return e;if("number"===typeof e||"boolean"===typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(t){return null}})).filter((e=>e)).join(" ");n>=(null!==r&&void 0!==r?r:t.logLevel)&&e({level:i[n].toLowerCase(),message:c,args:o,type:t.name})}}}},5016:(e,t,n)=>{n(3397),n(7150),n(7700),n(443),n(8812)},8289:(e,t,n)=>{n.d(t,{A:()=>r.A});var r=n(35);r.A.registerVersion("firebase","10.10.0","app-compat")},199:(e,t,n)=>{var r=n(35),i=n(3397),s=n(7700),o=(n(7150),n(443),n(8812));function a(){return window}async function c(e,t,n){var r;const{BuildInfo:s}=a();(0,i.au)(t.sessionId,"AuthEvent did not contain a session ID");const o=await async function(e){const t=function(e){if((0,i.au)(/[0-9a-zA-Z]+/.test(e),"Can only convert alpha-numeric strings"),"undefined"!==typeof TextEncoder)return(new TextEncoder).encode(e);const t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n}(e),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map((e=>e.toString(16).padStart(2,"0"))).join("")}(t.sessionId),c={};return(0,i.av)()?c.ibi=s.packageName:(0,i.aw)()?c.apn=s.packageName:(0,i.ax)(e,"operation-not-supported-in-this-environment"),s.displayName&&(c.appDisplayName=s.displayName),c.sessionId=o,(0,i.ay)(e,n,t.type,void 0,null!==(r=t.eventId)&&void 0!==r?r:void 0,c)}const u=20;class l extends i.aD{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise((e=>{this.resolveInialized=e}))}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(e){return this.resolveInialized(),this.passiveListeners.forEach((t=>t(e))),super.onEvent(e)}async initialized(){await this.initPromise}}async function h(e){const t=await p()._get(g(e));return t&&await p()._remove(g(e)),t}function d(e,t){var n,r;const s=function(e){const t=m(e),n=t.link?decodeURIComponent(t.link):void 0,r=m(n).link,i=t.deep_link_id?decodeURIComponent(t.deep_link_id):void 0;return m(i).link||i||r||n||e}(t);if(s.includes("/__/auth/callback")){const t=m(s),o=t.firebaseError?function(e){try{return JSON.parse(e)}catch(t){return null}}(decodeURIComponent(t.firebaseError)):null,a=null===(r=null===(n=null===o||void 0===o?void 0:o.code)||void 0===n?void 0:n.split("auth/"))||void 0===r?void 0:r[1],c=a?(0,i.aB)(a):null;return c?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:c,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:s,postBody:null}}return null}function f(){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let n=0;n<u;n++){const n=Math.floor(62*Math.random());e.push(t.charAt(n))}return e.join("")}function p(){return(0,i.aE)(i.b)}function g(e){return(0,i.aF)("authEvent",e.config.apiKey,e.name)}function m(e){if(!(null===e||void 0===e?void 0:e.includes("?")))return{};const[t,...n]=e.split("?");return(0,s.I9)(n.join("?"))}const y=class{constructor(){this._redirectPersistence=i.a,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=i.aG,this._overrideRedirectResult=i.aH}async _initialize(e){const t=e._key();let n=this.eventManagers.get(t);return n||(n=new l(e),this.eventManagers.set(t,n),this.attachCallbackListeners(e,n)),n}_openPopup(e){(0,i.ax)(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,n,r){!function(e){var t,n,r,s,o,c,u,l,h,d;const f=a();(0,i.aC)("function"===typeof(null===(t=null===f||void 0===f?void 0:f.universalLinks)||void 0===t?void 0:t.subscribe),e,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),(0,i.aC)("undefined"!==typeof(null===(n=null===f||void 0===f?void 0:f.BuildInfo)||void 0===n?void 0:n.packageName),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),(0,i.aC)("function"===typeof(null===(o=null===(s=null===(r=null===f||void 0===f?void 0:f.cordova)||void 0===r?void 0:r.plugins)||void 0===s?void 0:s.browsertab)||void 0===o?void 0:o.openUrl),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),(0,i.aC)("function"===typeof(null===(l=null===(u=null===(c=null===f||void 0===f?void 0:f.cordova)||void 0===c?void 0:c.plugins)||void 0===u?void 0:u.browsertab)||void 0===l?void 0:l.isAvailable),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),(0,i.aC)("function"===typeof(null===(d=null===(h=null===f||void 0===f?void 0:f.cordova)||void 0===h?void 0:h.InAppBrowser)||void 0===d?void 0:d.open),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(e);const s=await this._initialize(e);await s.initialized(),s.resetRedirect(),(0,i.aI)(),await this._originValidation(e);const o=function(e,t){return{type:t,eventId:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,urlResponse:null,sessionId:f(),postBody:null,tenantId:e.tenantId,error:(0,i.aB)(e,"no-auth-event")}}(e,n,r);await function(e,t){return p()._set(g(e),t)}(e,o);const u=await c(e,o,t);return async function(e,t,n){const{cordova:r}=a();let s=()=>{};try{await new Promise(((o,a)=>{let c=null;function u(){var e;o();const t=null===(e=r.plugins.browsertab)||void 0===e?void 0:e.close;"function"===typeof t&&t(),"function"===typeof(null===n||void 0===n?void 0:n.close)&&n.close()}function l(){c||(c=window.setTimeout((()=>{a((0,i.aB)(e,"redirect-cancelled-by-user"))}),2e3))}function h(){"visible"===(null===document||void 0===document?void 0:document.visibilityState)&&l()}t.addPassiveListener(u),document.addEventListener("resume",l,!1),(0,i.aw)()&&document.addEventListener("visibilitychange",h,!1),s=()=>{t.removePassiveListener(u),document.removeEventListener("resume",l,!1),document.removeEventListener("visibilitychange",h,!1),c&&window.clearTimeout(c)}}))}finally{s()}}(e,s,await function(e){const{cordova:t}=a();return new Promise((n=>{t.plugins.browsertab.isAvailable((r=>{let s=null;r?t.plugins.browsertab.openUrl(e):s=t.InAppBrowser.open(e,(0,i.aA)()?"_blank":"_system","location=yes"),n(s)}))}))}(u))}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){const{BuildInfo:t}=a(),n={};(0,i.av)()?n.iosBundleId=t.packageName:(0,i.aw)()?n.androidPackageName=t.packageName:(0,i.ax)(e,"operation-not-supported-in-this-environment"),await(0,i.az)(e,n)}(e)),this.originValidationPromises[t]}attachCallbackListeners(e,t){const{universalLinks:n,handleOpenURL:r,BuildInfo:i}=a(),s=setTimeout((async()=>{await h(e),t.onEvent(v())}),500),o=async n=>{clearTimeout(s);const r=await h(e);let i=null;r&&(null===n||void 0===n?void 0:n.url)&&(i=d(r,n.url)),t.onEvent(i||v())};"undefined"!==typeof n&&"function"===typeof n.subscribe&&n.subscribe(null,o);const c=r,u="".concat(i.packageName.toLowerCase(),"://");a().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(u)&&o({url:e}),"function"===typeof c)try{c(e)}catch(t){console.error(t)}}}};function v(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:(0,i.aB)("no-auth-event")}}function w(){var e;return(null===(e=null===self||void 0===self?void 0:self.location)||void 0===e?void 0:e.protocol)||null}function _(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,s.ZQ)();return!("file:"!==w()&&"ionic:"!==w()&&"capacitor:"!==w()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function I(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,s.ZQ)();return(0,s.lT)()&&11===(null===document||void 0===document?void 0:document.documentMode)||function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,s.ZQ)();return/Edge\/\d+/.test(e)}(e)}function b(){try{const e=self.localStorage,t=i.aN();if(e)return e.setItem(t,"1"),e.removeItem(t),!I()||(0,s.zW)()}catch(e){return T()&&(0,s.zW)()}return!1}function T(){return"undefined"!==typeof n.g&&"WorkerGlobalScope"in n.g&&"importScripts"in n.g}function E(){return("http:"===w()||"https:"===w()||(0,s.sr)()||_())&&!((0,s.lV)()||(0,s.Ll)())&&b()&&!T()}function S(){return _()&&"undefined"!==typeof document}const A={LOCAL:"local",NONE:"none",SESSION:"session"},C=i.aC,k="persistence";async function N(e){await e._initializationPromise;const t=D(),n=i.aF(k,e.config.apiKey,e.name);t&&t.setItem(n,e._getPersistence())}function D(){var e;try{return(null===(e="undefined"!==typeof window?window:null)||void 0===e?void 0:e.sessionStorage)||null}catch(t){return null}}const R=i.aC;class P{constructor(){this.browserResolver=i.aE(i.k),this.cordovaResolver=i.aE(y),this.underlyingResolver=null,this._redirectPersistence=i.a,this._completeRedirectFn=i.aG,this._overrideRedirectResult=i.aH}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,n,r)}async _openRedirect(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,n,r)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return S()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return R(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){if(this.underlyingResolver)return;const e=await async function(){return!!S()&&new Promise((e=>{const t=setTimeout((()=>{e(!1)}),1e3);document.addEventListener("deviceready",(()=>{clearTimeout(t),e(!0)}))}))}();this.underlyingResolver=e?this.cordovaResolver:this.browserResolver}}function x(e){return e.unwrap()}function O(e){const{_tokenResponse:t}=e instanceof s.g?e.customData:e;if(!t)return null;if(!(e instanceof s.g)&&"temporaryProof"in t&&"phoneNumber"in t)return i.P.credentialFromResult(e);const n=t.providerId;if(!n||n===i.p.PASSWORD)return null;let r;switch(n){case i.p.GOOGLE:r=i.X;break;case i.p.FACEBOOK:r=i.W;break;case i.p.GITHUB:r=i.Y;break;case i.p.TWITTER:r=i.$;break;default:const{oauthIdToken:e,oauthAccessToken:s,oauthTokenSecret:o,pendingToken:a,nonce:c}=t;return s||o||e||a?a?n.startsWith("saml.")?i.aQ._create(n,a):i.N._fromParams({providerId:n,signInMethod:n,pendingToken:a,idToken:e,accessToken:s}):new i.Z(n).credential({idToken:e,accessToken:s,rawNonce:c}):null}return e instanceof s.g?r.credentialFromError(e):r.credentialFromResult(e)}function L(e,t){return t.catch((t=>{throw t instanceof s.g&&function(e,t){var n;const r=null===(n=t.customData)||void 0===n?void 0:n._tokenResponse;if("auth/multi-factor-auth-required"===(null===t||void 0===t?void 0:t.code))t.resolver=new F(e,i.as(e,t));else if(r){const e=O(t),n=t;e&&(n.credential=e,n.tenantId=r.tenantId||void 0,n.email=r.email||void 0,n.phoneNumber=r.phoneNumber||void 0)}}(e,t),t})).then((e=>{const t=e.operationType,n=e.user;return{operationType:t,credential:(r=e,O(r)),additionalUserInfo:i.aq(e),user:V.getOrCreate(n)};var r}))}async function M(e,t){const n=await t;return{verificationId:n.verificationId,confirm:t=>L(e,n.confirm(t))}}class F{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return L(x(this.auth),this.resolver.resolveSignIn(e))}}class V{constructor(e){this._delegate=e,this.multiFactor=i.at(e)}static getOrCreate(e){return V.USER_MAP.has(e)||V.USER_MAP.set(e,new V(e)),V.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return L(this.auth,i.a2(this._delegate,e))}async linkWithPhoneNumber(e,t){return M(this.auth,i.l(this._delegate,e,t))}async linkWithPopup(e){return L(this.auth,i.d(this._delegate,e,P))}async linkWithRedirect(e){return await N(i.aJ(this.auth)),i.g(this._delegate,e,P)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return L(this.auth,i.a3(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return M(this.auth,i.r(this._delegate,e,t))}reauthenticateWithPopup(e){return L(this.auth,i.e(this._delegate,e,P))}async reauthenticateWithRedirect(e){return await N(i.aJ(this.auth)),i.h(this._delegate,e,P)}sendEmailVerification(e){return i.ag(this._delegate,e)}async unlink(e){return await i.ap(this._delegate,e),this}updateEmail(e){return i.al(this._delegate,e)}updatePassword(e){return i.am(this._delegate,e)}updatePhoneNumber(e){return i.u(this._delegate,e)}updateProfile(e){return i.ak(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return i.ah(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}V.USER_MAP=new WeakMap;const U=i.aC;class B{constructor(e,t){if(this.app=e,t.isInitialized())return this._delegate=t.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:n}=e.options;U(n,"invalid-api-key",{appName:e.name}),U(n,"invalid-api-key",{appName:e.name});const r="undefined"!==typeof window?P:void 0;this._delegate=t.initialize({options:{persistence:j(n,e.name),popupRedirectResolver:r}}),this._delegate._updateErrorMap(i.G),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?V.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){i.K(this._delegate,e,t)}applyActionCode(e){return i.a7(this._delegate,e)}checkActionCode(e){return i.a8(this._delegate,e)}confirmPasswordReset(e,t){return i.a6(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return L(this._delegate,i.aa(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return i.af(this._delegate,e)}isSignInWithEmailLink(e){return i.ad(this._delegate,e)}async getRedirectResult(){U(E(),this._delegate,"operation-not-supported-in-this-environment");const e=await i.j(this._delegate,P);return e?L(this._delegate,Promise.resolve(e)):{credential:null,user:null}}addFrameworkForLogging(e){!function(e,t){(0,i.aJ)(e)._logFramework(t)}(this._delegate,e)}onAuthStateChanged(e,t,n){const{next:r,error:i,complete:s}=q(e,t,n);return this._delegate.onAuthStateChanged(r,i,s)}onIdTokenChanged(e,t,n){const{next:r,error:i,complete:s}=q(e,t,n);return this._delegate.onIdTokenChanged(r,i,s)}sendSignInLinkToEmail(e,t){return i.ac(this._delegate,e,t)}sendPasswordResetEmail(e,t){return i.a5(this._delegate,e,t||void 0)}async setPersistence(e){let t;switch(function(e,t){C(Object.values(A).includes(t),e,"invalid-persistence-type"),(0,s.lV)()?C(t!==A.SESSION,e,"unsupported-persistence-type"):(0,s.Ll)()?C(t===A.NONE,e,"unsupported-persistence-type"):T()?C(t===A.NONE||t===A.LOCAL&&(0,s.zW)(),e,"unsupported-persistence-type"):C(t===A.NONE||b(),e,"unsupported-persistence-type")}(this._delegate,e),e){case A.SESSION:t=i.a;break;case A.LOCAL:t=await i.aE(i.i)._isAvailable()?i.i:i.b;break;case A.NONE:t=i.U;break;default:return i.ax("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(t)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return L(this._delegate,i.a0(this._delegate))}signInWithCredential(e){return L(this._delegate,i.a1(this._delegate,e))}signInWithCustomToken(e){return L(this._delegate,i.a4(this._delegate,e))}signInWithEmailAndPassword(e,t){return L(this._delegate,i.ab(this._delegate,e,t))}signInWithEmailLink(e,t){return L(this._delegate,i.ae(this._delegate,e,t))}signInWithPhoneNumber(e,t){return M(this._delegate,i.s(this._delegate,e,t))}async signInWithPopup(e){return U(E(),this._delegate,"operation-not-supported-in-this-environment"),L(this._delegate,i.c(this._delegate,e,P))}async signInWithRedirect(e){return U(E(),this._delegate,"operation-not-supported-in-this-environment"),await N(this._delegate),i.f(this._delegate,e,P)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return i.a9(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function q(e,t,n){let r=e;"function"!==typeof e&&({next:r,error:t,complete:n}=e);const i=r;return{next:e=>i(e&&V.getOrCreate(e)),error:t,complete:n}}function j(e,t){const n=function(e,t){const n=D();if(!n)return[];const r=i.aF(k,e,t);switch(n.getItem(r)){case A.NONE:return[i.U];case A.LOCAL:return[i.i,i.a];case A.SESSION:return[i.a];default:return[]}}(e,t);if("undefined"===typeof self||n.includes(i.i)||n.push(i.i),"undefined"!==typeof window)for(const r of[i.b,i.a])n.includes(r)||n.push(r);return n.includes(i.U)||n.push(i.U),n}B.Persistence=A;class z{constructor(){this.providerId="phone",this._delegate=new i.P(x(r.A.auth()))}static credential(e,t){return i.P.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}z.PHONE_SIGN_IN_METHOD=i.P.PHONE_SIGN_IN_METHOD,z.PROVIDER_ID=i.P.PROVIDER_ID;const K=i.aC;class G{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.A.app();var s;K(null===(s=n.options)||void 0===s?void 0:s.apiKey,"invalid-api-key",{appName:n.name}),this._delegate=new i.R(n.auth(),e,t),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}var W;(W=r.A).INTERNAL.registerComponent(new o.uA("auth-compat",(e=>{const t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("auth");return new B(t,n)}),"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:i.A.EMAIL_SIGNIN,PASSWORD_RESET:i.A.PASSWORD_RESET,RECOVER_EMAIL:i.A.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:i.A.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:i.A.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:i.A.VERIFY_EMAIL}},EmailAuthProvider:i.V,FacebookAuthProvider:i.W,GithubAuthProvider:i.Y,GoogleAuthProvider:i.X,OAuthProvider:i.Z,SAMLAuthProvider:i._,PhoneAuthProvider:z,PhoneMultiFactorGenerator:i.m,RecaptchaVerifier:G,TwitterAuthProvider:i.$,Auth:B,AuthCredential:i.L,Error:s.g}).setInstantiationMode("LAZY").setMultipleInstances(!1)),W.registerVersion("@firebase/auth-compat","0.5.5")},2465:(e,t,n)=>{var r,i=n(35),s=n(7150),o=n(8812),a=n(443),c=n(7700),u="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},l={},h=h||{},d=u||self;function f(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function p(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var g="closure_uid_"+(1e9*Math.random()>>>0),m=0;function y(e,t,n){return e.call.apply(e.bind,arguments)}function v(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function w(e,t,n){return(w=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?y:v).apply(null,arguments)}function _(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function I(e,t){function n(){}n.prototype=t.prototype,e.$=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.ac=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function b(){this.s=this.s,this.o=this.o}b.prototype.s=!1,b.prototype.sa=function(){var e;!this.s&&(this.s=!0,this.N(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,g)&&e[g]||(e[g]=++m))},b.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const T=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"===typeof e)return"string"!==typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function E(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function S(e,t){for(let n=1;n<arguments.length;n++){const t=arguments[n];if(f(t)){const n=e.length||0,r=t.length||0;e.length=n+r;for(let i=0;i<r;i++)e[n+i]=t[i]}else e.push(t)}}function A(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}A.prototype.h=function(){this.defaultPrevented=!0};var C=function(){if(!d.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};d.addEventListener("test",e,t),d.removeEventListener("test",e,t)}catch(n){}return e}();function k(e){return/^[\s\xa0]*$/.test(e)}function N(){var e=d.navigator;return e&&(e=e.userAgent)?e:""}function D(e){return-1!=N().indexOf(e)}function R(e){return R[" "](e),e}R[" "]=function(){};var P,x,O=D("Opera"),L=D("Trident")||D("MSIE"),M=D("Edge"),F=M||L,V=D("Gecko")&&!(-1!=N().toLowerCase().indexOf("webkit")&&!D("Edge"))&&!(D("Trident")||D("MSIE"))&&!D("Edge"),U=-1!=N().toLowerCase().indexOf("webkit")&&!D("Edge");function B(){var e=d.document;return e?e.documentMode:void 0}e:{var q="",j=function(){var e=N();return V?/rv:([^\);]+)(\)|;)/.exec(e):M?/Edge\/([\d\.]+)/.exec(e):L?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e):U?/WebKit\/(\S+)/.exec(e):O?/(?:Version)[ \/]?(\S+)/.exec(e):void 0}();if(j&&(q=j?j[1]:""),L){var z=B();if(null!=z&&z>parseFloat(q)){P=String(z);break e}}P=q}if(d.document&&L){var K=B();x=K||(parseInt(P,10)||void 0)}else x=void 0;var G=x;function W(e,t){if(A.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(V){e:{try{R(t.nodeName);var i=!0;break e}catch(s){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"===typeof e.pointerType?e.pointerType:H[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&W.$.h.call(this)}}I(W,A);var H={2:"touch",3:"pen",4:"mouse"};W.prototype.h=function(){W.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var Q="closure_listenable_"+(1e6*Math.random()|0),Y=0;function J(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.la=i,this.key=++Y,this.fa=this.ia=!1}function X(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function $(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function Z(e){const t={};for(const n in e)t[n]=e[n];return t}const ee="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function te(e,t){let n,r;for(let i=1;i<arguments.length;i++){for(n in r=arguments[i],r)e[n]=r[n];for(let t=0;t<ee.length;t++)n=ee[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function ne(e){this.src=e,this.g={},this.h=0}function re(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=T(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(X(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function ie(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.fa&&s.listener==t&&s.capture==!!n&&s.la==r)return i}return-1}ne.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=ie(e,t,r,i);return-1<o?(t=e[o],n||(t.ia=!1)):((t=new J(t,this.src,s,!!r,i)).ia=n,e.push(t)),t};var se="closure_lm_"+(1e6*Math.random()|0),oe={};function ae(e,t,n,r,i){if(r&&r.once)return ue(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)ae(e,t[s],n,r,i);return null}return n=me(n),e&&e[Q]?e.O(t,n,p(r)?!!r.capture:!!r,i):ce(e,t,n,!1,r,i)}function ce(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=p(i)?!!i.capture:!!i,a=pe(e);if(a||(e[se]=a=new ne(e)),(n=a.add(t,n,r,o,s)).proxy)return n;if(r=function(){function e(n){return t.call(e.src,e.listener,n)}const t=fe;return e}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)C||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(de(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function ue(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)ue(e,t[s],n,r,i);return null}return n=me(n),e&&e[Q]?e.P(t,n,p(r)?!!r.capture:!!r,i):ce(e,t,n,!0,r,i)}function le(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)le(e,t[s],n,r,i);else r=p(r)?!!r.capture:!!r,n=me(n),e&&e[Q]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(n=ie(s=e.g[t],n,r,i))&&(X(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--)))):e&&(e=pe(e))&&(t=e.g[t.toString()],e=-1,t&&(e=ie(t,n,r,i)),(n=-1<e?t[e]:null)&&he(n))}function he(e){if("number"!==typeof e&&e&&!e.fa){var t=e.src;if(t&&t[Q])re(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(de(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=pe(t))?(re(n,e),0==n.h&&(n.src=null,t[se]=null)):X(e)}}}function de(e){return e in oe?oe[e]:oe[e]="on"+e}function fe(e,t){if(e.fa)e=!0;else{t=new W(t,this);var n=e.listener,r=e.la||e.src;e.ia&&he(e),e=n.call(r,t)}return e}function pe(e){return(e=e[se])instanceof ne?e:null}var ge="__closure_events_fn_"+(1e9*Math.random()>>>0);function me(e){return"function"===typeof e?e:(e[ge]||(e[ge]=function(t){return e.handleEvent(t)}),e[ge])}function ye(){b.call(this),this.i=new ne(this),this.S=this,this.J=null}function ve(e,t){var n,r=e.J;if(r)for(n=[];r;r=r.J)n.push(r);if(e=e.S,r=t.type||t,"string"===typeof t)t=new A(t,e);else if(t instanceof A)t.target=t.target||e;else{var i=t;te(t=new A(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=we(o,r,!0,t)&&i}if(i=we(o=t.g=e,r,!0,t)&&i,i=we(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=we(o=t.g=n[s],r,!1,t)&&i}function we(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&re(e.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}I(ye,b),ye.prototype[Q]=!0,ye.prototype.removeEventListener=function(e,t,n,r){le(this,e,t,n,r)},ye.prototype.N=function(){if(ye.$.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)X(n[r]);delete t.g[e],t.h--}}this.J=null},ye.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},ye.prototype.P=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var _e=d.JSON.stringify;function Ie(){var e=ke;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var be=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new Te),(e=>e.reset()));class Te{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Ee(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function Se(e){d.setTimeout((()=>{throw e}),0)}let Ae,Ce=!1,ke=new class{constructor(){this.h=this.g=null}add(e,t){const n=be.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},Ne=()=>{const e=d.Promise.resolve(void 0);Ae=()=>{e.then(De)}};var De=()=>{for(var e;e=Ie();){try{e.h.call(e.g)}catch(n){Se(n)}var t=be;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Ce=!1};function Re(e,t){ye.call(this),this.h=e||1,this.g=t||d,this.j=w(this.qb,this),this.l=Date.now()}function Pe(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}function xe(e,t,n){if("function"===typeof e)n&&(e=w(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=w(e.handleEvent,e)}return 2147483647<Number(t)?-1:d.setTimeout(e,t||0)}function Oe(e){e.g=xe((()=>{e.g=null,e.i&&(e.i=!1,Oe(e))}),e.j);const t=e.h;e.h=null,e.m.apply(null,t)}I(Re,ye),(r=Re.prototype).ga=!1,r.T=null,r.qb=function(){if(this.ga){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),ve(this,"tick"),this.ga&&(Pe(this),this.start()))}},r.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},r.N=function(){Re.$.N.call(this),Pe(this),delete this.g};class Le extends b{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Oe(this)}N(){super.N(),this.g&&(d.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Me(e){b.call(this),this.h=e,this.g={}}I(Me,b);var Fe=[];function Ve(e,t,n,r){Array.isArray(n)||(n&&(Fe[0]=n.toString()),n=Fe);for(var i=0;i<n.length;i++){var s=ae(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function Ue(e){$(e.g,(function(e,t){this.g.hasOwnProperty(t)&&he(e)}),e),e.g={}}function Be(){this.g=!0}function qe(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return _e(n)}catch(a){return t}}(e,n)+(r?" "+r:"")}))}Me.prototype.N=function(){Me.$.N.call(this),Ue(this)},Me.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Be.prototype.Ea=function(){this.g=!1},Be.prototype.info=function(){};var je={},ze=null;function Ke(){return ze=ze||new ye}function Ge(e){A.call(this,je.Ta,e)}function We(e){const t=Ke();ve(t,new Ge(t))}function He(e,t){A.call(this,je.STAT_EVENT,e),this.stat=t}function Qe(e){const t=Ke();ve(t,new He(t,e))}function Ye(e,t){A.call(this,je.Ua,e),this.size=t}function Je(e,t){if("function"!==typeof e)throw Error("Fn must not be null and must be a function");return d.setTimeout((function(){e()}),t)}je.Ta="serverreachability",I(Ge,A),je.STAT_EVENT="statevent",I(He,A),je.Ua="timingevent",I(Ye,A);var Xe={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},$e={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Ze(){}function et(e){return e.h||(e.h=e.i())}function tt(){}Ze.prototype.h=null;var nt,rt={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function it(){A.call(this,"d")}function st(){A.call(this,"c")}function ot(){}function at(e,t,n,r){this.l=e,this.j=t,this.m=n,this.W=r||1,this.U=new Me(this),this.P=ut,e=F?125:void 0,this.V=new Re(e),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new ct}function ct(){this.i=null,this.g="",this.h=!1}I(it,A),I(st,A),I(ot,Ze),ot.prototype.g=function(){return new XMLHttpRequest},ot.prototype.i=function(){return{}},nt=new ot;var ut=45e3,lt={},ht={};function dt(e,t,n){e.L=1,e.A=Rt(At(t)),e.u=n,e.S=!0,ft(e,null)}function ft(e,t){e.G=Date.now(),yt(e),e.B=At(e.A);var n=e.B,r=e.W;Array.isArray(r)||(r=[String(r)]),Kt(n.i,"t",r),e.o=0,n=e.l.J,e.h=new ct,e.g=Wn(e.l,n?t:null,!e.u),0<e.O&&(e.M=new Le(w(e.Pa,e,e.g),e.O)),Ve(e.U,e.g,"readystatechange",e.nb),t=e.I?Z(e.I):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.B,e.v,e.u,t)):(e.v="GET",e.g.ha(e.B,e.v,null,t)),We(),function(e,t,n,r,i,s){e.info((function(){if(e.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+u+"&":o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.v,e.B,e.m,e.W,e.u)}function pt(e){return!!e.g&&("GET"==e.v&&2!=e.L&&e.l.Ha)}function gt(e,t,n){let r,i=!0;for(;!e.J&&e.o<n.length;){if(r=mt(e,n),r==ht){4==t&&(e.s=4,Qe(14),i=!1),qe(e.j,e.m,null,"[Incomplete Response]");break}if(r==lt){e.s=4,Qe(15),qe(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}qe(e.j,e.m,r,null),bt(e,r)}pt(e)&&0!=e.o&&(e.h.g=e.h.g.slice(e.o),e.o=0),4!=t||0!=n.length||e.h.h||(e.s=1,Qe(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.ba&&(e.ba=!0,(t=e.l).g==e&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),Vn(t),t.M=!0,Qe(11))):(qe(e.j,e.m,n,"[Invalid Chunked Response]"),It(e),_t(e))}function mt(e,t){var n=e.o,r=t.indexOf("\n",n);return-1==r?ht:(n=Number(t.substring(n,r)),isNaN(n)?lt:(r+=1)+n>t.length?ht:(t=t.slice(r,r+n),e.o=r+n,t))}function yt(e){e.Y=Date.now()+e.P,vt(e,e.P)}function vt(e,t){if(null!=e.C)throw Error("WatchDog timer not null");e.C=Je(w(e.lb,e),t)}function wt(e){e.C&&(d.clearTimeout(e.C),e.C=null)}function _t(e){0==e.l.H||e.J||qn(e.l,e)}function It(e){wt(e);var t=e.M;t&&"function"==typeof t.sa&&t.sa(),e.M=null,Pe(e.V),Ue(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.sa())}function bt(e,t){try{var n=e.l;if(0!=n.H&&(n.g==e||Xt(n.i,e)))if(!e.K&&Xt(n.i,e)&&3==n.H){try{var r=n.Ja.g.parse(t)}catch(u){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.G+3e3<e.G))break e;Bn(n),Dn(n)}Fn(n),Qe(18)}}else n.Fa=i[1],0<n.Fa-n.V&&37500>i[2]&&n.G&&0==n.A&&!n.v&&(n.v=Je(w(n.ib,n),6e3));if(1>=Jt(n.i)&&n.oa){try{n.oa()}catch(u){}n.oa=void 0}}else zn(n,11)}else if((e.K||n.g==e)&&Bn(n),!k(t))for(i=n.Ja.g.parse(t),t=0;t<i.length;t++){let u=i[t];if(n.V=u[0],u=u[1],2==n.H)if("c"==u[0]){n.K=u[1],n.pa=u[2];const t=u[3];null!=t&&(n.ra=t,n.l.info("VER="+n.ra));const i=u[4];null!=i&&(n.Ga=i,n.l.info("SVER="+n.Ga));const l=u[5];null!=l&&"number"===typeof l&&0<l&&(r=1.5*l,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.i;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&($t(s,s.h),s.h=null))}if(r.F){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.Da=e,Dt(r.I,r.F,e))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-e.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=e;if((r=n).wa=Gn(r,r.J?r.pa:null,r.Y),o.K){Zt(r.i,o);var a=o,c=r.L;c&&a.setTimeout(c),a.C&&(wt(a),yt(a)),r.g=o}else Mn(r);0<n.j.length&&Pn(n)}else"stop"!=u[0]&&"close"!=u[0]||zn(n,7);else 3==n.H&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?zn(n,7):Nn(n):"noop"!=u[0]&&n.h&&n.h.Aa(u),n.A=0)}We()}catch(u){}}function Tt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(f(e)||"string"===typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.ta&&"function"==typeof e.ta)return e.ta();if(!e.Z||"function"!=typeof e.Z){if("undefined"!==typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!==typeof Set&&e instanceof Set)){if(f(e)||"string"===typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.Z&&"function"==typeof e.Z)return e.Z();if("undefined"!==typeof Map&&e instanceof Map||"undefined"!==typeof Set&&e instanceof Set)return Array.from(e.values());if("string"===typeof e)return e.split("");if(f(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}(r=at.prototype).setTimeout=function(e){this.P=e},r.nb=function(e){e=e.target;const t=this.M;t&&3==Tn(e)?t.l():this.Pa(e)},r.Pa=function(e){try{if(e==this.g)e:{const l=Tn(this.g);var t=this.g.Ia();this.g.da();if(!(3>l)&&(3!=l||F||this.g&&(this.h.h||this.g.ja()||En(this.g)))){this.J||4!=l||7==t||We(),wt(this);var n=this.g.da();this.ca=n;t:if(pt(this)){var r=En(this.g);e="";var i=r.length,s=4==Tn(this.g);if(!this.h.i){if("undefined"===typeof TextDecoder){It(this),_t(this);var o="";break t}this.h.i=new d.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.length=0,this.h.g+=e,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(e,t,n,r,i,s,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o}))}(this.j,this.v,this.B,this.m,this.W,l,n),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!k(a)){var u=a;break t}}u=null}if(!(n=u)){this.i=!1,this.s=3,Qe(12),It(this),_t(this);break e}qe(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,bt(this,n)}this.S?(gt(this,l,o),F&&this.i&&3==l&&(Ve(this.U,this.V,"tick",this.mb),this.V.start())):(qe(this.j,this.m,o,null),bt(this,o)),4==l&&It(this),this.i&&!this.J&&(4==l?qn(this.l,this):(this.i=!1,yt(this)))}else(function(e){const t={};e=(e.g&&2<=Tn(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(k(e[r]))continue;var n=Ee(e[r]);const i=n[0];if("string"!==typeof(n=n[1]))continue;n=n.trim();const s=t[i]||[];t[i]=s,s.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.s=3,Qe(12)):(this.s=0,Qe(13)),It(this),_t(this)}}}catch(l){}},r.mb=function(){if(this.g){var e=Tn(this.g),t=this.g.ja();this.o<t.length&&(wt(this),gt(this,e,t),this.i&&4!=e&&yt(this))}},r.cancel=function(){this.J=!0,It(this)},r.lb=function(){this.C=null;const e=Date.now();0<=e-this.Y?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.B),2!=this.L&&(We(),Qe(17)),It(this),this.s=2,_t(this)):vt(this,this.Y-e)};var Et=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function St(e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof St){this.h=e.h,Ct(this,e.j),this.s=e.s,this.g=e.g,kt(this,e.m),this.l=e.l;var t=e.i,n=new Bt;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),Nt(this,n),this.o=e.o}else e&&(t=String(e).match(Et))?(this.h=!1,Ct(this,t[1]||"",!0),this.s=Pt(t[2]||""),this.g=Pt(t[3]||"",!0),kt(this,t[4]),this.l=Pt(t[5]||"",!0),Nt(this,t[6]||"",!0),this.o=Pt(t[7]||"")):(this.h=!1,this.i=new Bt(null,this.h))}function At(e){return new St(e)}function Ct(e,t,n){e.j=n?Pt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function kt(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function Nt(e,t,n){t instanceof Bt?(e.i=t,function(e,t){t&&!e.j&&(qt(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(jt(this,t),Kt(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=xt(t,Vt)),e.i=new Bt(t,e.h))}function Dt(e,t,n){e.i.set(t,n)}function Rt(e){return Dt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Pt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function xt(e,t,n){return"string"===typeof e?(e=encodeURI(e).replace(t,Ot),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Ot(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}St.prototype.toString=function(){var e=[],t=this.j;t&&e.push(xt(t,Lt,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(xt(t,Lt,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(xt(n,"/"==n.charAt(0)?Ft:Mt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",xt(n,Ut)),e.join("")};var Lt=/[#\/\?@]/g,Mt=/[#\?:]/g,Ft=/[#\?]/g,Vt=/[#\?@]/g,Ut=/#/g;function Bt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function qt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function jt(e,t){qt(e),t=Gt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function zt(e,t){return qt(e),t=Gt(e,t),e.g.has(t)}function Kt(e,t,n){jt(e,t),0<n.length&&(e.i=null,e.g.set(Gt(e,t),E(n)),e.h+=n.length)}function Gt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(r=Bt.prototype).add=function(e,t){qt(this),this.i=null,e=Gt(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},r.forEach=function(e,t){qt(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},r.ta=function(){qt(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},r.Z=function(e){qt(this);let t=[];if("string"===typeof e)zt(this,e)&&(t=t.concat(this.g.get(Gt(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},r.set=function(e,t){return qt(this),this.i=null,zt(this,e=Gt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},r.get=function(e,t){return e&&0<(e=this.Z(e)).length?String(e[0]):t},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),e.push(i)}}return this.i=e.join("&")};var Wt=class{constructor(e,t){this.g=e,this.map=t}};function Ht(e){this.l=e||Qt,d.PerformanceNavigationTiming?e=0<(e=d.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(d.g&&d.g.Ka&&d.g.Ka()&&d.g.Ka().dc),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Qt=10;function Yt(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Jt(e){return e.h?1:e.g?e.g.size:0}function Xt(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function $t(e,t){e.g?e.g.add(t):e.h=t}function Zt(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function en(e){if(null!=e.h)return e.i.concat(e.h.F);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.F);return t}return E(e.i)}Ht.prototype.cancel=function(){if(this.i=en(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var tn,nn=class{stringify(e){return d.JSON.stringify(e,void 0)}parse(e){return d.JSON.parse(e,void 0)}};function rn(){this.g=new nn}function sn(e,t,n){const r=n||"";try{Tt(e,(function(e,n){let i=e;p(e)&&(i=_e(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function on(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(s){}}function an(e){this.l=e.ec||null,this.j=e.ob||!1}function cn(e,t){ye.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=un,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}I(an,Ze),an.prototype.g=function(){return new cn(this.l,this.j)},an.prototype.i=(tn={},function(){return tn}),I(cn,ye);var un=0;function ln(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}function hn(e){e.readyState=4,e.l=null,e.j=null,e.A=null,dn(e)}function dn(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(r=cn.prototype).open=function(e,t){if(this.readyState!=un)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,dn(this)},r.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||d).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))},r.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,hn(this)),this.readyState=un},r.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,dn(this)),this.g&&(this.readyState=3,dn(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if("undefined"!==typeof d.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;ln(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))},r.Xa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?hn(this):dn(this),3==this.readyState&&ln(this)}},r.Za=function(e){this.g&&(this.response=this.responseText=e,hn(this))},r.Ya=function(e){this.g&&(this.response=e,hn(this))},r.ka=function(){this.g&&hn(this)},r.setRequestHeader=function(e,t){this.v.append(e,t)},r.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(cn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var fn=d.JSON.parse;function pn(e){ye.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=gn,this.L=this.M=!1}I(pn,ye);var gn="",mn=/^https?$/i,yn=["POST","PUT"];function vn(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,wn(e),In(e)}function wn(e){e.F||(e.F=!0,ve(e,"complete"),ve(e,"error"))}function _n(e){if(e.h&&"undefined"!=typeof h&&(!e.C[1]||4!=Tn(e)||2!=e.da()))if(e.v&&4==Tn(e))xe(e.La,0,e);else if(ve(e,"readystatechange"),4==Tn(e)){e.h=!1;try{const a=e.da();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===a){var i=String(e.I).match(Et)[1]||null;!i&&d.self&&d.self.location&&(i=d.self.location.protocol.slice(0,-1)),r=!mn.test(i?i.toLowerCase():"")}n=r}if(n)ve(e,"complete"),ve(e,"success");else{e.m=6;try{var s=2<Tn(e)?e.g.statusText:""}catch(o){s=""}e.j=s+" ["+e.da()+"]",wn(e)}}finally{In(e)}}}function In(e,t){if(e.g){bn(e);const r=e.g,i=e.C[0]?()=>{}:null;e.g=null,e.C=null,t||ve(e,"ready");try{r.onreadystatechange=i}catch(n){}}}function bn(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(d.clearTimeout(e.A),e.A=null)}function Tn(e){return e.g?e.g.readyState:0}function En(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case gn:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(Rr){return null}}function Sn(e){let t="";return $(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function An(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Sn(n),"string"===typeof e?null!=n&&encodeURIComponent(String(n)):Dt(e,t,n))}function Cn(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function kn(e){this.Ga=0,this.j=[],this.l=new Be,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Cn("failFast",!1,e),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Cn("baseRetryDelayMs",5e3,e),this.hb=Cn("retryDelaySeedMs",1e4,e),this.eb=Cn("forwardChannelMaxRetries",2,e),this.xa=Cn("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.i=new Ht(e&&e.concurrentRequestLimit),this.Ja=new rn,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.l.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.qa=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.qa=e.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function Nn(e){if(Rn(e),3==e.H){var t=e.W++,n=At(e.I);if(Dt(n,"SID",e.K),Dt(n,"RID",t),Dt(n,"TYPE","terminate"),On(e,n),(t=new at(e,e.l,t)).L=2,t.A=Rt(At(n)),n=!1,d.navigator&&d.navigator.sendBeacon)try{n=d.navigator.sendBeacon(t.A.toString(),"")}catch(r){}!n&&d.Image&&((new Image).src=t.A,n=!0),n||(t.g=Wn(t.l,null),t.g.ha(t.A)),t.G=Date.now(),yt(t)}Kn(e)}function Dn(e){e.g&&(Vn(e),e.g.cancel(),e.g=null)}function Rn(e){Dn(e),e.u&&(d.clearTimeout(e.u),e.u=null),Bn(e),e.i.cancel(),e.m&&("number"===typeof e.m&&d.clearTimeout(e.m),e.m=null)}function Pn(e){if(!Yt(e.i)&&!e.m){e.m=!0;var t=e.Na;Ae||Ne(),Ce||(Ae(),Ce=!0),ke.add(t,e),e.C=0}}function xn(e,t){var n;n=t?t.m:e.W++;const r=At(e.I);Dt(r,"SID",e.K),Dt(r,"RID",n),Dt(r,"AID",e.V),On(e,r),e.o&&e.s&&An(r,e.o,e.s),n=new at(e,e.l,n,e.C+1),null===e.o&&(n.I=e.s),t&&(e.j=t.F.concat(e.j)),t=Ln(e,n,1e3),n.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),$t(e.i,n),dt(n,r,t)}function On(e,t){e.na&&$(e.na,(function(e,n){Dt(t,n,e)})),e.h&&Tt({},(function(e,n){Dt(t,n,e)}))}function Ln(e,t,n){n=Math.min(e.j.length,n);var r=e.h?w(e.h.Va,e.h,e):null;e:{var i=e.j;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=i[o].g;const a=i[o].map;if(n-=t,0>n)t=Math.max(0,i[o].g-100),s=!1;else try{sn(a,e,"req"+n+"_")}catch(Hi){r&&r(a)}}if(s){r=e.join("&");break e}}}return e=e.j.splice(0,n),t.F=e,r}function Mn(e){if(!e.g&&!e.u){e.ba=1;var t=e.Ma;Ae||Ne(),Ce||(Ae(),Ce=!0),ke.add(t,e),e.A=0}}function Fn(e){return!(e.g||e.u||3<=e.A)&&(e.ba++,e.u=Je(w(e.Ma,e),jn(e,e.A)),e.A++,!0)}function Vn(e){null!=e.B&&(d.clearTimeout(e.B),e.B=null)}function Un(e){e.g=new at(e,e.l,"rpc",e.ba),null===e.o&&(e.g.I=e.s),e.g.O=0;var t=At(e.wa);Dt(t,"RID","rpc"),Dt(t,"SID",e.K),Dt(t,"AID",e.V),Dt(t,"CI",e.G?"0":"1"),!e.G&&e.qa&&Dt(t,"TO",e.qa),Dt(t,"TYPE","xmlhttp"),On(e,t),e.o&&e.s&&An(t,e.o,e.s),e.L&&e.g.setTimeout(e.L);var n=e.g;e=e.pa,n.L=1,n.A=Rt(At(t)),n.u=null,n.S=!0,ft(n,e)}function Bn(e){null!=e.v&&(d.clearTimeout(e.v),e.v=null)}function qn(e,t){var n=null;if(e.g==t){Bn(e),Vn(e),e.g=null;var r=2}else{if(!Xt(e.i,t))return;n=t.F,Zt(e.i,t),r=1}if(0!=e.H)if(t.i)if(1==r){n=t.u?t.u.length:0,t=Date.now()-t.G;var i=e.C;ve(r=Ke(),new Ye(r,n)),Pn(e)}else Mn(e);else if(3==(i=t.s)||0==i&&0<t.ca||!(1==r&&function(e,t){return!(Jt(e.i)>=e.i.j-(e.m?1:0))&&(e.m?(e.j=t.F.concat(e.j),!0):!(1==e.H||2==e.H||e.C>=(e.cb?0:e.eb))&&(e.m=Je(w(e.Na,e,t),jn(e,e.C)),e.C++,!0))}(e,t)||2==r&&Fn(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),i){case 1:zn(e,5);break;case 4:zn(e,10);break;case 3:zn(e,6);break;default:zn(e,2)}}function jn(e,t){let n=e.ab+Math.floor(Math.random()*e.hb);return e.isActive()||(n*=2),n*t}function zn(e,t){if(e.l.info("Error code "+t),2==t){var n=null;e.h&&(n=null);var r=w(e.pb,e);n||(n=new St("//www.google.com/images/cleardot.gif"),d.location&&"http"==d.location.protocol||Ct(n,"https"),Rt(n)),function(e,t){const n=new Be;if(d.Image){const r=new Image;r.onload=_(on,n,r,"TestLoadImage: loaded",!0,t),r.onerror=_(on,n,r,"TestLoadImage: error",!1,t),r.onabort=_(on,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=_(on,n,r,"TestLoadImage: timeout",!1,t),d.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(n.toString(),r)}else Qe(2);e.H=0,e.h&&e.h.za(t),Kn(e),Rn(e)}function Kn(e){if(e.H=0,e.ma=[],e.h){const t=en(e.i);0==t.length&&0==e.j.length||(S(e.ma,t),S(e.ma,e.j),e.i.i.length=0,E(e.j),e.j.length=0),e.h.ya()}}function Gn(e,t,n){var r=n instanceof St?At(n):new St(n);if(""!=r.g)t&&(r.g=t+"."+r.g),kt(r,r.m);else{var i=d.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new St(null);r&&Ct(s,r),t&&(s.g=t),i&&kt(s,i),n&&(s.l=n),r=s}return n=e.F,t=e.Da,n&&t&&Dt(r,n,t),Dt(r,"VER",e.ra),On(e,r),r}function Wn(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ha&&!e.va?new pn(new an({ob:n})):new pn(e.va)).Oa(e.J),t}function Hn(){}function Qn(){if(L&&!(10<=Number(G)))throw Error("Environmental error: no available transport.")}function Yn(e,t){ye.call(this),this.g=new kn(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!k(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!k(t)&&(this.g.F=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new $n(this)}function Jn(e){it.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function Xn(){st.call(this),this.status=1}function $n(e){this.g=e}function Zn(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function er(e,t,n){n||(n=0);var r=Array(16);if("string"===typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],o=t+(s^n&(i^s))+r[0]+3614090360&4294967295;o=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=n+(o<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(t=n+((o=t+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(t^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+s&4294967295}function tr(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}(r=pn.prototype).Oa=function(e){this.M=e},r.ha=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():nt.g(),this.C=this.u?et(this.u):et(nt),this.g.onreadystatechange=w(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(s){return void vn(this,s)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!==typeof r.keys||"function"!==typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),i=d.FormData&&e instanceof d.FormData,!(0<=T(yn,t))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[o,a]of n)this.g.setRequestHeader(o,a);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{bn(this),0<this.B&&((this.L=function(e){return L&&"number"===typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=w(this.ua,this)):this.A=xe(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(s){vn(this,s)}},r.ua=function(){"undefined"!=typeof h&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ve(this,"timeout"),this.abort(8))},r.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,ve(this,"complete"),ve(this,"abort"),In(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),In(this,!0)),pn.$.N.call(this)},r.La=function(){this.s||(this.G||this.v||this.l?_n(this):this.kb())},r.kb=function(){_n(this)},r.isActive=function(){return!!this.g},r.da=function(){try{return 2<Tn(this)?this.g.status:-1}catch(tn){return-1}},r.ja=function(){try{return this.g?this.g.responseText:""}catch(tn){return""}},r.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),fn(t)}},r.Ia=function(){return this.m},r.Sa=function(){return"string"===typeof this.j?this.j:String(this.j)},(r=kn.prototype).ra=8,r.H=1,r.Na=function(e){if(this.m)if(this.m=null,1==this.H){if(!e){this.W=Math.floor(1e5*Math.random()),e=this.W++;const i=new at(this,this.l,e);let s=this.s;if(this.U&&(s?(s=Z(s),te(s,this.U)):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)e:{for(var t=0,n=0;n<this.j.length;n++){var r=this.j[n];if(void 0===(r="__data__"in r.map&&"string"===typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.j.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=Ln(this,i,t),Dt(n=At(this.I),"RID",e),Dt(n,"CVER",22),this.F&&Dt(n,"X-HTTP-Session-Id",this.F),On(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(Sn(s)))+"&"+t:this.o&&An(n,this.o,s)),$t(this.i,i),this.bb&&Dt(n,"TYPE","init"),this.P?(Dt(n,"$req",t),Dt(n,"SID","null"),i.aa=!0,dt(i,n,null)):dt(i,n,t),this.H=2}}else 3==this.H&&(e?xn(this,e):0==this.j.length||Yt(this.i)||xn(this))},r.Ma=function(){if(this.u=null,Un(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var e=2*this.S;this.l.info("BP detection timer enabled: "+e),this.B=Je(w(this.jb,this),e)}},r.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Qe(10),Dn(this),Un(this))},r.ib=function(){null!=this.v&&(this.v=null,Dn(this),Fn(this),Qe(19))},r.pb=function(e){e?(this.l.info("Successfully pinged google.com"),Qe(2)):(this.l.info("Failed to ping google.com"),Qe(1))},r.isActive=function(){return!!this.h&&this.h.isActive(this)},(r=Hn.prototype).Ba=function(){},r.Aa=function(){},r.za=function(){},r.ya=function(){},r.isActive=function(){return!0},r.Va=function(){},Qn.prototype.g=function(e,t){return new Yn(e,t)},I(Yn,ye),Yn.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var e=this.g,t=this.l,n=this.h||void 0;Qe(0),e.Y=t,e.na=n||{},e.G=e.aa,e.I=Gn(e,null,e.Y),Pn(e)},Yn.prototype.close=function(){Nn(this.g)},Yn.prototype.u=function(e){var t=this.g;if("string"===typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=_e(e),e=n);t.j.push(new Wt(t.fb++,e)),3==t.H&&Pn(t)},Yn.prototype.N=function(){this.g.h=null,delete this.j,Nn(this.g),delete this.g,Yn.$.N.call(this)},I(Jn,it),I(Xn,st),I($n,Hn),$n.prototype.Ba=function(){ve(this.g,"a")},$n.prototype.Aa=function(e){ve(this.g,new Jn(e))},$n.prototype.za=function(e){ve(this.g,new Xn)},$n.prototype.ya=function(){ve(this.g,"b")},I(Zn,(function(){this.blockSize=-1})),Zn.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Zn.prototype.j=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=this.m,i=this.h,s=0;s<t;){if(0==i)for(;s<=n;)er(this,e,s),s+=this.blockSize;if("string"===typeof e){for(;s<t;)if(r[i++]=e.charCodeAt(s++),i==this.blockSize){er(this,r),i=0;break}}else for(;s<t;)if(r[i++]=e[s++],i==this.blockSize){er(this,r),i=0;break}}this.h=i,this.i+=t},Zn.prototype.l=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.i;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.j(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var nr={};function rr(e){return-128<=e&&128>e?function(e,t){var n=nr;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}(e,(function(e){return new tr([0|e],0>e?-1:0)})):new tr([0|e],0>e?-1:0)}function ir(e){if(isNaN(e)||!isFinite(e))return or;if(0>e)return hr(ir(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=sr;return new tr(t,0)}var sr=4294967296,or=rr(0),ar=rr(1),cr=rr(16777216);function ur(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function lr(e){return-1==e.h}function hr(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new tr(n,~e.h).add(ar)}function dr(e,t){return e.add(hr(t))}function fr(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function pr(e,t){this.g=e,this.h=t}function gr(e,t){if(ur(t))throw Error("division by zero");if(ur(e))return new pr(or,or);if(lr(e))return t=gr(hr(e),t),new pr(hr(t.g),hr(t.h));if(lr(t))return t=gr(e,hr(t)),new pr(hr(t.g),t.h);if(30<e.g.length){if(lr(e)||lr(t))throw Error("slowDivide_ only works with positive integers.");for(var n=ar,r=t;0>=r.X(e);)n=mr(n),r=mr(r);var i=yr(n,1),s=yr(r,1);for(r=yr(r,2),n=yr(n,2);!ur(r);){var o=s.add(r);0>=o.X(e)&&(i=i.add(n),s=o),r=yr(r,1),n=yr(n,1)}return t=dr(e,i.R(t)),new pr(i,t)}for(i=or;0<=e.X(t);){for(n=Math.max(1,Math.floor(e.ea()/t.ea())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),o=(s=ir(n)).R(t);lr(o)||0<o.X(e);)o=(s=ir(n-=r)).R(t);ur(s)&&(s=ar),i=i.add(s),e=dr(e,o)}return new pr(i,e)}function mr(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.D(r)<<1|e.D(r-1)>>>31;return new tr(n,e.h)}function yr(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],s=0;s<r;s++)i[s]=0<t?e.D(s+n)>>>t|e.D(s+n+1)<<32-t:e.D(s+n);return new tr(i,e.h)}(r=tr.prototype).ea=function(){if(lr(this))return-hr(this).ea();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.D(n);e+=(0<=r?r:sr+r)*t,t*=sr}return e},r.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(ur(this))return"0";if(lr(this))return"-"+hr(this).toString(e);for(var t=ir(Math.pow(e,6)),n=this,r="";;){var i=gr(n,t).g,s=((0<(n=dr(n,i.R(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(ur(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},r.D=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},r.X=function(e){return lr(e=dr(this,e))?-1:ur(e)?0:1},r.abs=function(){return lr(this)?hr(this):this},r.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var s=r+(65535&this.D(i))+(65535&e.D(i)),o=(s>>>16)+(this.D(i)>>>16)+(e.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,n[i]=o<<16|s}return new tr(n,-2147483648&n[n.length-1]?-1:0)},r.R=function(e){if(ur(this)||ur(e))return or;if(lr(this))return lr(e)?hr(this).R(hr(e)):hr(hr(this).R(e));if(lr(e))return hr(this.R(hr(e)));if(0>this.X(cr)&&0>e.X(cr))return ir(this.ea()*e.ea());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var s=this.D(r)>>>16,o=65535&this.D(r),a=e.D(i)>>>16,c=65535&e.D(i);n[2*r+2*i]+=o*c,fr(n,2*r+2*i),n[2*r+2*i+1]+=s*c,fr(n,2*r+2*i+1),n[2*r+2*i+1]+=o*a,fr(n,2*r+2*i+1),n[2*r+2*i+2]+=s*a,fr(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new tr(n,0)},r.gb=function(e){return gr(this,e).h},r.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)&e.D(r);return new tr(n,this.h&e.h)},r.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)|e.D(r);return new tr(n,this.h|e.h)},r.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)^e.D(r);return new tr(n,this.h^e.h)},Qn.prototype.createWebChannel=Qn.prototype.g,Yn.prototype.send=Yn.prototype.u,Yn.prototype.open=Yn.prototype.m,Yn.prototype.close=Yn.prototype.close,Xe.NO_ERROR=0,Xe.TIMEOUT=8,Xe.HTTP_ERROR=6,$e.COMPLETE="complete",tt.EventType=rt,rt.OPEN="a",rt.CLOSE="b",rt.ERROR="c",rt.MESSAGE="d",ye.prototype.listen=ye.prototype.O,pn.prototype.listenOnce=pn.prototype.P,pn.prototype.getLastError=pn.prototype.Sa,pn.prototype.getLastErrorCode=pn.prototype.Ia,pn.prototype.getStatus=pn.prototype.da,pn.prototype.getResponseJson=pn.prototype.Wa,pn.prototype.getResponseText=pn.prototype.ja,pn.prototype.send=pn.prototype.ha,pn.prototype.setWithCredentials=pn.prototype.Oa,Zn.prototype.digest=Zn.prototype.l,Zn.prototype.reset=Zn.prototype.reset,Zn.prototype.update=Zn.prototype.j,tr.prototype.add=tr.prototype.add,tr.prototype.multiply=tr.prototype.R,tr.prototype.modulo=tr.prototype.gb,tr.prototype.compare=tr.prototype.X,tr.prototype.toNumber=tr.prototype.ea,tr.prototype.toString=tr.prototype.toString,tr.prototype.getBits=tr.prototype.D,tr.fromNumber=ir,tr.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return hr(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=ir(Math.pow(n,8)),i=or,s=0;s<t.length;s+=8){var o=Math.min(8,t.length-s),a=parseInt(t.substring(s,s+o),n);8>o?(o=ir(Math.pow(n,o)),i=i.R(o).add(ir(a))):i=(i=i.R(r)).add(ir(a))}return i};var vr=l.createWebChannelTransport=function(){return new Qn},wr=l.getStatEventTarget=function(){return Ke()},_r=l.ErrorCode=Xe,Ir=l.EventType=$e,br=l.Event=je,Tr=l.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Er=(l.FetchXmlHttpFactory=an,l.WebChannel=tt),Sr=l.XhrIo=pn,Ar=l.Md5=Zn,Cr=l.Integer=tr;const kr="@firebase/firestore";class Nr{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Nr.UNAUTHENTICATED=new Nr(null),Nr.GOOGLE_CREDENTIALS=new Nr("google-credentials-uid"),Nr.FIRST_PARTY=new Nr("first-party-uid"),Nr.MOCK_USER=new Nr("mock-user");let Dr="10.10.0";const Rr=new a.Vy("@firebase/firestore");function Pr(){return Rr.logLevel}function xr(e){if(Rr.logLevel<=a.$b.DEBUG){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=n.map(Mr);Rr.debug("Firestore (".concat(Dr,"): ").concat(e),...i)}}function Or(e){if(Rr.logLevel<=a.$b.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=n.map(Mr);Rr.error("Firestore (".concat(Dr,"): ").concat(e),...i)}}function Lr(e){if(Rr.logLevel<=a.$b.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=n.map(Mr);Rr.warn("Firestore (".concat(Dr,"): ").concat(e),...i)}}function Mr(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function Fr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected state";const t="FIRESTORE (".concat(Dr,") INTERNAL ASSERTION FAILED: ")+e;throw Or(t),new Error(t)}function Vr(e,t){e||Fr()}function Ur(e,t){return e}const Br={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class qr extends c.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>"".concat(this.name,": [code=").concat(this.code,"]: ").concat(this.message)}}class jr{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class zr{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(e))}}class Kr{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Nr.UNAUTHENTICATED)))}shutdown(){}}class Gr{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Wr{constructor(e){this.t=e,this.currentUser=Nr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new jr;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new jr,e.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const t=i;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},o=e=>{xr("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(xr("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new jr)}}),0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(xr("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Vr("string"==typeof t.accessToken),new zr(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Vr(null===e||"string"==typeof e),new Nr(e)}}class Hr{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Nr.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Qr{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new Hr(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable((()=>t(Nr.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Yr{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Jr{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const n=e=>{null!=e.error&&xr("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(e.error.message));const n=e.token!==this.R;return this.R=e.token,xr("FirebaseAppCheckTokenProvider","Received ".concat(n?"new":"existing"," token.")),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const r=e=>{xr("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.A.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){const e=this.A.getImmediate({optional:!0});e?r(e):xr("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(Vr("string"==typeof e.token),this.R=e.token,new Yr(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Xr(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}class $r{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(256/62);let n="";for(;n.length<20;){const r=Xr(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%62))}return n}}function Zr(e,t){return e<t?-1:e>t?1:0}function ei(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}function ti(e){return e+"\0"}class ni{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new qr(Br.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new qr(Br.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new qr(Br.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new qr(Br.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return ni.fromMillis(Date.now())}static fromDate(e){return ni.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new ni(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Zr(this.nanoseconds,e.nanoseconds):Zr(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ri{constructor(e){this.timestamp=e}static fromTimestamp(e){return new ri(e)}static min(){return new ri(new ni(0,0))}static max(){return new ri(new ni(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ii{constructor(e,t,n){void 0===t?t=0:t>e.length&&Fr(),void 0===n?n=e.length-t:n>e.length-t&&Fr(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===ii.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ii?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class si extends ii{construct(e,t,n){return new si(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(){const e=[];for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const i of n){if(i.indexOf("//")>=0)throw new qr(Br.INVALID_ARGUMENT,"Invalid segment (".concat(i,"). Paths must not contain // in them."));e.push(...i.split("/").filter((e=>e.length>0)))}return new si(e)}static emptyPath(){return new si([])}}const oi=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ai extends ii{construct(e,t,n){return new ai(e,t,n)}static isValidIdentifier(e){return oi.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ai.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ai(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new qr(Br.INVALID_ARGUMENT,"Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new qr(Br.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new qr(Br.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new qr(Br.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ai(t)}static emptyPath(){return new ai([])}}class ci{constructor(e){this.path=e}static fromPath(e){return new ci(si.fromString(e))}static fromName(e){return new ci(si.fromString(e).popFirst(5))}static empty(){return new ci(si.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===si.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return si.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ci(new si(e.slice()))}}class ui{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function li(e){return e.fields.find((e=>2===e.kind))}function hi(e){return e.fields.filter((e=>2!==e.kind))}ui.UNKNOWN_ID=-1;class di{constructor(e,t){this.fieldPath=e,this.kind=t}}class fi{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new fi(0,mi.min())}}function pi(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=ri.fromTimestamp(1e9===r?new ni(n+1,0):new ni(n,r));return new mi(i,ci.empty(),t)}function gi(e){return new mi(e.readTime,e.key,-1)}class mi{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new mi(ri.min(),ci.empty(),-1)}static max(){return new mi(ri.max(),ci.empty(),-1)}}function yi(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=ci.comparator(e.documentKey,t.documentKey),0!==n?n:Zr(e.largestBatchId,t.largestBatchId))}const vi="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class wi{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function _i(e){if(e.code!==Br.FAILED_PRECONDITION||e.message!==vi)throw e;xr("LocalStore","Unexpectedly lost primary lease")}class Ii{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Fr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Ii(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof Ii?t:Ii.resolve(t)}catch(e){return Ii.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):Ii.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):Ii.reject(t)}static resolve(e){return new Ii(((t,n)=>{t(e)}))}static reject(e){return new Ii(((t,n)=>{n(e)}))}static waitFor(e){return new Ii(((t,n)=>{let r=0,i=0,s=!1;e.forEach((e=>{++r,e.next((()=>{++i,s&&i===r&&t()}),(e=>n(e)))})),s=!0,i===r&&t()}))}static or(e){let t=Ii.resolve(!1);for(const n of e)t=t.next((e=>e?Ii.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}static mapArray(e,t){return new Ii(((n,r)=>{const i=e.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;t(e[c]).next((e=>{s[c]=e,++o,o===i&&n(s)}),(e=>r(e)))}}))}static doWhile(e,t){return new Ii(((n,r)=>{const i=()=>{!0===e()?t().next((()=>{i()}),r):n()};i()}))}}class bi{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new jr,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Si(e,t.error)):this.V.resolve()},this.transaction.onerror=t=>{const n=Di(t.target.error);this.V.reject(new Si(e,n))}}static open(e,t,n,r){try{return new bi(t,e.transaction(r,n))}catch(e){throw new Si(t,e)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(xr("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new Ci(t)}}class Ti{constructor(e,t,n){this.name=e,this.version=t,this.p=n,12.2===Ti.S((0,c.ZQ)())&&Or("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return xr("SimpleDb","Removing database:",e),ki(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!(0,c.zW)())return!1;if(Ti.C())return!0;const e=(0,c.ZQ)(),t=Ti.S(e),n=0<t&&t<10,r=Ti.v(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||i)}static C(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.F)}static M(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static v(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async O(e){return this.db||(xr("SimpleDb","Opening database:",this.name),this.db=await new Promise(((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{const n=e.target.result;t(n)},r.onblocked=()=>{n(new Si(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{const r=t.target.error;"VersionError"===r.name?n(new qr(Br.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new qr(Br.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new Si(e,r))},r.onupgradeneeded=e=>{xr("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;this.p.N(t,r.transaction,e.oldVersion,this.version).next((()=>{xr("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.L&&(this.db.onversionchange=e=>this.L(e)),this.db}B(e){this.L=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){const i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.O(e);const t=bi.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next((e=>(t.g(),e))).catch((e=>(t.abort(e),Ii.reject(e)))).toPromise();return s.catch((()=>{})),await t.m,s}catch(e){const t=e,n="FirebaseError"!==t.name&&s<3;if(xr("SimpleDb","Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class Ei{constructor(e){this.k=e,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(e){this.k=e}done(){this.q=!0}U(e){this.K=e}delete(){return ki(this.k.delete())}}class Si extends qr{constructor(e,t){super(Br.UNAVAILABLE,"IndexedDB transaction '".concat(e,"' failed: ").concat(t)),this.name="IndexedDbTransactionError"}}function Ai(e){return"IndexedDbTransactionError"===e.name}class Ci{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(xr("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(xr("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),ki(n)}add(e){return xr("SimpleDb","ADD",this.store.name,e,e),ki(this.store.add(e))}get(e){return ki(this.store.get(e)).next((t=>(void 0===t&&(t=null),xr("SimpleDb","GET",this.store.name,e,t),t)))}delete(e){return xr("SimpleDb","DELETE",this.store.name,e),ki(this.store.delete(e))}count(){return xr("SimpleDb","COUNT",this.store.name),ki(this.store.count())}W(e,t){const n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){const e=r.getAll(n.range);return new Ii(((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}}))}{const e=this.cursor(n),t=[];return this.G(e,((e,n)=>{t.push(n)})).next((()=>t))}}j(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new Ii(((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}}))}H(e,t){xr("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.J=!1;const r=this.cursor(n);return this.G(r,((e,t,n)=>n.delete()))}Y(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.G(r,t)}Z(e){const t=this.cursor({});return new Ii(((n,r)=>{t.onerror=e=>{const t=Di(e.target.error);r(t)},t.onsuccess=t=>{const r=t.target.result;r?e(r.primaryKey,r.value).next((e=>{e?r.continue():n()})):n()}}))}G(e,t){const n=[];return new Ii(((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{const i=e.target.result;if(!i)return void r();const s=new Ei(i),o=t(i.primaryKey,i.value,s);if(o instanceof Ii){const e=o.catch((e=>(s.done(),Ii.reject(e))));n.push(e)}s.isDone?r():null===s.$?i.continue():i.continue(s.$)}})).next((()=>Ii.waitFor(n)))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.J?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function ki(e){return new Ii(((t,n)=>{e.onsuccess=e=>{const n=e.target.result;t(n)},e.onerror=e=>{const t=Di(e.target.error);n(t)}}))}let Ni=!1;function Di(e){const t=Ti.S((0,c.ZQ)());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new qr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '".concat(t,"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround."));return Ni||(Ni=!0,setTimeout((()=>{throw e}),0)),e}}return e}class Ri{constructor(e,t){this.asyncQueue=e,this.X=t,this.task=null}start(){this.ee(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}ee(e){xr("IndexBackfiller","Scheduled in ".concat(e,"ms")),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{xr("IndexBackfiller","Documents written: ".concat(await this.X.te()))}catch(e){Ai(e)?xr("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",e):await _i(e)}await this.ee(6e4)}))}}class Pi{constructor(e,t){this.localStore=e,this.persistence=t}async te(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50;return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.ne(t,e)))}ne(e,t){const n=new Set;let r=t,i=!0;return Ii.doWhile((()=>!0===i&&r>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((t=>{if(null!==t&&!n.has(t))return xr("IndexBackfiller","Processing collection: ".concat(t)),this.re(e,t,r).next((e=>{r-=e,n.add(t)}));i=!1})))).next((()=>t-r))}re(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next((n=>{const i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next((()=>this.ie(r,n))).next((n=>(xr("IndexBackfiller","Updating offset: ".concat(n)),this.localStore.indexManager.updateCollectionGroup(e,t,n)))).next((()=>i.size))}))))}ie(e,t){let n=e;return t.changes.forEach(((e,t)=>{const r=gi(t);yi(r,n)>0&&(n=r)})),new mi(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class xi{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.se(e),this.oe=e=>t.writeSequenceNumber(e))}se(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.oe&&this.oe(e),e}}function Oi(e){return null==e}function Li(e){return 0===e&&1/e==-1/0}function Mi(e){return"number"==typeof e&&Number.isInteger(e)&&!Li(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function Fi(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=Ui(t)),t=Vi(e.get(n),t);return Ui(t)}function Vi(e,t){let n=t;const r=e.length;for(let i=0;i<r;i++){const t=e.charAt(i);switch(t){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=t}}return n}function Ui(e){return e+"\x01\x01"}function Bi(e){const t=e.length;if(Vr(t>=2),2===t)return Vr("\x01"===e.charAt(0)&&"\x01"===e.charAt(1)),si.emptyPath();const n=t-2,r=[];let i="";for(let s=0;s<t;){const t=e.indexOf("\x01",s);switch((t<0||t>n)&&Fr(),e.charAt(t+1)){case"\x01":const n=e.substring(s,t);let o;0===i.length?o=n:(i+=n,o=i,i=""),r.push(o);break;case"\x10":i+=e.substring(s,t),i+="\0";break;case"\x11":i+=e.substring(s,t+1);break;default:Fr()}s=t+2}return new si(r)}xi._e=-1;const qi=["userId","batchId"];function ji(e,t){return[e,Fi(t)]}function zi(e,t,n){return[e,Fi(t),n]}const Ki={},Gi=["prefixPath","collectionGroup","readTime","documentId"],Wi=["prefixPath","collectionGroup","documentId"],Hi=["collectionGroup","readTime","prefixPath","documentId"],Qi=["canonicalId","targetId"],Yi=["targetId","path"],Ji=["path","targetId"],Xi=["collectionId","parent"],$i=["indexId","uid"],Zi=["uid","sequenceNumber"],es=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],ts=["indexId","uid","orderedDocumentKey"],ns=["userId","collectionPath","documentId"],rs=["userId","collectionPath","largestBatchId"],is=["userId","collectionGroup","largestBatchId"],ss=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],os=[...ss,"documentOverlays"],as=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],cs=as,us=[...cs,"indexConfiguration","indexState","indexEntries"];class ls extends wi{constructor(e,t){super(),this.ae=e,this.currentSequenceNumber=t}}function hs(e,t){const n=Ur(e);return Ti.M(n.ae,t)}function ds(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function fs(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function ps(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class gs{constructor(e,t){this.comparator=e,this.root=t||ys.EMPTY}insert(e,t){return new gs(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ys.BLACK,null,null))}remove(e){return new gs(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ys.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push("".concat(t,":").concat(n)),!1))),"{".concat(e.join(", "),"}")}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ms(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ms(this.root,e,this.comparator,!1)}getReverseIterator(){return new ms(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ms(this.root,e,this.comparator,!0)}}class ms{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ys{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:ys.RED,this.left=null!=r?r:ys.EMPTY,this.right=null!=i?i:ys.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new ys(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return ys.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return ys.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ys.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ys.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Fr();if(this.right.isRed())throw Fr();const e=this.left.check();if(e!==this.right.check())throw Fr();return e+(this.isRed()?0:1)}}ys.EMPTY=null,ys.RED=!0,ys.BLACK=!1,ys.EMPTY=new class{constructor(){this.size=0}get key(){throw Fr()}get value(){throw Fr()}get color(){throw Fr()}get left(){throw Fr()}get right(){throw Fr()}copy(e,t,n,r,i){return this}insert(e,t,n){return new ys(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class vs{constructor(e){this.comparator=e,this.data=new gs(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ws(this.data.getIterator())}getIteratorFrom(e){return new ws(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof vs))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new vs(this.comparator);return t.data=e,t}}class ws{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function _s(e){return e.hasNext()?e.getNext():void 0}class Is{constructor(e){this.fields=e,e.sort(ai.comparator)}static empty(){return new Is([])}unionWith(e){let t=new vs(ai.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new Is(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ei(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class bs extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Ts{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new bs("Invalid base64 string: "+e):e}}(e);return new Ts(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Ts(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Zr(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ts.EMPTY_BYTE_STRING=new Ts("");const Es=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ss(e){if(Vr(!!e),"string"==typeof e){let t=0;const n=Es.exec(e);if(Vr(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:As(e.seconds),nanos:As(e.nanos)}}function As(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Cs(e){return"string"==typeof e?Ts.fromBase64String(e):Ts.fromUint8Array(e)}function ks(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Ns(e){const t=e.mapValue.fields.__previous_value__;return ks(t)?Ns(t):t}function Ds(e){const t=Ss(e.mapValue.fields.__local_write_time__.timestampValue);return new ni(t.seconds,t.nanos)}class Rs{constructor(e,t,n,r,i,s,o,a,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class Ps{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Ps("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Ps&&e.projectId===this.projectId&&e.database===this.database}}const xs={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Os={nullValue:"NULL_VALUE"};function Ls(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?ks(e)?4:Ys(e)?9007199254740991:10:Fr()}function Ms(e,t){if(e===t)return!0;const n=Ls(e);if(n!==Ls(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Ds(e).isEqual(Ds(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=Ss(e.timestampValue),r=Ss(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Cs(e.bytesValue).isEqual(Cs(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return As(e.geoPointValue.latitude)===As(t.geoPointValue.latitude)&&As(e.geoPointValue.longitude)===As(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return As(e.integerValue)===As(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=As(e.doubleValue),r=As(t.doubleValue);return n===r?Li(n)===Li(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return ei(e.arrayValue.values||[],t.arrayValue.values||[],Ms);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(ds(n)!==ds(r))return!1;for(const i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Ms(n[i],r[i])))return!1;return!0}(e,t);default:return Fr()}}function Fs(e,t){return void 0!==(e.values||[]).find((e=>Ms(e,t)))}function Vs(e,t){if(e===t)return 0;const n=Ls(e),r=Ls(t);if(n!==r)return Zr(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Zr(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=As(e.integerValue||e.doubleValue),r=As(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Us(e.timestampValue,t.timestampValue);case 4:return Us(Ds(e),Ds(t));case 5:return Zr(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Cs(e),r=Cs(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let i=0;i<n.length&&i<r.length;i++){const e=Zr(n[i],r[i]);if(0!==e)return e}return Zr(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=Zr(As(e.latitude),As(t.latitude));return 0!==n?n:Zr(As(e.longitude),As(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],r=t.values||[];for(let i=0;i<n.length&&i<r.length;++i){const e=Vs(n[i],r[i]);if(e)return e}return Zr(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===xs.mapValue&&t===xs.mapValue)return 0;if(e===xs.mapValue)return 1;if(t===xs.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){const e=Zr(r[o],s[o]);if(0!==e)return e;const t=Vs(n[r[o]],i[s[o]]);if(0!==t)return t}return Zr(r.length,s.length)}(e.mapValue,t.mapValue);default:throw Fr()}}function Us(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Zr(e,t);const n=Ss(e),r=Ss(t),i=Zr(n.seconds,r.seconds);return 0!==i?i:Zr(n.nanos,r.nanos)}function Bs(e){return qs(e)}function qs(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Ss(e);return"time(".concat(t.seconds,",").concat(t.nanos,")")}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return Cs(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return ci.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return"geo(".concat(e.latitude,",").concat(e.longitude,")")}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=qs(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+="".concat(i,":").concat(qs(e.fields[i]));return n+"}"}(e.mapValue):Fr()}function js(e,t){return{referenceValue:"projects/".concat(e.projectId,"/databases/").concat(e.database,"/documents/").concat(t.path.canonicalString())}}function zs(e){return!!e&&"integerValue"in e}function Ks(e){return!!e&&"arrayValue"in e}function Gs(e){return!!e&&"nullValue"in e}function Ws(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Hs(e){return!!e&&"mapValue"in e}function Qs(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return fs(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=Qs(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Qs(e.arrayValue.values[n]);return t}return Object.assign({},e)}function Ys(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function Js(e){return"nullValue"in e?Os:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?js(Ps.empty(),ci.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?{mapValue:{}}:Fr()}function Xs(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?js(Ps.empty(),ci.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?{mapValue:{}}:"mapValue"in e?xs:Fr()}function $s(e,t){const n=Vs(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function Zs(e,t){const n=Vs(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class eo{constructor(e){this.value=e}static empty(){return new eo({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Hs(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Qs(t)}setAll(e){let t=ai.emptyPath(),n={},r=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=Qs(e):r.push(i.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());Hs(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ms(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];Hs(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){fs(t,((t,n)=>e[t]=n));for(const r of n)delete e[r]}clone(){return new eo(Qs(this.value))}}function to(e){const t=[];return fs(e.fields,((e,n)=>{const r=new ai([e]);if(Hs(n)){const e=to(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new Is(t)}class no{constructor(e,t,n,r,i,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new no(e,0,ri.min(),ri.min(),ri.min(),eo.empty(),0)}static newFoundDocument(e,t,n,r){return new no(e,1,t,ri.min(),n,r,0)}static newNoDocument(e,t){return new no(e,2,t,ri.min(),ri.min(),eo.empty(),0)}static newUnknownDocument(e,t){return new no(e,3,t,ri.min(),ri.min(),eo.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ri.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=eo.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=eo.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ri.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof no&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new no(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {createTime: ").concat(this.createTime,"}), {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}class ro{constructor(e,t){this.position=e,this.inclusive=t}}function io(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?ci.comparator(ci.fromName(o.referenceValue),n.key):Vs(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function so(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Ms(e.position[n],t.position[n]))return!1;return!0}class oo{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";this.field=e,this.dir=t}}function ao(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class co{}class uo extends co{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new _o(e,t,n):"array-contains"===t?new Eo(e,n):"in"===t?new So(e,n):"not-in"===t?new Ao(e,n):"array-contains-any"===t?new Co(e,n):new uo(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Io(e,n):new bo(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Vs(t,this.value)):null!==t&&Ls(this.value)===Ls(t)&&this.matchesComparison(Vs(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Fr()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class lo extends co{constructor(e,t){super(),this.filters=e,this.op=t,this.ue=null}static create(e,t){return new lo(e,t)}matches(e){return ho(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.ue||(this.ue=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function ho(e){return"and"===e.op}function fo(e){return"or"===e.op}function po(e){return go(e)&&ho(e)}function go(e){for(const t of e.filters)if(t instanceof lo)return!1;return!0}function mo(e){if(e instanceof uo)return e.field.canonicalString()+e.op.toString()+Bs(e.value);if(po(e))return e.filters.map((e=>mo(e))).join(",");{const t=e.filters.map((e=>mo(e))).join(",");return"".concat(e.op,"(").concat(t,")")}}function yo(e,t){return e instanceof uo?function(e,t){return t instanceof uo&&e.op===t.op&&e.field.isEqual(t.field)&&Ms(e.value,t.value)}(e,t):e instanceof lo?function(e,t){return t instanceof lo&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,r)=>e&&yo(n,t.filters[r])),!0)}(e,t):void Fr()}function vo(e,t){const n=e.filters.concat(t);return lo.create(n,e.op)}function wo(e){return e instanceof uo?function(e){return"".concat(e.field.canonicalString()," ").concat(e.op," ").concat(Bs(e.value))}(e):e instanceof lo?function(e){return e.op.toString()+" {"+e.getFilters().map(wo).join(" ,")+"}"}(e):"Filter"}class _o extends uo{constructor(e,t,n){super(e,t,n),this.key=ci.fromName(n.referenceValue)}matches(e){const t=ci.comparator(e.key,this.key);return this.matchesComparison(t)}}class Io extends uo{constructor(e,t){super(e,"in",t),this.keys=To("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class bo extends uo{constructor(e,t){super(e,"not-in",t),this.keys=To("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function To(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>ci.fromName(e.referenceValue)))}class Eo extends uo{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Ks(t)&&Fs(t.arrayValue,this.value)}}class So extends uo{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Fs(this.value.arrayValue,t)}}class Ao extends uo{constructor(e,t){super(e,"not-in",t)}matches(e){if(Fs(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Fs(this.value.arrayValue,t)}}class Co extends uo{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Ks(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>Fs(this.value.arrayValue,e)))}}class ko{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.ce=null}}function No(e){return new ko(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null)}function Do(e){const t=Ur(e);if(null===t.ce){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>mo(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),Oi(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>Bs(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>Bs(e))).join(",")),t.ce=e}return t.ce}function Ro(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!ao(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!yo(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!so(e.startAt,t.startAt)&&so(e.endAt,t.endAt)}function Po(e){return ci.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function xo(e,t){return e.filters.filter((e=>e instanceof uo&&e.field.isEqual(t)))}function Oo(e,t,n){let r=Os,i=!0;for(const s of xo(e,t)){let e=Os,t=!0;switch(s.op){case"<":case"<=":e=Js(s.value);break;case"==":case"in":case">=":e=s.value;break;case">":e=s.value,t=!1;break;case"!=":case"not-in":e=Os}$s({value:r,inclusive:i},{value:e,inclusive:t})<0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];$s({value:r,inclusive:i},{value:e,inclusive:n.inclusive})<0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}function Lo(e,t,n){let r=xs,i=!0;for(const s of xo(e,t)){let e=xs,t=!0;switch(s.op){case">=":case">":e=Xs(s.value),t=!1;break;case"==":case"in":case"<=":e=s.value;break;case"<":e=s.value,t=!1;break;case"!=":case"not-in":e=xs}Zs({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];Zs({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}class Mo{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}}function Fo(e,t,n,r,i,s,o,a){return new Mo(e,t,n,r,i,s,o,a)}function Vo(e){return new Mo(e)}function Uo(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Bo(e){return null!==e.collectionGroup}function qo(e){const t=Ur(e);if(null===t.le){t.le=[];const e=new Set;for(const i of t.explicitOrderBy)t.le.push(i),e.add(i.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",r=function(e){let t=new vs(ai.comparator);return e.filters.forEach((e=>{e.getFlattenedFilters().forEach((e=>{e.isInequality()&&(t=t.add(e.field))}))})),t}(t);r.forEach((r=>{e.has(r.canonicalString())||r.isKeyField()||t.le.push(new oo(r,n))})),e.has(ai.keyField().canonicalString())||t.le.push(new oo(ai.keyField(),n))}return t.le}function jo(e){const t=Ur(e);return t.he||(t.he=zo(t,qo(e))),t.he}function zo(e,t){if("F"===e.limitType)return No(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map((e=>{const t="desc"===e.dir?"asc":"desc";return new oo(e.field,t)}));const n=e.endAt?new ro(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new ro(e.startAt.position,e.startAt.inclusive):null;return No(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function Ko(e,t){const n=e.filters.concat([t]);return new Mo(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Go(e,t,n){return new Mo(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Wo(e,t){return Ro(jo(e),jo(t))&&e.limitType===t.limitType}function Ho(e){return"".concat(Do(jo(e)),"|lt:").concat(e.limitType)}function Qo(e){return"Query(target=".concat(function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=", filters: [".concat(e.filters.map((e=>wo(e))).join(", "),"]")),Oi(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=", orderBy: [".concat(e.orderBy.map((e=>function(e){return"".concat(e.field.canonicalString()," (").concat(e.dir,")")}(e))).join(", "),"]")),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>Bs(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>Bs(e))).join(",")),"Target(".concat(t,")")}(jo(e)),"; limitType=").concat(e.limitType,")")}function Yo(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):ci.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of qo(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=io(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,qo(e),t))&&!(e.endAt&&!function(e,t,n){const r=io(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,qo(e),t))}(e,t)}function Jo(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function Xo(e){return(t,n)=>{let r=!1;for(const i of qo(e)){const e=$o(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function $o(e,t,n){const r=e.field.isKeyField()?ci.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?Vs(r,i):Fr()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return Fr()}}class Zo{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[r,i]of n)if(this.equalsFn(r,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){fs(this.inner,((t,n)=>{for(const[r,i]of n)e(r,i)}))}isEmpty(){return ps(this.inner)}size(){return this.innerSize}}const ea=new gs(ci.comparator);function ta(){return ea}const na=new gs(ci.comparator);function ra(){let e=na;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const i of n)e=e.insert(i.key,i);return e}function ia(e){let t=na;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function sa(){return aa()}function oa(){return aa()}function aa(){return new Zo((e=>e.toString()),((e,t)=>e.isEqual(t)))}const ca=new gs(ci.comparator),ua=new vs(ci.comparator);function la(){let e=ua;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const i of n)e=e.add(i);return e}const ha=new vs(Zr);function da(){return ha}function fa(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Li(t)?"-0":t}}function pa(e){return{integerValue:""+e}}function ga(e,t){return Mi(t)?pa(t):fa(e,t)}class ma{constructor(){this._=void 0}}function ya(e,t,n){return e instanceof _a?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&ks(t)&&(t=Ns(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Ia?ba(e,t):e instanceof Ta?Ea(e,t):function(e,t){const n=wa(e,t),r=Aa(n)+Aa(e.Ie);return zs(n)&&zs(e.Ie)?pa(r):fa(e.serializer,r)}(e,t)}function va(e,t,n){return e instanceof Ia?ba(e,t):e instanceof Ta?Ea(e,t):n}function wa(e,t){return e instanceof Sa?function(e){return zs(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class _a extends ma{}class Ia extends ma{constructor(e){super(),this.elements=e}}function ba(e,t){const n=Ca(t);for(const r of e.elements)n.some((e=>Ms(e,r)))||n.push(r);return{arrayValue:{values:n}}}class Ta extends ma{constructor(e){super(),this.elements=e}}function Ea(e,t){let n=Ca(t);for(const r of e.elements)n=n.filter((e=>!Ms(e,r)));return{arrayValue:{values:n}}}class Sa extends ma{constructor(e,t){super(),this.serializer=e,this.Ie=t}}function Aa(e){return As(e.integerValue||e.doubleValue)}function Ca(e){return Ks(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class ka{constructor(e,t){this.field=e,this.transform=t}}class Na{constructor(e,t){this.version=e,this.transformResults=t}}class Da{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Da}static exists(e){return new Da(void 0,e)}static updateTime(e){return new Da(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ra(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Pa{}function xa(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new za(e.key,Da.none()):new Va(e.key,e.data,Da.none());{const n=e.data,r=eo.empty();let i=new vs(ai.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new Ua(e.key,r,new Is(i.toArray()),Da.none())}}function Oa(e,t,n){e instanceof Va?function(e,t,n){const r=e.value.clone(),i=qa(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Ua?function(e,t,n){if(!Ra(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=qa(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(Ba(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function La(e,t,n,r){return e instanceof Va?function(e,t,n,r){if(!Ra(e.precondition,t))return n;const i=e.value.clone(),s=ja(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof Ua?function(e,t,n,r){if(!Ra(e.precondition,t))return n;const i=ja(e.fieldTransforms,r,t),s=t.data;return s.setAll(Ba(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,r):function(e,t,n){return Ra(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function Ma(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=wa(r.transform,e||null);null!=i&&(null===n&&(n=eo.empty()),n.set(r.field,i))}return n||null}function Fa(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&ei(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Ia&&t instanceof Ia||e instanceof Ta&&t instanceof Ta?ei(e.elements,t.elements,Ms):e instanceof Sa&&t instanceof Sa?Ms(e.Ie,t.Ie):e instanceof _a&&t instanceof _a}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class Va extends Pa{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Ua extends Pa{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Ba(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function qa(e,t,n){const r=new Map;Vr(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,va(o,a,n[i]))}return r}function ja(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,ya(e,s,t))}return r}class za extends Pa{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ka extends Pa{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Ga{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const t=this.mutations[r];t.key.isEqual(e.key)&&Oa(t,e,n[r])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=La(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=La(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=oa();return this.mutations.forEach((r=>{const i=e.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=t.has(r.key)?null:o;const a=xa(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(ri.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),la())}isEqual(e){return this.batchId===e.batchId&&ei(this.mutations,e.mutations,((e,t)=>Fa(e,t)))&&ei(this.baseMutations,e.baseMutations,((e,t)=>Fa(e,t)))}}class Wa{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){Vr(e.mutations.length===n.length);let r=ca;const i=e.mutations;for(let s=0;s<i.length;s++)r=r.insert(i[s].key,n[s].version);return new Wa(e,t,n,r)}}class Ha{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return"Overlay{\n      largestBatchId: ".concat(this.largestBatchId,",\n      mutation: ").concat(this.mutation.toString(),"\n    }")}}class Qa{constructor(e,t){this.count=e,this.unchangedNames=t}}var Ya,Ja;function Xa(e){switch(e){default:return Fr();case Br.CANCELLED:case Br.UNKNOWN:case Br.DEADLINE_EXCEEDED:case Br.RESOURCE_EXHAUSTED:case Br.INTERNAL:case Br.UNAVAILABLE:case Br.UNAUTHENTICATED:return!1;case Br.INVALID_ARGUMENT:case Br.NOT_FOUND:case Br.ALREADY_EXISTS:case Br.PERMISSION_DENIED:case Br.FAILED_PRECONDITION:case Br.ABORTED:case Br.OUT_OF_RANGE:case Br.UNIMPLEMENTED:case Br.DATA_LOSS:return!0}}function $a(e){if(void 0===e)return Or("GRPC error has no .code"),Br.UNKNOWN;switch(e){case Ya.OK:return Br.OK;case Ya.CANCELLED:return Br.CANCELLED;case Ya.UNKNOWN:return Br.UNKNOWN;case Ya.DEADLINE_EXCEEDED:return Br.DEADLINE_EXCEEDED;case Ya.RESOURCE_EXHAUSTED:return Br.RESOURCE_EXHAUSTED;case Ya.INTERNAL:return Br.INTERNAL;case Ya.UNAVAILABLE:return Br.UNAVAILABLE;case Ya.UNAUTHENTICATED:return Br.UNAUTHENTICATED;case Ya.INVALID_ARGUMENT:return Br.INVALID_ARGUMENT;case Ya.NOT_FOUND:return Br.NOT_FOUND;case Ya.ALREADY_EXISTS:return Br.ALREADY_EXISTS;case Ya.PERMISSION_DENIED:return Br.PERMISSION_DENIED;case Ya.FAILED_PRECONDITION:return Br.FAILED_PRECONDITION;case Ya.ABORTED:return Br.ABORTED;case Ya.OUT_OF_RANGE:return Br.OUT_OF_RANGE;case Ya.UNIMPLEMENTED:return Br.UNIMPLEMENTED;case Ya.DATA_LOSS:return Br.DATA_LOSS;default:return Fr()}}(Ja=Ya||(Ya={}))[Ja.OK=0]="OK",Ja[Ja.CANCELLED=1]="CANCELLED",Ja[Ja.UNKNOWN=2]="UNKNOWN",Ja[Ja.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ja[Ja.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ja[Ja.NOT_FOUND=5]="NOT_FOUND",Ja[Ja.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ja[Ja.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ja[Ja.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ja[Ja.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ja[Ja.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ja[Ja.ABORTED=10]="ABORTED",Ja[Ja.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ja[Ja.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ja[Ja.INTERNAL=13]="INTERNAL",Ja[Ja.UNAVAILABLE=14]="UNAVAILABLE",Ja[Ja.DATA_LOSS=15]="DATA_LOSS";let Za=null;function ec(){return new TextEncoder}const tc=new Cr([4294967295,4294967295],0);function nc(e){const t=ec().encode(e),n=new Ar;return n.update(t),new Uint8Array(n.digest())}function rc(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new Cr([n,r],0),new Cr([i,s],0)]}class ic{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new sc("Invalid padding: ".concat(t));if(n<0)throw new sc("Invalid hash count: ".concat(n));if(e.length>0&&0===this.hashCount)throw new sc("Invalid hash count: ".concat(n));if(0===e.length&&0!==t)throw new sc("Invalid padding when bitmap length is 0: ".concat(t));this.Te=8*e.length-t,this.Ee=Cr.fromNumber(this.Te)}de(e,t,n){let r=e.add(t.multiply(Cr.fromNumber(n)));return 1===r.compare(tc)&&(r=new Cr([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Ee).toNumber()}Ae(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Te)return!1;const t=nc(e),[n,r]=rc(t);for(let i=0;i<this.hashCount;i++){const e=this.de(n,r,i);if(!this.Ae(e))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new ic(i,r,t);return n.forEach((e=>s.insert(e))),s}insert(e){if(0===this.Te)return;const t=nc(e),[n,r]=rc(t);for(let i=0;i<this.hashCount;i++){const e=this.de(n,r,i);this.Re(e)}}Re(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class sc extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class oc{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,ac.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new oc(ri.min(),r,new gs(Zr),ta(),la())}}class ac{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new ac(n,t,la(),la(),la())}}class cc{constructor(e,t,n,r){this.Ve=e,this.removedTargetIds=t,this.key=n,this.me=r}}class uc{constructor(e,t){this.targetId=e,this.fe=t}}class lc{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ts.EMPTY_BYTE_STRING,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class hc{constructor(){this.ge=0,this.pe=pc(),this.ye=Ts.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return 0!==this.ge}get De(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.ye=e)}ve(){let e=la(),t=la(),n=la();return this.pe.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:Fr()}})),new ac(this.ye,this.we,e,t,n)}Fe(){this.Se=!1,this.pe=pc()}Me(e,t){this.Se=!0,this.pe=this.pe.insert(e,t)}xe(e){this.Se=!0,this.pe=this.pe.remove(e)}Oe(){this.ge+=1}Ne(){this.ge-=1,Vr(this.ge>=0)}Le(){this.Se=!0,this.we=!0}}class dc{constructor(e){this.Be=e,this.ke=new Map,this.qe=ta(),this.Qe=fc(),this.Ke=new gs(Zr)}$e(e){for(const t of e.Ve)e.me&&e.me.isFoundDocument()?this.Ue(t,e.me):this.We(t,e.key,e.me);for(const t of e.removedTargetIds)this.We(t,e.key,e.me)}Ge(e){this.forEachTarget(e,(t=>{const n=this.ze(t);switch(e.state){case 0:this.je(t)&&n.Ce(e.resumeToken);break;case 1:n.Ne(),n.be||n.Fe(),n.Ce(e.resumeToken);break;case 2:n.Ne(),n.be||this.removeTarget(t);break;case 3:this.je(t)&&(n.Le(),n.Ce(e.resumeToken));break;case 4:this.je(t)&&(this.He(t),n.Ce(e.resumeToken));break;default:Fr()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ke.forEach(((e,n)=>{this.je(n)&&t(n)}))}Je(e){const t=e.targetId,n=e.fe.count,r=this.Ye(t);if(r){const i=r.target;if(Po(i))if(0===n){const e=new ci(i.path);this.We(t,e,no.newNoDocument(e,ri.min()))}else Vr(1===n);else{const r=this.Ze(t);if(r!==n){const n=this.Xe(e),i=n?this.et(n,e,r):1;if(0!==i){this.He(t);const e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(t,e)}null==Za||Za.tt(function(e,t,n,r,i){var s,o,a,c,u,l;const h={localCacheCount:e,existenceFilterCount:t.count,databaseId:n.database,projectId:n.projectId},d=t.unchangedNames;return d&&(h.bloomFilter={applied:0===i,hashCount:null!==(s=null==d?void 0:d.hashCount)&&void 0!==s?s:0,bitmapLength:null!==(c=null===(a=null===(o=null==d?void 0:d.bits)||void 0===o?void 0:o.bitmap)||void 0===a?void 0:a.length)&&void 0!==c?c:0,padding:null!==(l=null===(u=null==d?void 0:d.bits)||void 0===u?void 0:u.padding)&&void 0!==l?l:0,mightContain:e=>{var t;return null!==(t=null==r?void 0:r.mightContain(e))&&void 0!==t&&t}}),h}(r,e.fe,this.Be.nt(),n,i))}}}}Xe(e){const t=e.fe.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=t;let s,o;try{s=Cs(n).toUint8Array()}catch(e){if(e instanceof bs)return Lr("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{o=new ic(s,r,i)}catch(e){return Lr(e instanceof sc?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===o.Te?null:o}et(e,t,n){return t.fe.count===n-this.rt(e,t.targetId)?0:2}rt(e,t){const n=this.Be.getRemoteKeysForTarget(t);let r=0;return n.forEach((n=>{const i=this.Be.nt(),s="projects/".concat(i.projectId,"/databases/").concat(i.database,"/documents/").concat(n.path.canonicalString());e.mightContain(s)||(this.We(t,n,null),r++)})),r}it(e){const t=new Map;this.ke.forEach(((n,r)=>{const i=this.Ye(r);if(i){if(n.current&&Po(i.target)){const t=new ci(i.target.path);null!==this.qe.get(t)||this.st(r,t)||this.We(r,t,no.newNoDocument(t,e))}n.De&&(t.set(r,n.ve()),n.Fe())}}));let n=la();this.Qe.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this.Ye(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))})),this.qe.forEach(((t,n)=>n.setReadTime(e)));const r=new oc(e,t,this.Ke,this.qe,n);return this.qe=ta(),this.Qe=fc(),this.Ke=new gs(Zr),r}Ue(e,t){if(!this.je(e))return;const n=this.st(e,t.key)?2:0;this.ze(e).Me(t.key,n),this.qe=this.qe.insert(t.key,t),this.Qe=this.Qe.insert(t.key,this.ot(t.key).add(e))}We(e,t,n){if(!this.je(e))return;const r=this.ze(e);this.st(e,t)?r.Me(t,1):r.xe(t),this.Qe=this.Qe.insert(t,this.ot(t).delete(e)),n&&(this.qe=this.qe.insert(t,n))}removeTarget(e){this.ke.delete(e)}Ze(e){const t=this.ze(e).ve();return this.Be.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Oe(e){this.ze(e).Oe()}ze(e){let t=this.ke.get(e);return t||(t=new hc,this.ke.set(e,t)),t}ot(e){let t=this.Qe.get(e);return t||(t=new vs(Zr),this.Qe=this.Qe.insert(e,t)),t}je(e){const t=null!==this.Ye(e);return t||xr("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){const t=this.ke.get(e);return t&&t.be?null:this.Be._t(e)}He(e){this.ke.set(e,new hc),this.Be.getRemoteKeysForTarget(e).forEach((t=>{this.We(e,t,null)}))}st(e,t){return this.Be.getRemoteKeysForTarget(e).has(t)}}function fc(){return new gs(ci.comparator)}function pc(){return new gs(ci.comparator)}const gc={asc:"ASCENDING",desc:"DESCENDING"},mc={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},yc={and:"AND",or:"OR"};class vc{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function wc(e,t){return e.useProto3Json||Oi(t)?t:{value:t}}function _c(e,t){return e.useProto3Json?"".concat(new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+t.nanoseconds).slice(-9),"Z"):{seconds:""+t.seconds,nanos:t.nanoseconds}}function Ic(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function bc(e,t){return _c(e,t.toTimestamp())}function Tc(e){return Vr(!!e),ri.fromTimestamp(function(e){const t=Ss(e);return new ni(t.seconds,t.nanos)}(e))}function Ec(e,t){return Sc(e,t).canonicalString()}function Sc(e,t){const n=function(e){return new si(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function Ac(e){const t=si.fromString(e);return Vr(Qc(t)),t}function Cc(e,t){return Ec(e.databaseId,t.path)}function kc(e,t){const n=Ac(t);if(n.get(1)!==e.databaseId.projectId)throw new qr(Br.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new qr(Br.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new ci(Pc(n))}function Nc(e,t){return Ec(e.databaseId,t)}function Dc(e){const t=Ac(e);return 4===t.length?si.emptyPath():Pc(t)}function Rc(e){return new si(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Pc(e){return Vr(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function xc(e,t,n){return{name:Cc(e,t),fields:n.value.mapValue.fields}}function Oc(e,t,n){const r=kc(e,t.name),i=Tc(t.updateTime),s=t.createTime?Tc(t.createTime):ri.min(),o=new eo({mapValue:{fields:t.fields}}),a=no.newFoundDocument(r,i,s,o);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}function Lc(e,t){let n;if(t instanceof Va)n={update:xc(e,t.key,t.value)};else if(t instanceof za)n={delete:Cc(e,t.key)};else if(t instanceof Ua)n={update:xc(e,t.key,t.data),updateMask:Hc(t.fieldMask)};else{if(!(t instanceof Ka))return Fr();n={verify:Cc(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof _a)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Ia)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Ta)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Sa)return{fieldPath:t.field.canonicalString(),increment:n.Ie};throw Fr()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:bc(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Fr()}(e,t.precondition)),n}function Mc(e,t){const n=t.currentDocument?function(e){return void 0!==e.updateTime?Da.updateTime(Tc(e.updateTime)):void 0!==e.exists?Da.exists(e.exists):Da.none()}(t.currentDocument):Da.none(),r=t.updateTransforms?t.updateTransforms.map((t=>function(e,t){let n=null;if("setToServerValue"in t)Vr("REQUEST_TIME"===t.setToServerValue),n=new _a;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new Ia(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new Ta(e)}else"increment"in t?n=new Sa(e,t.increment):Fr();const r=ai.fromServerFormat(t.fieldPath);return new ka(r,n)}(e,t))):[];if(t.update){t.update.name;const i=kc(e,t.update.name),s=new eo({mapValue:{fields:t.update.fields}});if(t.updateMask){const e=function(e){const t=e.fieldPaths||[];return new Is(t.map((e=>ai.fromServerFormat(e))))}(t.updateMask);return new Ua(i,s,e,n,r)}return new Va(i,s,n,r)}if(t.delete){const r=kc(e,t.delete);return new za(r,n)}if(t.verify){const r=kc(e,t.verify);return new Ka(r,n)}return Fr()}function Fc(e,t){return{documents:[Nc(e,t.path)]}}function Vc(e,t){const n={structuredQuery:{}},r=t.path;let i;null!==t.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=Nc(e,i);const s=function(e){if(0!==e.length)return Wc(lo.create(e,"and"))}(t.filters);s&&(n.structuredQuery.where=s);const o=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:Kc(e.field),direction:qc(e.dir)}}(e)))}(t.orderBy);o&&(n.structuredQuery.orderBy=o);const a=wc(e,t.limit);return null!==a&&(n.structuredQuery.limit=a),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{ut:n,parent:i}}function Uc(e){let t=Dc(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){Vr(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function(e){const t=Bc(e);return t instanceof lo&&po(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=function(e){return e.map((e=>function(e){return new oo(Gc(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)))}(n.orderBy));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,Oi(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new ro(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new ro(n,t)}(n.endAt)),Fo(t,i,o,s,a,"F",c,u)}function Bc(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Gc(e.unaryFilter.field);return uo.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Gc(e.unaryFilter.field);return uo.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Gc(e.unaryFilter.field);return uo.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Gc(e.unaryFilter.field);return uo.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Fr()}}(e):void 0!==e.fieldFilter?function(e){return uo.create(Gc(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Fr()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return lo.create(e.compositeFilter.filters.map((e=>Bc(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return Fr()}}(e.compositeFilter.op))}(e):Fr()}function qc(e){return gc[e]}function jc(e){return mc[e]}function zc(e){return yc[e]}function Kc(e){return{fieldPath:e.canonicalString()}}function Gc(e){return ai.fromServerFormat(e.fieldPath)}function Wc(e){return e instanceof uo?function(e){if("=="===e.op){if(Ws(e.value))return{unaryFilter:{field:Kc(e.field),op:"IS_NAN"}};if(Gs(e.value))return{unaryFilter:{field:Kc(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Ws(e.value))return{unaryFilter:{field:Kc(e.field),op:"IS_NOT_NAN"}};if(Gs(e.value))return{unaryFilter:{field:Kc(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Kc(e.field),op:jc(e.op),value:e.value}}}(e):e instanceof lo?function(e){const t=e.getFilters().map((e=>Wc(e)));return 1===t.length?t[0]:{compositeFilter:{op:zc(e.op),filters:t}}}(e):Fr()}function Hc(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function Qc(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class Yc{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ri.min(),s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:ri.min(),o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Ts.EMPTY_BYTE_STRING,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new Yc(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Yc(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Yc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Yc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Jc{constructor(e){this.ct=e}}function Xc(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:$c(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(e,t){return{name:Cc(e,t.key),fields:t.data.value.mapValue.fields,updateTime:_c(e,t.version.toTimestamp()),createTime:_c(e,t.createTime.toTimestamp())}}(e.ct,t);else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:Zc(t.version)};else{if(!t.isUnknownDocument())return Fr();r.unknownDocument={path:n.path.toArray(),version:Zc(t.version)}}return r}function $c(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Zc(e){const t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function eu(e){const t=new ni(e.seconds,e.nanoseconds);return ri.fromTimestamp(t)}function tu(e,t){const n=(t.baseMutations||[]).map((t=>Mc(e.ct,t)));for(let s=0;s<t.mutations.length-1;++s){const e=t.mutations[s];if(s+1<t.mutations.length&&void 0!==t.mutations[s+1].transform){const n=t.mutations[s+1];e.updateTransforms=n.transform.fieldTransforms,t.mutations.splice(s+1,1),++s}}const r=t.mutations.map((t=>Mc(e.ct,t))),i=ni.fromMillis(t.localWriteTimeMs);return new Ga(t.batchId,i,n,r)}function nu(e){const t=eu(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?eu(e.lastLimboFreeSnapshotVersion):ri.min();let r;return r=function(e){return void 0!==e.documents}(e.query)?function(e){return Vr(1===e.documents.length),jo(Vo(Dc(e.documents[0])))}(e.query):function(e){return jo(Uc(e))}(e.query),new Yc(r,e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,t,n,Ts.fromBase64String(e.resumeToken))}function ru(e,t){const n=Zc(t.snapshotVersion),r=Zc(t.lastLimboFreeSnapshotVersion);let i;i=Po(t.target)?Fc(e.ct,t.target):Vc(e.ct,t.target).ut;const s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:Do(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function iu(e){const t=Uc({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Go(t,t.limit,"L"):t}function su(e,t){return new Ha(t.largestBatchId,Mc(e.ct,t.overlayMutation))}function ou(e,t){const n=t.path.lastSegment();return[e,Fi(t.path.popLast()),n]}function au(e,t,n,r){return{indexId:e,uid:t,sequenceNumber:n,readTime:Zc(r.readTime),documentKey:Fi(r.documentKey.path),largestBatchId:r.largestBatchId}}class cu{getBundleMetadata(e,t){return uu(e).get(t).next((e=>{if(e)return function(e){return{id:e.bundleId,createTime:eu(e.createTime),version:e.version}}(e)}))}saveBundleMetadata(e,t){return uu(e).put(function(e){return{bundleId:e.id,createTime:Zc(Tc(e.createTime)),version:e.version}}(t))}getNamedQuery(e,t){return lu(e).get(t).next((e=>{if(e)return function(e){return{name:e.name,query:iu(e.bundledQuery),readTime:eu(e.readTime)}}(e)}))}saveNamedQuery(e,t){return lu(e).put(function(e){return{name:e.name,readTime:Zc(Tc(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}function uu(e){return hs(e,"bundles")}function lu(e){return hs(e,"namedQueries")}class hu{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const n=t.uid||"";return new hu(e,n)}getOverlay(e,t){return du(e).get(ou(this.userId,t)).next((e=>e?su(this.serializer,e):null))}getOverlays(e,t){const n=sa();return Ii.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){const r=[];return n.forEach(((n,i)=>{const s=new Ha(t,i);r.push(this.ht(e,s))})),Ii.waitFor(r)}removeOverlaysForBatchId(e,t,n){const r=new Set;t.forEach((e=>r.add(Fi(e.getCollectionPath()))));const i=[];return r.forEach((t=>{const r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(du(e).H("collectionPathOverlayIndex",r))})),Ii.waitFor(i)}getOverlaysForCollection(e,t,n){const r=sa(),i=Fi(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return du(e).W("collectionPathOverlayIndex",s).next((e=>{for(const t of e){const e=su(this.serializer,t);r.set(e.getKey(),e)}return r}))}getOverlaysForCollectionGroup(e,t,n,r){const i=sa();let s;const o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return du(e).Y({index:"collectionGroupOverlayIndex",range:o},((e,t,n)=>{const o=su(this.serializer,t);i.size()<r||o.largestBatchId===s?(i.set(o.getKey(),o),s=o.largestBatchId):n.done()})).next((()=>i))}ht(e,t){return du(e).put(function(e,t,n){const[r,i,s]=ou(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:Lc(e.ct,n.mutation)}}(this.serializer,this.userId,t))}}function du(e){return hs(e,"documentOverlays")}class fu{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(As(e.integerValue));else if("doubleValue"in e){const n=As(e.doubleValue);isNaN(n)?this.Et(t,13):(this.Et(t,15),Li(n)?t.dt(0):t.dt(n))}else if("timestampValue"in e){const n=e.timestampValue;this.Et(t,20),"string"==typeof n?t.At(n):(t.At("".concat(n.seconds||"")),t.dt(n.nanos||0))}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(Cs(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Et(t,45),t.dt(n.latitude||0),t.dt(n.longitude||0)}else"mapValue"in e?Ys(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):Fr()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){const n=e.fields||{};this.Et(t,55);for(const r of Object.keys(n))this.Rt(r,t),this.It(n[r],t)}wt(e,t){const n=e.values||[];this.Et(t,50);for(const r of n)this.It(r,t)}gt(e,t){this.Et(t,37),ci.fromName(e).path.forEach((e=>{this.Et(t,60),this.St(e,t)}))}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}}function pu(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function gu(e){const t=64-function(e){let t=0;for(let n=0;n<8;++n){const r=pu(255&e[n]);if(t+=r,8!==r)break}return t}(e);return Math.ceil(t/8)}fu.bt=new fu;class mu{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Dt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ct(n.value),n=t.next();this.vt()}Ft(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Mt(n.value),n=t.next();this.xt()}Ot(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Ct(e);else if(e<2048)this.Ct(960|e>>>6),this.Ct(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ct(480|e>>>12),this.Ct(128|63&e>>>6),this.Ct(128|63&e);else{const e=t.codePointAt(0);this.Ct(240|e>>>18),this.Ct(128|63&e>>>12),this.Ct(128|63&e>>>6),this.Ct(128|63&e)}}this.vt()}Nt(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Mt(e);else if(e<2048)this.Mt(960|e>>>6),this.Mt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Mt(480|e>>>12),this.Mt(128|63&e>>>6),this.Mt(128|63&e);else{const e=t.codePointAt(0);this.Mt(240|e>>>18),this.Mt(128|63&e>>>12),this.Mt(128|63&e>>>6),this.Mt(128|63&e)}}this.xt()}Lt(e){const t=this.Bt(e),n=gu(t);this.kt(1+n),this.buffer[this.position++]=255&n;for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=255&t[r]}qt(e){const t=this.Bt(e),n=gu(t);this.kt(1+n),this.buffer[this.position++]=~(255&n);for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}Qt(){this.Kt(255),this.Kt(255)}$t(){this.Ut(255),this.Ut(255)}reset(){this.position=0}seed(e){this.kt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Wt(){return this.buffer.slice(0,this.position)}Bt(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let r=1;r<t.length;++r)t[r]^=n?255:0;return t}Ct(e){const t=255&e;0===t?(this.Kt(0),this.Kt(255)):255===t?(this.Kt(255),this.Kt(0)):this.Kt(t)}Mt(e){const t=255&e;0===t?(this.Ut(0),this.Ut(255)):255===t?(this.Ut(255),this.Ut(0)):this.Ut(e)}vt(){this.Kt(0),this.Kt(1)}xt(){this.Ut(0),this.Ut(1)}Kt(e){this.kt(1),this.buffer[this.position++]=e}Ut(e){this.kt(1),this.buffer[this.position++]=~e}kt(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class yu{constructor(e){this.Gt=e}ft(e){this.Gt.Dt(e)}At(e){this.Gt.Ot(e)}dt(e){this.Gt.Lt(e)}Tt(){this.Gt.Qt()}}class vu{constructor(e){this.Gt=e}ft(e){this.Gt.Ft(e)}At(e){this.Gt.Nt(e)}dt(e){this.Gt.qt(e)}Tt(){this.Gt.$t()}}class wu{constructor(){this.Gt=new mu,this.zt=new yu(this.Gt),this.jt=new vu(this.Gt)}seed(e){this.Gt.seed(e)}Ht(e){return 0===e?this.zt:this.jt}Wt(){return this.Gt.Wt()}reset(){this.Gt.reset()}}class _u{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}Jt(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new _u(this.indexId,this.documentKey,this.arrayValue,n)}}function Iu(e,t){let n=e.indexId-t.indexId;return 0!==n?n:(n=bu(e.arrayValue,t.arrayValue),0!==n?n:(n=bu(e.directionalValue,t.directionalValue),0!==n?n:ci.comparator(e.documentKey,t.documentKey)))}function bu(e,t){for(let n=0;n<e.length&&n<t.length;++n){const r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}class Tu{constructor(e){this.Yt=new vs(((e,t)=>ai.comparator(e.field,t.field))),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Zt=e.orderBy,this.Xt=[];for(const t of e.filters){const e=t;e.isInequality()?this.Yt=this.Yt.add(e):this.Xt.push(e)}}get en(){return this.Yt.size>1}tn(e){if(Vr(e.collectionGroup===this.collectionId),this.en)return!1;const t=li(e);if(void 0!==t&&!this.nn(t))return!1;const n=hi(e);let r=new Set,i=0,s=0;for(;i<n.length&&this.nn(n[i]);++i)r=r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.Yt.size>0){const e=this.Yt.getIterator().getNext();if(!r.has(e.field.canonicalString())){const t=n[i];if(!this.rn(e,t)||!this.sn(this.Zt[s++],t))return!1}++i}for(;i<n.length;++i){const e=n[i];if(s>=this.Zt.length||!this.sn(this.Zt[s++],e))return!1}return!0}on(){if(this.en)return null;let e=new vs(ai.comparator);const t=[];for(const n of this.Xt)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new di(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new di(n.field,0))}for(const n of this.Zt)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new di(n.field,"asc"===n.dir?0:1)));return new ui(ui.UNKNOWN_ID,this.collectionId,t,fi.empty())}nn(e){for(const t of this.Xt)if(this.rn(t,e))return!0;return!1}rn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;const n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function Eu(e){var t,n;if(Vr(e instanceof uo||e instanceof lo),e instanceof uo){if(e instanceof So){const r=(null===(n=null===(t=e.value.arrayValue)||void 0===t?void 0:t.values)||void 0===n?void 0:n.map((t=>uo.create(e.field,"==",t))))||[];return lo.create(r,"or")}return e}const r=e.filters.map((e=>Eu(e)));return lo.create(r,e.op)}function Su(e){if(0===e.getFilters().length)return[];const t=Nu(Eu(e));return Vr(ku(t)),Au(t)||Cu(t)?[t]:t.getFilters()}function Au(e){return e instanceof uo}function Cu(e){return e instanceof lo&&po(e)}function ku(e){return Au(e)||Cu(e)||function(e){if(e instanceof lo&&fo(e)){for(const t of e.getFilters())if(!Au(t)&&!Cu(t))return!1;return!0}return!1}(e)}function Nu(e){if(Vr(e instanceof uo||e instanceof lo),e instanceof uo)return e;if(1===e.filters.length)return Nu(e.filters[0]);const t=e.filters.map((e=>Nu(e)));let n=lo.create(t,e.op);return n=Pu(n),ku(n)?n:(Vr(n instanceof lo),Vr(ho(n)),Vr(n.filters.length>1),n.filters.reduce(((e,t)=>Du(e,t))))}function Du(e,t){let n;return Vr(e instanceof uo||e instanceof lo),Vr(t instanceof uo||t instanceof lo),n=e instanceof uo?t instanceof uo?function(e,t){return lo.create([e,t],"and")}(e,t):Ru(e,t):t instanceof uo?Ru(t,e):function(e,t){if(Vr(e.filters.length>0&&t.filters.length>0),ho(e)&&ho(t))return vo(e,t.getFilters());const n=fo(e)?e:t,r=fo(e)?t:e,i=n.filters.map((e=>Du(e,r)));return lo.create(i,"or")}(e,t),Pu(n)}function Ru(e,t){if(ho(t))return vo(t,e.getFilters());{const n=t.filters.map((t=>Du(e,t)));return lo.create(n,"or")}}function Pu(e){if(Vr(e instanceof uo||e instanceof lo),e instanceof uo)return e;const t=e.getFilters();if(1===t.length)return Pu(t[0]);if(go(e))return e;const n=t.map((e=>Pu(e))),r=[];return n.forEach((t=>{t instanceof uo?r.push(t):t instanceof lo&&(t.op===e.op?r.push(...t.filters):r.push(t))})),1===r.length?r[0]:lo.create(r,e.op)}class xu{constructor(){this._n=new Ou}addToCollectionParentIndex(e,t){return this._n.add(t),Ii.resolve()}getCollectionParents(e,t){return Ii.resolve(this._n.getEntries(t))}addFieldIndex(e,t){return Ii.resolve()}deleteFieldIndex(e,t){return Ii.resolve()}deleteAllFieldIndexes(e){return Ii.resolve()}createTargetIndexes(e,t){return Ii.resolve()}getDocumentsMatchingTarget(e,t){return Ii.resolve(null)}getIndexType(e,t){return Ii.resolve(0)}getFieldIndexes(e,t){return Ii.resolve([])}getNextCollectionGroupToUpdate(e){return Ii.resolve(null)}getMinOffset(e,t){return Ii.resolve(mi.min())}getMinOffsetFromCollectionGroup(e,t){return Ii.resolve(mi.min())}updateCollectionGroup(e,t,n){return Ii.resolve()}updateIndexEntries(e,t){return Ii.resolve()}}class Ou{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new vs(si.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new vs(si.comparator)).toArray()}}const Lu=new Uint8Array(0);class Mu{constructor(e,t){this.databaseId=t,this.an=new Ou,this.un=new Zo((e=>Do(e)),((e,t)=>Ro(e,t))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.an.has(t)){const n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener((()=>{this.an.add(t)}));const i={collectionId:n,parent:Fi(r)};return Fu(e).put(i)}return Ii.resolve()}getCollectionParents(e,t){const n=[],r=IDBKeyRange.bound([t,""],[ti(t),""],!1,!0);return Fu(e).W(r).next((e=>{for(const r of e){if(r.collectionId!==t)break;n.push(Bi(r.parent))}return n}))}addFieldIndex(e,t){const n=Uu(e),r=function(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map((e=>[e.fieldPath.canonicalString(),e.kind]))}}(t);delete r.indexId;const i=n.add(r);if(t.indexState){const n=Bu(e);return i.next((e=>{n.put(au(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))}))}return i.next()}deleteFieldIndex(e,t){const n=Uu(e),r=Bu(e),i=Vu(e);return n.delete(t.indexId).next((()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}deleteAllFieldIndexes(e){const t=Uu(e),n=Vu(e),r=Bu(e);return t.H().next((()=>n.H())).next((()=>r.H()))}createTargetIndexes(e,t){return Ii.forEach(this.cn(t),(t=>this.getIndexType(e,t).next((n=>{if(0===n||1===n){const n=new Tu(t).on();if(null!=n)return this.addFieldIndex(e,n)}}))))}getDocumentsMatchingTarget(e,t){const n=Vu(e);let r=!0;const i=new Map;return Ii.forEach(this.cn(t),(t=>this.ln(e,t).next((e=>{r&&(r=!!e),i.set(t,e)})))).next((()=>{if(r){let e=la();const r=[];return Ii.forEach(i,((i,s)=>{xr("IndexedDbIndexManager","Using index ".concat(function(e){return"id=".concat(e.indexId,"|cg=").concat(e.collectionGroup,"|f=").concat(e.fields.map((e=>"".concat(e.fieldPath,":").concat(e.kind))).join(","))}(i)," to execute ").concat(Do(t)));const o=function(e,t){const n=li(t);if(void 0===n)return null;for(const r of xo(e,n.fieldPath))switch(r.op){case"array-contains-any":return r.value.arrayValue.values||[];case"array-contains":return[r.value]}return null}(s,i),a=function(e,t){const n=new Map;for(const r of hi(t))for(const t of xo(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),c=function(e,t){const n=[];let r=!0;for(const i of hi(t)){const t=0===i.kind?Oo(e,i.fieldPath,e.startAt):Lo(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new ro(n,r)}(s,i),u=function(e,t){const n=[];let r=!0;for(const i of hi(t)){const t=0===i.kind?Lo(e,i.fieldPath,e.endAt):Oo(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new ro(n,r)}(s,i),l=this.hn(i,s,c),h=this.hn(i,s,u),d=this.Pn(i,s,a),f=this.In(i.indexId,o,l,c.inclusive,h,u.inclusive,d);return Ii.forEach(f,(i=>n.j(i,t.limit).next((t=>{t.forEach((t=>{const n=ci.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))}))}))))})).next((()=>r))}return Ii.resolve(null)}))}cn(e){let t=this.un.get(e);return t||(t=0===e.filters.length?[e]:Su(lo.create(e.filters,"and")).map((t=>No(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt))),this.un.set(e,t),t)}In(e,t,n,r,i,s,o){const a=(null!=t?t.length:1)*Math.max(n.length,i.length),c=a/(null!=t?t.length:1),u=[];for(let l=0;l<a;++l){const a=t?this.Tn(t[l/c]):Lu,h=this.En(e,a,n[l%c],r),d=this.dn(e,a,i[l%c],s),f=o.map((t=>this.En(e,a,t,!0)));u.push(...this.createRange(h,d,f))}return u}En(e,t,n,r){const i=new _u(e,ci.empty(),t,n);return r?i:i.Jt()}dn(e,t,n,r){const i=new _u(e,ci.empty(),t,n);return r?i.Jt():i}ln(e,t){const n=new Tu(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next((e=>{let t=null;for(const r of e)n.tn(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t}))}getIndexType(e,t){let n=2;const r=this.cn(t);return Ii.forEach(r,(t=>this.ln(e,t).next((e=>{e?0!==n&&e.fields.length<function(e){let t=new vs(ai.comparator),n=!1;for(const r of e.filters)for(const e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(const r of e.orderBy)r.field.isKeyField()||(t=t.add(r.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})))).next((()=>function(e){return null!==e.limit}(t)&&r.length>1&&2===n?1:n))}An(e,t){const n=new wu;for(const r of hi(e)){const e=t.data.field(r.fieldPath);if(null==e)return null;const i=n.Ht(r.kind);fu.bt.Pt(e,i)}return n.Wt()}Tn(e){const t=new wu;return fu.bt.Pt(e,t.Ht(0)),t.Wt()}Rn(e,t){const n=new wu;return fu.bt.Pt(js(this.databaseId,t),n.Ht(function(e){const t=hi(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.Wt()}Pn(e,t,n){if(null===n)return[];let r=[];r.push(new wu);let i=0;for(const s of hi(e)){const e=n[i++];for(const n of r)if(this.Vn(t,s.fieldPath)&&Ks(e))r=this.mn(r,s,e);else{const t=n.Ht(s.kind);fu.bt.Pt(e,t)}}return this.fn(r)}hn(e,t,n){return this.Pn(e,t,n.position)}fn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Wt();return t}mn(e,t,n){const r=[...e],i=[];for(const s of n.arrayValue.values||[])for(const e of r){const n=new wu;n.seed(e.Wt()),fu.bt.Pt(s,n.Ht(t.kind)),i.push(n)}return i}Vn(e,t){return!!e.filters.find((e=>e instanceof uo&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op)))}getFieldIndexes(e,t){const n=Uu(e),r=Bu(e);return(t?n.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.W()).next((e=>{const t=[];return Ii.forEach(e,(e=>r.get([e.indexId,this.uid]).next((n=>{t.push(function(e,t){const n=t?new fi(t.sequenceNumber,new mi(eu(t.readTime),new ci(Bi(t.documentKey)),t.largestBatchId)):fi.empty(),r=e.fields.map((e=>{let[t,n]=e;return new di(ai.fromServerFormat(t),n)}));return new ui(e.indexId,e.collectionGroup,r,n)}(e,n))})))).next((()=>t))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((e=>0===e.length?null:(e.sort(((e,t)=>{const n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:Zr(e.collectionGroup,t.collectionGroup)})),e[0].collectionGroup)))}updateCollectionGroup(e,t,n){const r=Uu(e),i=Bu(e);return this.gn(e).next((e=>r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next((t=>Ii.forEach(t,(t=>i.put(au(t.indexId,this.uid,e,n))))))))}updateIndexEntries(e,t){const n=new Map;return Ii.forEach(t,((t,r)=>{const i=n.get(t.collectionGroup);return(i?Ii.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next((i=>(n.set(t.collectionGroup,i),Ii.forEach(i,(n=>this.pn(e,t,n).next((t=>{const i=this.yn(r,n);return t.isEqual(i)?Ii.resolve():this.wn(e,r,n,t,i)})))))))}))}Sn(e,t,n,r){return Vu(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.Rn(n,t.key),documentKey:t.key.path.toArray()})}bn(e,t,n,r){return Vu(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.Rn(n,t.key),t.key.path.toArray()])}pn(e,t,n){const r=Vu(e);let i=new vs(Iu);return r.Y({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.Rn(n,t)])},((e,r)=>{i=i.add(new _u(n.indexId,t,r.arrayValue,r.directionalValue))})).next((()=>i))}yn(e,t){let n=new vs(Iu);const r=this.An(t,e);if(null==r)return n;const i=li(t);if(null!=i){const s=e.data.field(i.fieldPath);if(Ks(s))for(const i of s.arrayValue.values||[])n=n.add(new _u(t.indexId,e.key,this.Tn(i),r))}else n=n.add(new _u(t.indexId,e.key,Lu,r));return n}wn(e,t,n,r,i){xr("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const s=[];return function(e,t,n,r,i){const s=e.getIterator(),o=t.getIterator();let a=_s(s),c=_s(o);for(;a||c;){let e=!1,t=!1;if(a&&c){const r=n(a,c);r<0?t=!0:r>0&&(e=!0)}else null!=a?t=!0:e=!0;e?(r(c),c=_s(o)):t?(i(a),a=_s(s)):(a=_s(s),c=_s(o))}}(r,i,Iu,(r=>{s.push(this.Sn(e,t,n,r))}),(r=>{s.push(this.bn(e,t,n,r))})),Ii.waitFor(s)}gn(e){let t=1;return Bu(e).Y({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((e,n,r)=>{r.done(),t=n.sequenceNumber+1})).next((()=>t))}createRange(e,t,n){n=n.sort(((e,t)=>Iu(e,t))).filter(((e,t,n)=>!t||0!==Iu(e,n[t-1])));const r=[];r.push(e);for(const s of n){const n=Iu(s,e),i=Iu(s,t);if(0===n)r[0]=e.Jt();else if(n>0&&i<0)r.push(s),r.push(s.Jt());else if(i>0)break}r.push(t);const i=[];for(let s=0;s<r.length;s+=2){if(this.Dn(r[s],r[s+1]))return[];const e=[r[s].indexId,this.uid,r[s].arrayValue,r[s].directionalValue,Lu,[]],t=[r[s+1].indexId,this.uid,r[s+1].arrayValue,r[s+1].directionalValue,Lu,[]];i.push(IDBKeyRange.bound(e,t))}return i}Dn(e,t){return Iu(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(qu)}getMinOffset(e,t){return Ii.mapArray(this.cn(t),(t=>this.ln(e,t).next((e=>e||Fr())))).next(qu)}}function Fu(e){return hs(e,"collectionParents")}function Vu(e){return hs(e,"indexEntries")}function Uu(e){return hs(e,"indexConfiguration")}function Bu(e){return hs(e,"indexState")}function qu(e){Vr(0!==e.length);let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){const i=e[r].indexState.offset;yi(i,t)<0&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new mi(t.readTime,t.documentKey,n)}const ju={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class zu{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new zu(e,zu.DEFAULT_COLLECTION_PERCENTILE,zu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Ku(e,t,n){const r=e.store("mutations"),i=e.store("documentMutations"),s=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.Y({range:o},((e,t,n)=>(a++,n.delete())));s.push(c.next((()=>{Vr(1===a)})));const u=[];for(const l of n.mutations){const e=zi(t,l.key.path,n.batchId);s.push(i.delete(e)),u.push(l.key)}return Ii.waitFor(s).next((()=>u))}function Gu(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw Fr();t=e.noDocument}return JSON.stringify(t).length}zu.DEFAULT_COLLECTION_PERCENTILE=10,zu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,zu.DEFAULT=new zu(41943040,zu.DEFAULT_COLLECTION_PERCENTILE,zu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),zu.DISABLED=new zu(-1,0,0);class Wu{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.Cn={}}static lt(e,t,n,r){Vr(""!==e.uid);const i=e.isAuthenticated()?e.uid:"";return new Wu(i,t,n,r)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Qu(e).Y({index:"userMutationsIndex",range:n},((e,n,r)=>{t=!1,r.done()})).next((()=>t))}addMutationBatch(e,t,n,r){const i=Yu(e),s=Qu(e);return s.add({}).next((o=>{Vr("number"==typeof o);const a=new Ga(o,t,n,r),c=function(e,t,n){const r=n.baseMutations.map((t=>Lc(e.ct,t))),i=n.mutations.map((t=>Lc(e.ct,t)));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}(this.serializer,this.userId,a),u=[];let l=new vs(((e,t)=>Zr(e.canonicalString(),t.canonicalString())));for(const e of r){const t=zi(this.userId,e.key.path,o);l=l.add(e.key.path.popLast()),u.push(s.put(c)),u.push(i.put(t,Ki))}return l.forEach((t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))})),e.addOnCommittedListener((()=>{this.Cn[o]=a.keys()})),Ii.waitFor(u).next((()=>a))}))}lookupMutationBatch(e,t){return Qu(e).get(t).next((e=>e?(Vr(e.userId===this.userId),tu(this.serializer,e)):null))}vn(e,t){return this.Cn[t]?Ii.resolve(this.Cn[t]):this.lookupMutationBatch(e,t).next((e=>{if(e){const n=e.keys();return this.Cn[t]=n,n}return null}))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return Qu(e).Y({index:"userMutationsIndex",range:r},((e,t,r)=>{t.userId===this.userId&&(Vr(t.batchId>=n),i=tu(this.serializer,t)),r.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return Qu(e).Y({index:"userMutationsIndex",range:t,reverse:!0},((e,t,r)=>{n=t.batchId,r.done()})).next((()=>n))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Qu(e).W("userMutationsIndex",t).next((e=>e.map((e=>tu(this.serializer,e)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=ji(this.userId,t.path),r=IDBKeyRange.lowerBound(n),i=[];return Yu(e).Y({range:r},((n,r,s)=>{const[o,a,c]=n,u=Bi(a);if(o===this.userId&&t.path.isEqual(u))return Qu(e).get(c).next((e=>{if(!e)throw Fr();Vr(e.userId===this.userId),i.push(tu(this.serializer,e))}));s.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new vs(Zr);const r=[];return t.forEach((t=>{const i=ji(this.userId,t.path),s=IDBKeyRange.lowerBound(i),o=Yu(e).Y({range:s},((e,r,i)=>{const[s,o,a]=e,c=Bi(o);s===this.userId&&t.path.isEqual(c)?n=n.add(a):i.done()}));r.push(o)})),Ii.waitFor(r).next((()=>this.Fn(e,n)))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1,i=ji(this.userId,n),s=IDBKeyRange.lowerBound(i);let o=new vs(Zr);return Yu(e).Y({range:s},((e,t,i)=>{const[s,a,c]=e,u=Bi(a);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(o=o.add(c)):i.done()})).next((()=>this.Fn(e,o)))}Fn(e,t){const n=[],r=[];return t.forEach((t=>{r.push(Qu(e).get(t).next((e=>{if(null===e)throw Fr();Vr(e.userId===this.userId),n.push(tu(this.serializer,e))})))})),Ii.waitFor(r).next((()=>n))}removeMutationBatch(e,t){return Ku(e.ae,this.userId,t).next((n=>(e.addOnCommittedListener((()=>{this.Mn(t.batchId)})),Ii.forEach(n,(t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))))}Mn(e){delete this.Cn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return Ii.resolve();const n=IDBKeyRange.lowerBound(function(e){return[e]}(this.userId)),r=[];return Yu(e).Y({range:n},((e,t,n)=>{if(e[0]===this.userId){const t=Bi(e[1]);r.push(t)}else n.done()})).next((()=>{Vr(0===r.length)}))}))}containsKey(e,t){return Hu(e,this.userId,t)}xn(e){return Ju(e).get(this.userId).next((e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""}))}}function Hu(e,t,n){const r=ji(t,n.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return Yu(e).Y({range:s,J:!0},((e,n,r)=>{const[s,a,c]=e;s===t&&a===i&&(o=!0),r.done()})).next((()=>o))}function Qu(e){return hs(e,"mutations")}function Yu(e){return hs(e,"documentMutations")}function Ju(e){return hs(e,"mutationQueues")}class Xu{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new Xu(0)}static Ln(){return new Xu(-1)}}class $u{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Bn(e).next((t=>{const n=new Xu(t.highestTargetId);return t.highestTargetId=n.next(),this.kn(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.Bn(e).next((e=>ri.fromTimestamp(new ni(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.Bn(e).next((e=>e.highestListenSequenceNumber))}setTargetsMetadata(e,t,n){return this.Bn(e).next((r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.kn(e,r))))}addTargetData(e,t){return this.qn(e,t).next((()=>this.Bn(e).next((n=>(n.targetCount+=1,this.Qn(t,n),this.kn(e,n))))))}updateTargetData(e,t){return this.qn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>Zu(e).delete(t.targetId))).next((()=>this.Bn(e))).next((t=>(Vr(t.targetCount>0),t.targetCount-=1,this.kn(e,t))))}removeTargets(e,t,n){let r=0;const i=[];return Zu(e).Y(((s,o)=>{const a=nu(o);a.sequenceNumber<=t&&null===n.get(a.targetId)&&(r++,i.push(this.removeTargetData(e,a)))})).next((()=>Ii.waitFor(i))).next((()=>r))}forEachTarget(e,t){return Zu(e).Y(((e,n)=>{const r=nu(n);t(r)}))}Bn(e){return el(e).get("targetGlobalKey").next((e=>(Vr(null!==e),e)))}kn(e,t){return el(e).put("targetGlobalKey",t)}qn(e,t){return Zu(e).put(ru(this.serializer,t))}Qn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Bn(e).next((e=>e.targetCount))}getTargetData(e,t){const n=Do(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return Zu(e).Y({range:r,index:"queryTargetsIndex"},((e,n,r)=>{const s=nu(n);Ro(t,s.target)&&(i=s,r.done())})).next((()=>i))}addMatchingKeys(e,t,n){const r=[],i=tl(e);return t.forEach((t=>{const s=Fi(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))})),Ii.waitFor(r)}removeMatchingKeys(e,t,n){const r=tl(e);return Ii.forEach(t,(t=>{const i=Fi(t.path);return Ii.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])}))}removeMatchingKeysForTargetId(e,t){const n=tl(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=tl(e);let i=la();return r.Y({range:n,J:!0},((e,t,n)=>{const r=Bi(e[1]),s=new ci(r);i=i.add(s)})).next((()=>i))}containsKey(e,t){const n=Fi(t.path),r=IDBKeyRange.bound([n],[ti(n)],!1,!0);let i=0;return tl(e).Y({index:"documentTargetsIndex",J:!0,range:r},((e,t,n)=>{let[r,s]=e;0!==r&&(i++,n.done())})).next((()=>i>0))}_t(e,t){return Zu(e).get(t).next((e=>e?nu(e):null))}}function Zu(e){return hs(e,"targets")}function el(e){return hs(e,"targetGlobal")}function tl(e){return hs(e,"targetDocuments")}function nl(e,t){let[n,r]=e,[i,s]=t;const o=Zr(n,i);return 0===o?Zr(r,s):o}class rl{constructor(e){this.Kn=e,this.buffer=new vs(nl),this.$n=0}Un(){return++this.$n}Wn(e){const t=[e,this.Un()];if(this.buffer.size<this.Kn)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();nl(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class il{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Gn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.zn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return null!==this.Gn}zn(e){xr("LruGarbageCollector","Garbage collection scheduled in ".concat(e,"ms")),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Gn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Ai(e)?xr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await _i(e)}await this.zn(3e5)}))}}class sl{constructor(e,t){this.jn=e,this.params=t}calculateTargetCount(e,t){return this.jn.Hn(e).next((e=>Math.floor(t/100*e)))}nthSequenceNumber(e,t){if(0===t)return Ii.resolve(xi._e);const n=new rl(t);return this.jn.forEachTarget(e,(e=>n.Wn(e.sequenceNumber))).next((()=>this.jn.Jn(e,(e=>n.Wn(e))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.jn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(xr("LruGarbageCollector","Garbage collection skipped; disabled"),Ii.resolve(ju)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(xr("LruGarbageCollector","Garbage collection skipped; Cache size ".concat(n," is lower than threshold ").concat(this.params.cacheSizeCollectionThreshold)),ju):this.Yn(e,t)))}getCacheSize(e){return this.jn.getCacheSize(e)}Yn(e,t){let n,r,i,s,o,c,u;const l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((t=>(t>this.params.maximumSequenceNumbersToCollect?(xr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of ".concat(this.params.maximumSequenceNumbersToCollect," from ").concat(t)),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r)))).next((r=>(n=r,o=Date.now(),this.removeTargets(e,n,t)))).next((t=>(i=t,c=Date.now(),this.removeOrphanedDocuments(e,n)))).next((e=>(u=Date.now(),Pr()<=a.$b.DEBUG&&xr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in ".concat(s-l,"ms\n\tDetermined least recently used ").concat(r," in ")+(o-s)+"ms\n"+"\tRemoved ".concat(i," targets in ")+(c-o)+"ms\n"+"\tRemoved ".concat(e," documents in ")+(u-c)+"ms\n"+"Total Duration: ".concat(u-l,"ms")),Ii.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e}))))}}function ol(e,t){return new sl(e,t)}class al{constructor(e,t){this.db=e,this.garbageCollector=ol(this,t)}Hn(e){const t=this.Zn(e);return this.db.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}Zn(e){let t=0;return this.Jn(e,(e=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Jn(e,t){return this.Xn(e,((e,n)=>t(n)))}addReference(e,t,n){return cl(e,n)}removeReference(e,t,n){return cl(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return cl(e,t)}er(e,t){return function(e,t){let n=!1;return Ju(e).Z((r=>Hu(e,r,t).next((e=>(e&&(n=!0),Ii.resolve(!e)))))).next((()=>n))}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.Xn(e,((s,o)=>{if(o<=t){const t=this.er(e,s).next((t=>{if(!t)return i++,n.getEntry(e,s).next((()=>(n.removeEntry(s,ri.min()),tl(e).delete(function(e){return[0,Fi(e.path)]}(s)))))}));r.push(t)}})).next((()=>Ii.waitFor(r))).next((()=>n.apply(e))).next((()=>i))}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return cl(e,t)}Xn(e,t){const n=tl(e);let r,i=xi._e;return n.Y({index:"documentTargetsIndex"},((e,n)=>{let[s,o]=e,{path:a,sequenceNumber:c}=n;0===s?(i!==xi._e&&t(new ci(Bi(r)),i),i=c,r=a):i=xi._e})).next((()=>{i!==xi._e&&t(new ci(Bi(r)),i)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function cl(e,t){return tl(e).put(function(e,t){return{targetId:0,path:Fi(e.path),sequenceNumber:t}}(t,e.currentSequenceNumber))}class ul{constructor(){this.changes=new Zo((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,no.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Ii.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class ll{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return pl(e).put(n)}removeEntry(e,t,n){return pl(e).delete(function(e,t){const n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],$c(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next((n=>(n.byteSize+=t,this.tr(e,n))))}getEntry(e,t){let n=no.newInvalidDocument(t);return pl(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(gl(t))},((e,r)=>{n=this.nr(t,r)})).next((()=>n))}rr(e,t){let n={size:0,document:no.newInvalidDocument(t)};return pl(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(gl(t))},((e,r)=>{n={document:this.nr(t,r),size:Gu(r)}})).next((()=>n))}getEntries(e,t){let n=ta();return this.ir(e,t,((e,t)=>{const r=this.nr(e,t);n=n.insert(e,r)})).next((()=>n))}sr(e,t){let n=ta(),r=new gs(ci.comparator);return this.ir(e,t,((e,t)=>{const i=this.nr(e,t);n=n.insert(e,i),r=r.insert(e,Gu(t))})).next((()=>({documents:n,_r:r})))}ir(e,t,n){if(t.isEmpty())return Ii.resolve();let r=new vs(yl);t.forEach((e=>r=r.add(e)));const i=IDBKeyRange.bound(gl(r.first()),gl(r.last())),s=r.getIterator();let o=s.getNext();return pl(e).Y({index:"documentKeyIndex",range:i},((e,t,r)=>{const i=ci.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;o&&yl(o,i)<0;)n(o,null),o=s.getNext();o&&o.isEqual(i)&&(n(o,t),o=s.hasNext()?s.getNext():null),o?r.U(gl(o)):r.done()})).next((()=>{for(;o;)n(o,null),o=s.hasNext()?s.getNext():null}))}getDocumentsMatchingQuery(e,t,n,r,i){const s=t.path,o=[s.popLast().toArray(),s.lastSegment(),$c(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],a=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return pl(e).W(IDBKeyRange.bound(o,a,!0)).next((e=>{null==i||i.incrementDocumentReadCount(e.length);let n=ta();for(const i of e){const e=this.nr(ci.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(Yo(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n}))}getAllFromCollectionGroup(e,t,n,r){let i=ta();const s=ml(t,n),o=ml(t,mi.max());return pl(e).Y({index:"collectionGroupIndex",range:IDBKeyRange.bound(s,o,!0)},((e,t,n)=>{const s=this.nr(ci.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);i=i.insert(s.key,s),i.size===r&&n.done()})).next((()=>i))}newChangeBuffer(e){return new dl(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((e=>e.byteSize))}getMetadata(e){return fl(e).get("remoteDocumentGlobalKey").next((e=>(Vr(!!e),e)))}tr(e,t){return fl(e).put("remoteDocumentGlobalKey",t)}nr(e,t){if(t){const e=function(e,t){let n;if(t.document)n=Oc(e.ct,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=ci.fromSegments(t.noDocument.path),r=eu(t.noDocument.readTime);n=no.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return Fr();{const e=ci.fromSegments(t.unknownDocument.path),r=eu(t.unknownDocument.version);n=no.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime(function(e){const t=new ni(e[0],e[1]);return ri.fromTimestamp(t)}(t.readTime)),n}(this.serializer,t);if(!e.isNoDocument()||!e.version.isEqual(ri.min()))return e}return no.newInvalidDocument(e)}}function hl(e){return new ll(e)}class dl extends ul{constructor(e,t){super(),this.ar=e,this.trackRemovals=t,this.ur=new Zo((e=>e.toString()),((e,t)=>e.isEqual(t)))}applyChanges(e){const t=[];let n=0,r=new vs(((e,t)=>Zr(e.canonicalString(),t.canonicalString())));return this.changes.forEach(((i,s)=>{const o=this.ur.get(i);if(t.push(this.ar.removeEntry(e,i,o.readTime)),s.isValidDocument()){const a=Xc(this.ar.serializer,s);r=r.add(i.path.popLast());const c=Gu(a);n+=c-o.size,t.push(this.ar.addEntry(e,i,a))}else if(n-=o.size,this.trackRemovals){const n=Xc(this.ar.serializer,s.convertToNoDocument(ri.min()));t.push(this.ar.addEntry(e,i,n))}})),r.forEach((n=>{t.push(this.ar.indexManager.addToCollectionParentIndex(e,n))})),t.push(this.ar.updateMetadata(e,n)),Ii.waitFor(t)}getFromCache(e,t){return this.ar.rr(e,t).next((e=>(this.ur.set(t,{size:e.size,readTime:e.document.readTime}),e.document)))}getAllFromCache(e,t){return this.ar.sr(e,t).next((e=>{let{documents:t,_r:n}=e;return n.forEach(((e,n)=>{this.ur.set(e,{size:n,readTime:t.get(e).readTime})})),t}))}}function fl(e){return hs(e,"remoteDocumentGlobal")}function pl(e){return hs(e,"remoteDocumentsV14")}function gl(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function ml(e,t){const n=t.documentKey.path.toArray();return[e,$c(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function yl(e,t){const n=e.path.toArray(),r=t.path.toArray();let i=0;for(let s=0;s<n.length-2&&s<r.length-2;++s)if(i=Zr(n[s],r[s]),i)return i;return i=Zr(n.length,r.length),i||(i=Zr(n[n.length-2],r[r.length-2]),i||Zr(n[n.length-1],r[r.length-1]))}class vl{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class wl{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&La(n.mutation,e,Is.empty(),ni.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,la()).next((()=>t))))}getLocalViewOfDocuments(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:la();const r=sa();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((e=>{let t=ra();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=sa();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,la())))}populateOverlays(e,t,n){const r=[];return n.forEach((e=>{t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,r){let i=ta();const s=aa(),o=aa();return t.forEach(((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof Ua)?i=i.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),La(o.mutation,t,o.mutation.getFieldMask(),ni.now())):s.set(t.key,Is.empty())})),this.recalculateAndSaveOverlays(e,i).next((e=>(e.forEach(((e,t)=>s.set(e,t))),t.forEach(((e,t)=>{var n;return o.set(e,new vl(t,null!==(n=s.get(e))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(e,t){const n=aa();let r=new gs(((e,t)=>e-t)),i=la();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const i of e)i.keys().forEach((e=>{const s=t.get(e);if(null===s)return;let o=n.get(e)||Is.empty();o=i.applyToLocalView(s,o),n.set(e,o);const a=(r.get(i.batchId)||la()).add(e);r=r.insert(i.batchId,a)}))})).next((()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=oa();c.forEach((e=>{if(!i.has(e)){const r=xa(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}})),s.push(this.documentOverlayCache.saveOverlays(e,a,u))}return Ii.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n,r){return function(e){return ci.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Bo(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):Ii.resolve(sa());let o=-1,a=i;return s.next((t=>Ii.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?Ii.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{a=a.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,i))).next((()=>this.computeViews(e,a,t,la()))).next((e=>({batchId:o,changes:ia(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ci(t)).next((e=>{let t=ra();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const i=t.collectionGroup;let s=ra();return this.indexManager.getCollectionParents(e,i).next((o=>Ii.forEach(o,(o=>{const a=function(e,t){return new Mo(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(i));return this.getDocumentsMatchingCollectionQuery(e,a,n,r).next((e=>{e.forEach(((e,t)=>{s=s.insert(e,t)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r)))).next((e=>{i.forEach(((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,no.newInvalidDocument(r)))}));let n=ra();return e.forEach(((e,r)=>{const s=i.get(e);void 0!==s&&La(s.mutation,r,Is.empty(),ni.now()),Yo(t,r)&&(n=n.insert(e,r))})),n}))}}class _l{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,t){return Ii.resolve(this.cr.get(t))}saveBundleMetadata(e,t){return this.cr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:Tc(e.createTime)}}(t)),Ii.resolve()}getNamedQuery(e,t){return Ii.resolve(this.lr.get(t))}saveNamedQuery(e,t){return this.lr.set(t.name,function(e){return{name:e.name,query:iu(e.bundledQuery),readTime:Tc(e.readTime)}}(t)),Ii.resolve()}}class Il{constructor(){this.overlays=new gs(ci.comparator),this.hr=new Map}getOverlay(e,t){return Ii.resolve(this.overlays.get(t))}getOverlays(e,t){const n=sa();return Ii.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.ht(e,t,r)})),Ii.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.hr.get(n);return void 0!==r&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.hr.delete(n)),Ii.resolve()}getOverlaysForCollection(e,t,n){const r=sa(),i=t.length+1,s=new ci(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return Ii.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new gs(((e,t)=>e-t));const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=sa(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=sa(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=r)););return Ii.resolve(o)}ht(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.hr.get(r.largestBatchId).delete(n.key);this.hr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Ha(t,n));let i=this.hr.get(t);void 0===i&&(i=la(),this.hr.set(t,i)),this.hr.set(t,i.add(n.key))}}class bl{constructor(){this.Pr=new vs(Tl.Ir),this.Tr=new vs(Tl.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,t){const n=new Tl(e,t);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.Ar(new Tl(e,t))}Rr(e,t){e.forEach((e=>this.removeReference(e,t)))}Vr(e){const t=new ci(new si([])),n=new Tl(t,e),r=new Tl(t,e+1),i=[];return this.Tr.forEachInRange([n,r],(e=>{this.Ar(e),i.push(e.key)})),i}mr(){this.Pr.forEach((e=>this.Ar(e)))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){const t=new ci(new si([])),n=new Tl(t,e),r=new Tl(t,e+1);let i=la();return this.Tr.forEachInRange([n,r],(e=>{i=i.add(e.key)})),i}containsKey(e){const t=new Tl(e,0),n=this.Pr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Tl{constructor(e,t){this.key=e,this.pr=t}static Ir(e,t){return ci.comparator(e.key,t.key)||Zr(e.pr,t.pr)}static Er(e,t){return Zr(e.pr,t.pr)||ci.comparator(e.key,t.key)}}class El{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new vs(Tl.Ir)}checkEmpty(e){return Ii.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Ga(i,t,n,r);this.mutationQueue.push(s);for(const o of r)this.wr=this.wr.add(new Tl(o.key,i)),this.indexManager.addToCollectionParentIndex(e,o.key.path.popLast());return Ii.resolve(s)}lookupMutationBatch(e,t){return Ii.resolve(this.Sr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.br(n),i=r<0?0:r;return Ii.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return Ii.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(e){return Ii.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Tl(t,0),r=new Tl(t,Number.POSITIVE_INFINITY),i=[];return this.wr.forEachInRange([n,r],(e=>{const t=this.Sr(e.pr);i.push(t)})),Ii.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new vs(Zr);return t.forEach((e=>{const t=new Tl(e,0),r=new Tl(e,Number.POSITIVE_INFINITY);this.wr.forEachInRange([t,r],(e=>{n=n.add(e.pr)}))})),Ii.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;ci.isDocumentKey(i)||(i=i.child(""));const s=new Tl(new ci(i),0);let o=new vs(Zr);return this.wr.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.pr)),!0)}),s),Ii.resolve(this.Dr(o))}Dr(e){const t=[];return e.forEach((e=>{const n=this.Sr(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){Vr(0===this.Cr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.wr;return Ii.forEach(t.mutations,(r=>{const i=new Tl(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.wr=n}))}Mn(e){}containsKey(e,t){const n=new Tl(t,0),r=this.wr.firstAfterOrEqual(n);return Ii.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,Ii.resolve()}Cr(e,t){return this.br(e)}br(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Sr(e){const t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Sl{constructor(e){this.vr=e,this.docs=new gs(ci.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.vr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Ii.resolve(n?n.document.mutableCopy():no.newInvalidDocument(t))}getEntries(e,t){let n=ta();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():no.newInvalidDocument(e))})),Ii.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=ta();const s=t.path,o=new ci(s.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||yi(gi(o),n)<=0||(r.has(o.key)||Yo(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return Ii.resolve(i)}getAllFromCollectionGroup(e,t,n,r){Fr()}Fr(e,t){return Ii.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new Al(this)}getSize(e){return Ii.resolve(this.size)}}class Al extends ul{constructor(e){super(),this.ar=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.ar.addEntry(e,r)):this.ar.removeEntry(n)})),Ii.waitFor(t)}getFromCache(e,t){return this.ar.getEntry(e,t)}getAllFromCache(e,t){return this.ar.getEntries(e,t)}}class Cl{constructor(e){this.persistence=e,this.Mr=new Zo((e=>Do(e)),Ro),this.lastRemoteSnapshotVersion=ri.min(),this.highestTargetId=0,this.Or=0,this.Nr=new bl,this.targetCount=0,this.Lr=Xu.Nn()}forEachTarget(e,t){return this.Mr.forEach(((e,n)=>t(n))),Ii.resolve()}getLastRemoteSnapshotVersion(e){return Ii.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Ii.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Lr.next(),Ii.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Or&&(this.Or=t),Ii.resolve()}qn(e){this.Mr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Lr=new Xu(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,t){return this.qn(t),this.targetCount+=1,Ii.resolve()}updateTargetData(e,t){return this.qn(t),Ii.resolve()}removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,Ii.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Mr.forEach(((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Mr.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)})),Ii.waitFor(i).next((()=>r))}getTargetCount(e){return Ii.resolve(this.targetCount)}getTargetData(e,t){const n=this.Mr.get(t)||null;return Ii.resolve(n)}addMatchingKeys(e,t,n){return this.Nr.dr(t,n),Ii.resolve()}removeMatchingKeys(e,t,n){this.Nr.Rr(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((t=>{i.push(r.markPotentiallyOrphaned(e,t))})),Ii.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),Ii.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Nr.gr(t);return Ii.resolve(n)}containsKey(e,t){return Ii.resolve(this.Nr.containsKey(t))}}class kl{constructor(e,t){this.Br={},this.overlays={},this.kr=new xi(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new Cl(this),this.indexManager=new xu,this.remoteDocumentCache=function(e){return new Sl(e)}((e=>this.referenceDelegate.Kr(e))),this.serializer=new Jc(t),this.$r=new _l(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Il,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Br[e.toKey()];return n||(n=new El(t,this.referenceDelegate),this.Br[e.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,t,n){xr("MemoryPersistence","Starting transaction:",e);const r=new Nl(this.kr.next());return this.referenceDelegate.Ur(),n(r).next((e=>this.referenceDelegate.Wr(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}Gr(e,t){return Ii.or(Object.values(this.Br).map((n=>()=>n.containsKey(e,t))))}}class Nl extends wi{constructor(e){super(),this.currentSequenceNumber=e}}class Dl{constructor(e){this.persistence=e,this.zr=new bl,this.jr=null}static Hr(e){return new Dl(e)}get Jr(){if(this.jr)return this.jr;throw Fr()}addReference(e,t,n){return this.zr.addReference(n,t),this.Jr.delete(n.toString()),Ii.resolve()}removeReference(e,t,n){return this.zr.removeReference(n,t),this.Jr.add(n.toString()),Ii.resolve()}markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),Ii.resolve()}removeTarget(e,t){this.zr.Vr(t.targetId).forEach((e=>this.Jr.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Jr.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Ur(){this.jr=new Set}Wr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ii.forEach(this.Jr,(n=>{const r=ci.fromPath(n);return this.Yr(e,r).next((e=>{e||t.removeEntry(r,ri.min())}))})).next((()=>(this.jr=null,t.apply(e))))}updateLimboDocument(e,t){return this.Yr(e,t).next((e=>{e?this.Jr.delete(t.toString()):this.Jr.add(t.toString())}))}Kr(e){return 0}Yr(e,t){return Ii.or([()=>Ii.resolve(this.zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gr(e,t)])}}class Rl{constructor(e){this.serializer=e}N(e,t,n,r){const i=new bi("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore("owner")}(e),function(e){e.createObjectStore("mutationQueues",{keyPath:"userId"}),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",qi,{unique:!0}),e.createObjectStore("documentMutations")}(e),Pl(e),function(e){e.createObjectStore("remoteDocuments")}(e));let s=Ii.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal")}(e),Pl(e)),s=s.next((()=>function(e){const t=e.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ri.min().toTimestamp(),targetCount:0};return t.put("targetGlobalKey",n)}(i)))),n<4&&r>=4&&(0!==n&&(s=s.next((()=>function(e,t){return t.store("mutations").W().next((n=>{e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",qi,{unique:!0});const r=t.store("mutations"),i=n.map((e=>r.put(e)));return Ii.waitFor(i)}))}(e,i)))),s=s.next((()=>{!function(e){e.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)}))),n<5&&r>=5&&(s=s.next((()=>this.Xr(i)))),n<6&&r>=6&&(s=s.next((()=>(function(e){e.createObjectStore("remoteDocumentGlobal")}(e),this.ei(i))))),n<7&&r>=7&&(s=s.next((()=>this.ti(i)))),n<8&&r>=8&&(s=s.next((()=>this.ni(e,i)))),n<9&&r>=9&&(s=s.next((()=>{!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)}))),n<10&&r>=10&&(s=s.next((()=>this.ri(i)))),n<11&&r>=11&&(s=s.next((()=>{!function(e){e.createObjectStore("bundles",{keyPath:"bundleId"})}(e),function(e){e.createObjectStore("namedQueries",{keyPath:"name"})}(e)}))),n<12&&r>=12&&(s=s.next((()=>{!function(e){const t=e.createObjectStore("documentOverlays",{keyPath:ns});t.createIndex("collectionPathOverlayIndex",rs,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",is,{unique:!1})}(e)}))),n<13&&r>=13&&(s=s.next((()=>function(e){const t=e.createObjectStore("remoteDocumentsV14",{keyPath:Gi});t.createIndex("documentKeyIndex",Wi),t.createIndex("collectionGroupIndex",Hi)}(e))).next((()=>this.ii(e,i))).next((()=>e.deleteObjectStore("remoteDocuments")))),n<14&&r>=14&&(s=s.next((()=>this.si(e,i)))),n<15&&r>=15&&(s=s.next((()=>function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:$i}).createIndex("sequenceNumberIndex",Zi,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:es}).createIndex("documentKeyIndex",ts,{unique:!1})}(e)))),s}ei(e){let t=0;return e.store("remoteDocuments").Y(((e,n)=>{t+=Gu(n)})).next((()=>{const n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)}))}Xr(e){const t=e.store("mutationQueues"),n=e.store("mutations");return t.W().next((t=>Ii.forEach(t,(t=>{const r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.W("userMutationsIndex",r).next((n=>Ii.forEach(n,(n=>{Vr(n.userId===t.userId);const r=tu(this.serializer,n);return Ku(e,t.userId,r).next((()=>{}))}))))}))))}ti(e){const t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next((e=>{const r=[];return n.Y(((n,i)=>{const s=new si(n),o=function(e){return[0,Fi(e)]}(s);r.push(t.get(o).next((n=>n?Ii.resolve():(n=>t.put({targetId:0,path:Fi(n),sequenceNumber:e.highestListenSequenceNumber}))(s))))})).next((()=>Ii.waitFor(r)))}))}ni(e,t){e.createObjectStore("collectionParents",{keyPath:Xi});const n=t.store("collectionParents"),r=new Ou,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:Fi(r)})}};return t.store("remoteDocuments").Y({J:!0},((e,t)=>{const n=new si(e);return i(n.popLast())})).next((()=>t.store("documentMutations").Y({J:!0},((e,t)=>{let[n,r,s]=e;const o=Bi(r);return i(o.popLast())}))))}ri(e){const t=e.store("targets");return t.Y(((e,n)=>{const r=nu(n),i=ru(this.serializer,r);return t.put(i)}))}ii(e,t){const n=t.store("remoteDocuments"),r=[];return n.Y(((e,n)=>{const i=t.store("remoteDocumentsV14"),s=function(e){return e.document?new ci(si.fromString(e.document.name).popFirst(5)):e.noDocument?ci.fromSegments(e.noDocument.path):e.unknownDocument?ci.fromSegments(e.unknownDocument.path):Fr()}(n).path.toArray(),o={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(o))})).next((()=>Ii.waitFor(r)))}si(e,t){const n=t.store("mutations"),r=hl(this.serializer),i=new kl(Dl.Hr,this.serializer.ct);return n.W().next((e=>{const n=new Map;return e.forEach((e=>{var t;let r=null!==(t=n.get(e.userId))&&void 0!==t?t:la();tu(this.serializer,e).keys().forEach((e=>r=r.add(e))),n.set(e.userId,r)})),Ii.forEach(n,((e,n)=>{const s=new Nr(n),o=hu.lt(this.serializer,s),a=i.getIndexManager(s),c=Wu.lt(s,this.serializer,a,i.referenceDelegate);return new wl(r,c,o,a).recalculateAndSaveOverlaysForDocumentKeys(new ls(t,xi._e),e).next()}))}))}}function Pl(e){e.createObjectStore("targetDocuments",{keyPath:Yi}).createIndex("documentTargetsIndex",Ji,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Qi,{unique:!0}),e.createObjectStore("targetGlobal")}const xl="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Ol{constructor(e,t,n,r,i,s,o,a,c,u){let l=arguments.length>10&&void 0!==arguments[10]?arguments[10]:15;if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.oi=i,this.window=s,this.document=o,this._i=c,this.ai=u,this.ui=l,this.kr=null,this.qr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.li=null,this.hi=null,this.Pi=Number.NEGATIVE_INFINITY,this.Ii=e=>Promise.resolve(),!Ol.D())throw new qr(Br.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new al(this,r),this.Ti=t+"main",this.serializer=new Jc(a),this.Ei=new Ti(this.Ti,this.ui,new Rl(this.serializer)),this.Qr=new $u(this.referenceDelegate,this.serializer),this.remoteDocumentCache=hl(this.serializer),this.$r=new cu,this.window&&this.window.localStorage?this.di=this.window.localStorage:(this.di=null,!1===u&&Or("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ai().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new qr(Br.FAILED_PRECONDITION,xl);return this.Ri(),this.Vi(),this.mi(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Qr.getHighestSequenceNumber(e)))})).then((e=>{this.kr=new xi(e,this._i)})).then((()=>{this.qr=!0})).catch((e=>(this.Ei&&this.Ei.close(),Promise.reject(e))))}fi(e){return this.Ii=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ei.B((async t=>{null===t.newVersion&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.oi.enqueueAndForget((async()=>{this.started&&await this.Ai()})))}Ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>Ml(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.gi(e).next((e=>{e||(this.isPrimary=!1,this.oi.enqueueRetryable((()=>this.Ii(!1))))}))})).next((()=>this.pi(e))).next((t=>this.isPrimary&&!t?this.yi(e).next((()=>!1)):!!t&&this.wi(e).next((()=>!0)))))).catch((e=>{if(Ai(e))return xr("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return xr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.oi.enqueueRetryable((()=>this.Ii(e))),this.isPrimary=e}))}gi(e){return Ll(e).get("owner").next((e=>Ii.resolve(this.Si(e))))}bi(e){return Ml(e).delete(this.clientId)}async Di(){if(this.isPrimary&&!this.Ci(this.Pi,18e5)){this.Pi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(e=>{const t=hs(e,"clientMetadata");return t.W().next((e=>{const n=this.vi(e,18e5),r=e.filter((e=>-1===n.indexOf(e)));return Ii.forEach(r,(e=>t.delete(e.clientId))).next((()=>r))}))})).catch((()=>[]));if(this.di)for(const t of e)this.di.removeItem(this.Fi(t.clientId))}}mi(){this.hi=this.oi.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.Ai().then((()=>this.Di())).then((()=>this.mi()))))}Si(e){return!!e&&e.ownerId===this.clientId}pi(e){return this.ai?Ii.resolve(!0):Ll(e).get("owner").next((t=>{if(null!==t&&this.Ci(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)){if(this.Si(t)&&this.networkEnabled)return!0;if(!this.Si(t)){if(!t.allowTabSynchronization)throw new qr(Br.FAILED_PRECONDITION,xl);return!1}}return!(!this.networkEnabled||!this.inForeground)||Ml(e).W().next((e=>void 0===this.vi(e,5e3).find((e=>{if(this.clientId!==e.clientId){const t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))))})).next((e=>(this.isPrimary!==e&&xr("IndexedDbPersistence","Client ".concat(e?"is":"is not"," eligible for a primary lease.")),e)))}async shutdown(){this.qr=!1,this.xi(),this.hi&&(this.hi.cancel(),this.hi=null),this.Oi(),this.Ni(),await this.Ei.runTransaction("shutdown","readwrite",["owner","clientMetadata"],(e=>{const t=new ls(e,xi._e);return this.yi(t).next((()=>this.bi(t)))})),this.Ei.close(),this.Li()}vi(e,t){return e.filter((e=>this.Ci(e.updateTimeMs,t)&&!this.Mi(e.clientId)))}Bi(){return this.runTransaction("getActiveClients","readonly",(e=>Ml(e).W().next((e=>this.vi(e,18e5).map((e=>e.clientId))))))}get started(){return this.qr}getMutationQueue(e,t){return Wu.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Mu(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return hu.lt(this.serializer,e)}getBundleCache(){return this.$r}runTransaction(e,t,n){xr("IndexedDbPersistence","Starting transaction:",e);const r="readonly"===t?"readonly":"readwrite",i=function(e){return 15===e?us:14===e?cs:13===e?as:12===e?os:11===e?ss:void Fr()}(this.ui);let s;return this.Ei.runTransaction(e,r,i,(r=>(s=new ls(r,this.kr?this.kr.next():xi._e),"readwrite-primary"===t?this.gi(s).next((e=>!!e||this.pi(s))).next((t=>{if(!t)throw Or("Failed to obtain primary lease for action '".concat(e,"'.")),this.isPrimary=!1,this.oi.enqueueRetryable((()=>this.Ii(!1))),new qr(Br.FAILED_PRECONDITION,vi);return n(s)})).next((e=>this.wi(s).next((()=>e)))):this.ki(s).next((()=>n(s)))))).then((e=>(s.raiseOnCommittedEvent(),e)))}ki(e){return Ll(e).get("owner").next((e=>{if(null!==e&&this.Ci(e.leaseTimestampMs,5e3)&&!this.Mi(e.ownerId)&&!this.Si(e)&&!(this.ai||this.allowTabSynchronization&&e.allowTabSynchronization))throw new qr(Br.FAILED_PRECONDITION,xl)}))}wi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Ll(e).put("owner",t)}static D(){return Ti.D()}yi(e){const t=Ll(e);return t.get("owner").next((e=>this.Si(e)?(xr("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):Ii.resolve()))}Ci(e,t){const n=Date.now();return!(e<n-t)&&(!(e>n)||(Or("Detected an update time that is in the future: ".concat(e," > ").concat(n)),!1))}Ri(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.li=()=>{this.oi.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.Ai())))},this.document.addEventListener("visibilitychange",this.li),this.inForeground="visible"===this.document.visibilityState)}Oi(){this.li&&(this.document.removeEventListener("visibilitychange",this.li),this.li=null)}Vi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ci=()=>{this.xi();const e=/(?:Version|Mobile)\/1[456]/;(0,c.nr)()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.oi.enterRestrictedMode(!0),this.oi.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.ci))}Ni(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Mi(e){var t;try{const n=null!==(null===(t=this.di)||void 0===t?void 0:t.getItem(this.Fi(e)));return xr("IndexedDbPersistence","Client '".concat(e,"' ").concat(n?"is":"is not"," zombied in LocalStorage")),n}catch(e){return Or("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}xi(){if(this.di)try{this.di.setItem(this.Fi(this.clientId),String(Date.now()))}catch(e){Or("Failed to set zombie client id.",e)}}Li(){if(this.di)try{this.di.removeItem(this.Fi(this.clientId))}catch(e){}}Fi(e){return"firestore_zombie_".concat(this.persistenceKey,"_").concat(e)}}function Ll(e){return hs(e,"owner")}function Ml(e){return hs(e,"clientMetadata")}function Fl(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class Vl{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.qi=n,this.Qi=r}static Ki(e,t){let n=la(),r=la();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new Vl(e,t.fromCache,n,r)}}class Ul{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Bl{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=(0,c.nr)()?8:Ti.v((0,c.ZQ)())>0?6:4}initialize(e,t){this.zi=e,this.indexManager=t,this.$i=!0}getDocumentsMatchingQuery(e,t,n,r){const i={result:null};return this.ji(e,t).next((e=>{i.result=e})).next((()=>{if(!i.result)return this.Hi(e,t,r,n).next((e=>{i.result=e}))})).next((()=>{if(i.result)return;const n=new Ul;return this.Ji(e,t,n).next((r=>{if(i.result=r,this.Ui)return this.Yi(e,t,n,r.size)}))})).next((()=>i.result))}Yi(e,t,n,r){return n.documentReadCount<this.Wi?(Pr()<=a.$b.DEBUG&&xr("QueryEngine","SDK will not create cache indexes for query:",Qo(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),Ii.resolve()):(Pr()<=a.$b.DEBUG&&xr("QueryEngine","Query:",Qo(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Gi*r?(Pr()<=a.$b.DEBUG&&xr("QueryEngine","The SDK decides to create cache indexes for query:",Qo(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,jo(t))):Ii.resolve())}ji(e,t){if(Uo(t))return Ii.resolve(null);let n=jo(t);return this.indexManager.getIndexType(e,n).next((r=>0===r?null:(null!==t.limit&&1===r&&(t=Go(t,null,"F"),n=jo(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((r=>{const i=la(...r);return this.zi.getDocuments(e,i).next((r=>this.indexManager.getMinOffset(e,n).next((n=>{const s=this.Zi(t,r);return this.Xi(t,s,i,n.readTime)?this.ji(e,Go(t,null,"F")):this.es(e,s,t,n)}))))})))))}Hi(e,t,n,r){return Uo(t)||r.isEqual(ri.min())?Ii.resolve(null):this.zi.getDocuments(e,n).next((i=>{const s=this.Zi(t,i);return this.Xi(t,s,n,r)?Ii.resolve(null):(Pr()<=a.$b.DEBUG&&xr("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Qo(t)),this.es(e,s,t,pi(r,-1)).next((e=>e)))}))}Zi(e,t){let n=new vs(Xo(e));return t.forEach(((t,r)=>{Yo(e,r)&&(n=n.add(r))})),n}Xi(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ji(e,t,n){return Pr()<=a.$b.DEBUG&&xr("QueryEngine","Using full collection scan to execute query:",Qo(t)),this.zi.getDocumentsMatchingQuery(e,t,mi.min(),n)}es(e,t,n,r){return this.zi.getDocumentsMatchingQuery(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}class ql{constructor(e,t,n,r){this.persistence=e,this.ts=t,this.serializer=r,this.ns=new gs(Zr),this.rs=new Zo((e=>Do(e)),Ro),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(n)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new wl(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.ns)))}}function jl(e,t,n,r){return new ql(e,t,n,r)}async function zl(e,t){const n=Ur(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next((i=>(r=i,n._s(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const i=[],s=[];let o=la();for(const e of r){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({us:e,removedBatchIds:i,addedBatchIds:s})))}))}))}function Kl(e){const t=Ur(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Qr.getLastRemoteSnapshotVersion(e)))}function Gl(e,t,n){let r=la(),i=la();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=ta();return n.forEach(((n,s)=>{const o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(ri.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):xr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{cs:r,ls:i}}))}function Wl(e,t){const n=Ur(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}function Hl(e,t){const n=Ur(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.Qr.getTargetData(e,t).next((i=>i?(r=i,Ii.resolve(r)):n.Qr.allocateTargetId(e).next((i=>(r=new Yc(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Qr.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.ns.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.ns=n.ns.insert(e.targetId,e),n.rs.set(t,e.targetId)),e}))}async function Ql(e,t,n){const r=Ur(e),i=r.ns.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!Ai(e))throw e;xr("LocalStore","Failed to update sequence numbers for target ".concat(t,": ").concat(e))}r.ns=r.ns.remove(t),r.rs.delete(i.target)}function Yl(e,t,n){const r=Ur(e);let i=ri.min(),s=la();return r.persistence.runTransaction("Execute query","readwrite",(e=>function(e,t,n){const r=Ur(e),i=r.rs.get(n);return void 0!==i?Ii.resolve(r.ns.get(i)):r.Qr.getTargetData(t,n)}(r,e,jo(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(e,t.targetId).next((e=>{s=e}))})).next((()=>r.ts.getDocumentsMatchingQuery(e,t,n?i:ri.min(),n?s:la()))).next((e=>($l(r,Jo(t),e),{documents:e,hs:s})))))}function Jl(e,t){const n=Ur(e),r=Ur(n.Qr),i=n.ns.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(e=>r._t(e,t).next((e=>e?e.target:null))))}function Xl(e,t){const n=Ur(e),r=n.ss.get(t)||ri.min();return n.persistence.runTransaction("Get new document changes","readonly",(e=>n.os.getAllFromCollectionGroup(e,t,pi(r,-1),Number.MAX_SAFE_INTEGER))).then((e=>($l(n,t,e),e)))}function $l(e,t,n){let r=e.ss.get(t)||ri.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.ss.set(t,r)}async function Zl(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:la();const r=await Hl(e,jo(iu(t.bundledQuery))),i=Ur(e);return i.persistence.runTransaction("Save named query","readwrite",(e=>{const s=Tc(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return i.$r.saveNamedQuery(e,t);const o=r.withResumeToken(Ts.EMPTY_BYTE_STRING,s);return i.ns=i.ns.insert(o.targetId,o),i.Qr.updateTargetData(e,o).next((()=>i.Qr.removeMatchingKeysForTargetId(e,r.targetId))).next((()=>i.Qr.addMatchingKeys(e,n,r.targetId))).next((()=>i.$r.saveNamedQuery(e,t)))}))}function eh(e,t){return"firestore_clients_".concat(e,"_").concat(t)}function th(e,t,n){let r="firestore_mutations_".concat(e,"_").concat(n);return t.isAuthenticated()&&(r+="_".concat(t.uid)),r}function nh(e,t){return"firestore_targets_".concat(e,"_").concat(t)}class rh{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Es(e,t,n){const r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new qr(r.error.code,r.error.message))),s?new rh(e,t,r.state,i):(Or("SharedClientState","Failed to parse mutation state for ID '".concat(t,"': ").concat(n)),null)}ds(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ih{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Es(e,t){const n=JSON.parse(t);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(r=new qr(n.error.code,n.error.message))),i?new ih(e,n.state,r):(Or("SharedClientState","Failed to parse target state for ID '".concat(e,"': ").concat(t)),null)}ds(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class sh{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Es(e,t){const n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=da();for(let s=0;r&&s<n.activeTargetIds.length;++s)r=Mi(n.activeTargetIds[s]),i=i.add(n.activeTargetIds[s]);return r?new sh(e,i):(Or("SharedClientState","Failed to parse client data for instance '".concat(e,"': ").concat(t)),null)}}class oh{constructor(e,t){this.clientId=e,this.onlineState=t}static Es(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new oh(t.clientId,t.onlineState):(Or("SharedClientState","Failed to parse online state: ".concat(e)),null)}}class ah{constructor(){this.activeTargetIds=da()}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class ch{constructor(e,t,n,r,i){this.window=e,this.oi=t,this.persistenceKey=n,this.Vs=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.fs=this.gs.bind(this),this.ps=new gs(Zr),this.started=!1,this.ys=[];const s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.ws=eh(this.persistenceKey,this.Vs),this.Ss=function(e){return"firestore_sequence_number_".concat(e)}(this.persistenceKey),this.ps=this.ps.insert(this.Vs,new ah),this.bs=new RegExp("^firestore_clients_".concat(s,"_([^_]*)$")),this.Ds=new RegExp("^firestore_mutations_".concat(s,"_(\\d+)(?:_(.*))?$")),this.Cs=new RegExp("^firestore_targets_".concat(s,"_(\\d+)$")),this.vs=function(e){return"firestore_online_state_".concat(e)}(this.persistenceKey),this.Fs=function(e){return"firestore_bundle_loaded_v2_".concat(e)}(this.persistenceKey),this.window.addEventListener("storage",this.fs)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Bi();for(const n of e){if(n===this.Vs)continue;const e=this.getItem(eh(this.persistenceKey,n));if(e){const t=sh.Es(n,e);t&&(this.ps=this.ps.insert(t.clientId,t))}}this.Ms();const t=this.storage.getItem(this.vs);if(t){const e=this.xs(t);e&&this.Os(e)}for(const n of this.ys)this.gs(n);this.ys=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(e){this.setItem(this.Ss,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ns(this.ps)}isActiveQueryTarget(e){let t=!1;return this.ps.forEach(((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)})),t}addPendingMutation(e){this.Ls(e,"pending")}updateMutationState(e,t,n){this.Ls(e,t,n),this.Bs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const n=this.storage.getItem(nh(this.persistenceKey,e));if(n){const r=ih.Es(e,n);r&&(t=r.state)}}return this.ks.As(e),this.Ms(),t}removeLocalQueryTarget(e){this.ks.Rs(e),this.Ms()}isLocalQueryTarget(e){return this.ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(nh(this.persistenceKey,e))}updateQueryState(e,t,n){this.qs(e,t,n)}handleUserChange(e,t,n){t.forEach((e=>{this.Bs(e)})),this.currentUser=e,n.forEach((e=>{this.addPendingMutation(e)}))}setOnlineState(e){this.Qs(e)}notifyBundleLoaded(e){this.Ks(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.fs),this.removeItem(this.ws),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return xr("SharedClientState","READ",e,t),t}setItem(e,t){xr("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){xr("SharedClientState","REMOVE",e),this.storage.removeItem(e)}gs(e){const t=e;if(t.storageArea===this.storage){if(xr("SharedClientState","EVENT",t.key,t.newValue),t.key===this.ws)return void Or("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.oi.enqueueRetryable((async()=>{if(this.started){if(null!==t.key)if(this.bs.test(t.key)){if(null==t.newValue){const e=this.$s(t.key);return this.Us(e,null)}{const e=this.Ws(t.key,t.newValue);if(e)return this.Us(e.clientId,e)}}else if(this.Ds.test(t.key)){if(null!==t.newValue){const e=this.Gs(t.key,t.newValue);if(e)return this.zs(e)}}else if(this.Cs.test(t.key)){if(null!==t.newValue){const e=this.js(t.key,t.newValue);if(e)return this.Hs(e)}}else if(t.key===this.vs){if(null!==t.newValue){const e=this.xs(t.newValue);if(e)return this.Os(e)}}else if(t.key===this.Ss){const e=function(e){let t=xi._e;if(null!=e)try{const n=JSON.parse(e);Vr("number"==typeof n),t=n}catch(e){Or("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(t.newValue);e!==xi._e&&this.sequenceNumberHandler(e)}else if(t.key===this.Fs){const e=this.Js(t.newValue);await Promise.all(e.map((e=>this.syncEngine.Ys(e))))}}else this.ys.push(t)}))}}get ks(){return this.ps.get(this.Vs)}Ms(){this.setItem(this.ws,this.ks.ds())}Ls(e,t,n){const r=new rh(this.currentUser,e,t,n),i=th(this.persistenceKey,this.currentUser,e);this.setItem(i,r.ds())}Bs(e){const t=th(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Qs(e){const t={clientId:this.Vs,onlineState:e};this.storage.setItem(this.vs,JSON.stringify(t))}qs(e,t,n){const r=nh(this.persistenceKey,e),i=new ih(e,t,n);this.setItem(r,i.ds())}Ks(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Fs,t)}$s(e){const t=this.bs.exec(e);return t?t[1]:null}Ws(e,t){const n=this.$s(e);return sh.Es(n,t)}Gs(e,t){const n=this.Ds.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return rh.Es(new Nr(i),r,t)}js(e,t){const n=this.Cs.exec(e),r=Number(n[1]);return ih.Es(r,t)}xs(e){return oh.Es(e)}Js(e){return JSON.parse(e)}async zs(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Zs(e.batchId,e.state,e.error);xr("SharedClientState","Ignoring mutation for non-active user ".concat(e.user.uid))}Hs(e){return this.syncEngine.Xs(e.targetId,e.state,e.error)}Us(e,t){const n=t?this.ps.insert(e,t):this.ps.remove(e),r=this.Ns(this.ps),i=this.Ns(n),s=[],o=[];return i.forEach((e=>{r.has(e)||s.push(e)})),r.forEach((e=>{i.has(e)||o.push(e)})),this.syncEngine.eo(s,o).then((()=>{this.ps=n}))}Os(e){this.ps.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ns(e){let t=da();return e.forEach(((e,n)=>{t=t.unionWith(n.activeTargetIds)})),t}}class uh{constructor(){this.no=new ah,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,t,n){this.ro[e]=t}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new ah,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class lh{io(e){}shutdown(){}}class hh{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){xr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.uo)e(0)}ao(){xr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.uo)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let dh=null;function fh(){return null===dh?dh=268435456+Math.round(2147483648*Math.random()):dh++,"0x"+dh.toString(16)}const ph={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class gh{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}onMessage(e){this.Ao=e}close(){this.ho()}send(e){this.lo(e)}Ro(){this.Io()}Vo(e){this.Eo(e)}mo(e){this.Ao(e)}}const mh="WebChannelConnection";class yh extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.fo=t+"://"+e.host,this.po="projects/".concat(n,"/databases/").concat(r),this.yo="(default)"===this.databaseId.database?"project_id=".concat(n):"project_id=".concat(n,"&database_id=").concat(r)}get wo(){return!1}So(e,t,n,r,i){const s=fh(),o=this.bo(e,t.toUriEncodedString());xr("RestConnection","Sending RPC '".concat(e,"' ").concat(s,":"),o,n);const a={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(a,r,i),this.Co(e,o,a,n).then((t=>(xr("RestConnection","Received RPC '".concat(e,"' ").concat(s,": "),t),t)),(t=>{throw Lr("RestConnection","RPC '".concat(e,"' ").concat(s," failed with error: "),t,"url: ",o,"request:",n),t}))}vo(e,t,n,r,i,s){return this.So(e,t,n,r,i)}Do(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+Dr,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}bo(e,t){const n=ph[e];return"".concat(this.fo,"/v1/").concat(t,":").concat(n)}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Co(e,t,n,r){const i=fh();return new Promise(((s,o)=>{const a=new Sr;a.setWithCredentials(!0),a.listenOnce(Ir.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case _r.NO_ERROR:const t=a.getResponseJson();xr(mh,"XHR for RPC '".concat(e,"' ").concat(i," received:"),JSON.stringify(t)),s(t);break;case _r.TIMEOUT:xr(mh,"RPC '".concat(e,"' ").concat(i," timed out")),o(new qr(Br.DEADLINE_EXCEEDED,"Request time out"));break;case _r.HTTP_ERROR:const n=a.getStatus();if(xr(mh,"RPC '".concat(e,"' ").concat(i," failed with status:"),n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(Br).indexOf(t)>=0?t:Br.UNKNOWN}(t.status);o(new qr(e,t.message))}else o(new qr(Br.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new qr(Br.UNAVAILABLE,"Connection failed."));break;default:Fr()}}finally{xr(mh,"RPC '".concat(e,"' ").concat(i," completed."))}}));const c=JSON.stringify(r);xr(mh,"RPC '".concat(e,"' ").concat(i," sending request:"),r),a.send(t,"POST",c,n,15)}))}Fo(e,t,n){const r=fh(),i=[this.fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=vr(),o=wr(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Do(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const u=i.join("");xr(mh,"Creating RPC '".concat(e,"' stream ").concat(r,": ").concat(u),a);const l=s.createWebChannel(u,a);let h=!1,d=!1;const f=new gh({lo:t=>{d?xr(mh,"Not sending because RPC '".concat(e,"' stream ").concat(r," is closed:"),t):(h||(xr(mh,"Opening RPC '".concat(e,"' stream ").concat(r," transport.")),l.open(),h=!0),xr(mh,"RPC '".concat(e,"' stream ").concat(r," sending:"),t),l.send(t))},ho:()=>l.close()}),p=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return p(l,Er.EventType.OPEN,(()=>{d||xr(mh,"RPC '".concat(e,"' stream ").concat(r," transport opened."))})),p(l,Er.EventType.CLOSE,(()=>{d||(d=!0,xr(mh,"RPC '".concat(e,"' stream ").concat(r," transport closed")),f.Vo())})),p(l,Er.EventType.ERROR,(t=>{d||(d=!0,Lr(mh,"RPC '".concat(e,"' stream ").concat(r," transport errored:"),t),f.Vo(new qr(Br.UNAVAILABLE,"The operation could not be completed")))})),p(l,Er.EventType.MESSAGE,(t=>{var n;if(!d){const i=t.data[0];Vr(!!i);const s=i,o=s.error||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){xr(mh,"RPC '".concat(e,"' stream ").concat(r," received error:"),o);const t=o.status;let n=function(e){const t=Ya[e];if(void 0!==t)return $a(t)}(t),i=o.message;void 0===n&&(n=Br.INTERNAL,i="Unknown error status: "+t+" with message "+o.message),d=!0,f.Vo(new qr(n,i)),l.close()}else xr(mh,"RPC '".concat(e,"' stream ").concat(r," received:"),i),f.mo(i)}})),p(o,br.STAT_EVENT,(t=>{t.stat===Tr.PROXY?xr(mh,"RPC '".concat(e,"' stream ").concat(r," detected buffering proxy")):t.stat===Tr.NOPROXY&&xr(mh,"RPC '".concat(e,"' stream ").concat(r," detected no buffering proxy"))})),setTimeout((()=>{f.Ro()}),0),f}}function vh(){return"undefined"!=typeof window?window:null}function wh(){return"undefined"!=typeof document?document:null}function _h(e){return new vc(e,!0)}class Ih{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;this.oi=e,this.timerId=t,this.Mo=n,this.xo=r,this.Oo=i,this.No=0,this.Lo=null,this.Bo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(e){this.cancel();const t=Math.floor(this.No+this.Qo()),n=Math.max(0,Date.now()-this.Bo),r=Math.max(0,t-n);r>0&&xr("ExponentialBackoff","Backing off for ".concat(r," ms (base delay: ").concat(this.No," ms, delay with jitter: ").concat(t," ms, last attempt: ").concat(n," ms ago)")),this.Lo=this.oi.enqueueAfterDelay(this.timerId,r,(()=>(this.Bo=Date.now(),e()))),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){null!==this.Lo&&(this.Lo.skipDelay(),this.Lo=null)}cancel(){null!==this.Lo&&(this.Lo.cancel(),this.Lo=null)}Qo(){return(Math.random()-.5)*this.No}}class bh{constructor(e,t,n,r,i,s,o,a){this.oi=e,this.$o=n,this.Uo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new Ih(e,t)}Ho(){return 1===this.state||5===this.state||this.Jo()}Jo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Yo()}async stop(){this.Ho()&&await this.close(0)}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&null===this.Go&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,(()=>this.e_())))}t_(e){this.n_(),this.stream.send(e)}async e_(){if(this.Jo())return this.close(0)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}async close(e,t){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,4!==e?this.jo.reset():t&&t.code===Br.RESOURCE_EXHAUSTED?(Or(t.toString()),Or("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):t&&t.code===Br.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.i_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.To(t)}i_(){}auth(){this.state=1;const e=this.s_(this.Wo),t=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((e=>{let[n,r]=e;this.Wo===t&&this.o_(n,r)}),(t=>{e((()=>{const e=new qr(Br.UNKNOWN,"Fetching auth token failed: "+t.message);return this.__(e)}))}))}o_(e,t){const n=this.s_(this.Wo);this.stream=this.a_(e,t),this.stream.Po((()=>{n((()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,(()=>(this.Jo()&&(this.state=3),Promise.resolve()))),this.listener.Po())))})),this.stream.To((e=>{n((()=>this.__(e)))})),this.stream.onMessage((e=>{n((()=>this.onMessage(e)))}))}Yo(){this.state=5,this.jo.qo((async()=>{this.state=0,this.start()}))}__(e){return xr("PersistentStream","close with error: ".concat(e)),this.stream=null,this.close(4,e)}s_(e){return t=>{this.oi.enqueueAndForget((()=>this.Wo===e?t():(xr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Th extends bh{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}a_(e,t){return this.connection.Fo("Listen",e,t)}onMessage(e){this.jo.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Fr()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.useProto3Json?(Vr(void 0===t||"string"==typeof t),Ts.fromBase64String(t||"")):(Vr(void 0===t||t instanceof Uint8Array),Ts.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?Br.UNKNOWN:$a(e.code);return new qr(t,e.message||"")}(o);n=new lc(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=kc(e,r.document.name),s=Tc(r.document.updateTime),o=r.document.createTime?Tc(r.document.createTime):ri.min(),a=new eo({mapValue:{fields:r.document.fields}}),c=no.newFoundDocument(i,s,o,a),u=r.targetIds||[],l=r.removedTargetIds||[];n=new cc(u,l,c.key,c)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=kc(e,r.document),s=r.readTime?Tc(r.readTime):ri.min(),o=no.newNoDocument(i,s),a=r.removedTargetIds||[];n=new cc([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=kc(e,r.document),s=r.removedTargetIds||[];n=new cc([],s,i,null)}else{if(!("filter"in t))return Fr();{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:i}=e,s=new Qa(r,i),o=e.targetId;n=new uc(o,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return ri.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?ri.min():t.readTime?Tc(t.readTime):ri.min()}(e);return this.listener.u_(t,n)}c_(e){const t={};t.database=Rc(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=Po(r)?{documents:Fc(e,r)}:{query:Vc(e,r).ut},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=Ic(e,t.resumeToken);const r=wc(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(ri.min())>0){n.readTime=_c(e,t.snapshotVersion.toTimestamp());const r=wc(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Fr()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.t_(t)}l_(e){const t={};t.database=Rc(this.serializer),t.removeTarget=e,this.t_(t)}}class Eh extends bh{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(e,t){return this.connection.Fo("Write",e,t)}onMessage(e){if(Vr(!!e.streamToken),this.lastStreamToken=e.streamToken,this.h_){this.jo.reset();const t=function(e,t){return e&&e.length>0?(Vr(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?Tc(e.updateTime):Tc(t);return n.isEqual(ri.min())&&(n=Tc(t)),new Na(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=Tc(e.commitTime);return this.listener.T_(n,t)}return Vr(!e.writeResults||0===e.writeResults.length),this.h_=!0,this.listener.E_()}d_(){const e={};e.database=Rc(this.serializer),this.t_(e)}I_(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>Lc(this.serializer,e)))};this.t_(t)}}class Sh extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.A_=!1}R_(){if(this.A_)throw new qr(Br.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,t,n,r){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((i=>{let[s,o]=i;return this.connection.So(e,Sc(t,n),r,s,o)})).catch((e=>{throw"FirebaseError"===e.name?(e.code===Br.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new qr(Br.UNKNOWN,e.toString())}))}vo(e,t,n,r,i){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((s=>{let[o,a]=s;return this.connection.vo(e,Sc(t,n),r,o,a,i)})).catch((e=>{throw"FirebaseError"===e.name?(e.code===Br.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new qr(Br.UNKNOWN,e.toString())}))}terminate(){this.A_=!0,this.connection.terminate()}}class Ah{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){0===this.m_&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve()))))}S_(e){"Online"===this.state?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_("Connection failed 1 times. Most recent error: ".concat(e.toString())),this.y_("Offline")))}set(e){this.b_(),this.m_=0,"Online"===e&&(this.g_=!1),this.y_(e)}y_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}w_(e){const t="Could not reach Cloud Firestore backend. ".concat(e,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.g_?(Or(t),this.g_=!1):xr("OnlineStateTracker",t)}b_(){null!==this.f_&&(this.f_.cancel(),this.f_=null)}}class Ch{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=i,this.M_.io((e=>{n.enqueueAndForget((async()=>{Mh(this)&&(xr("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=Ur(e);t.v_.add(4),await Nh(t),t.x_.set("Unknown"),t.v_.delete(4),await kh(t)}(this))}))})),this.x_=new Ah(n,r)}}async function kh(e){if(Mh(e))for(const t of e.F_)await t(!0)}async function Nh(e){for(const t of e.F_)await t(!1)}function Dh(e,t){const n=Ur(e);n.C_.has(t.targetId)||(n.C_.set(t.targetId,t),Lh(n)?Oh(n):ed(n).Jo()&&Ph(n,t))}function Rh(e,t){const n=Ur(e),r=ed(n);n.C_.delete(t),r.Jo()&&xh(n,t),0===n.C_.size&&(r.Jo()?r.Xo():Mh(n)&&n.x_.set("Unknown"))}function Ph(e,t){if(e.O_.Oe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(ri.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}ed(e).c_(t)}function xh(e,t){e.O_.Oe(t),ed(e).l_(t)}function Oh(e){e.O_=new dc({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),_t:t=>e.C_.get(t)||null,nt:()=>e.datastore.serializer.databaseId}),ed(e).start(),e.x_.p_()}function Lh(e){return Mh(e)&&!ed(e).Ho()&&e.C_.size>0}function Mh(e){return 0===Ur(e).v_.size}function Fh(e){e.O_=void 0}async function Vh(e){e.C_.forEach(((t,n)=>{Ph(e,t)}))}async function Uh(e,t){Fh(e),Lh(e)?(e.x_.S_(t),Oh(e)):e.x_.set("Unknown")}async function Bh(e,t,n){if(e.x_.set("Online"),t instanceof lc&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.C_.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.C_.delete(r),e.O_.removeTarget(r))}(e,t)}catch(n){xr("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await qh(e,n)}else if(t instanceof cc?e.O_.$e(t):t instanceof uc?e.O_.Je(t):e.O_.Ge(t),!n.isEqual(ri.min()))try{const t=await Kl(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.O_.it(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.C_.get(r);i&&e.C_.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const r=e.C_.get(t);if(!r)return;e.C_.set(t,r.withResumeToken(Ts.EMPTY_BYTE_STRING,r.snapshotVersion)),xh(e,t);const i=new Yc(r.target,t,n,r.sequenceNumber);Ph(e,i)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){xr("RemoteStore","Failed to raise snapshot:",t),await qh(e,t)}}async function qh(e,t,n){if(!Ai(t))throw t;e.v_.add(1),await Nh(e),e.x_.set("Offline"),n||(n=()=>Kl(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{xr("RemoteStore","Retrying IndexedDB access"),await n(),e.v_.delete(1),await kh(e)}))}function jh(e,t){return t().catch((n=>qh(e,n,t)))}async function zh(e){const t=Ur(e),n=td(t);let r=t.D_.length>0?t.D_[t.D_.length-1].batchId:-1;for(;Kh(t);)try{const e=await Wl(t.localStore,r);if(null===e){0===t.D_.length&&n.Xo();break}r=e.batchId,Gh(t,e)}catch(e){await qh(t,e)}Wh(t)&&Hh(t)}function Kh(e){return Mh(e)&&e.D_.length<10}function Gh(e,t){e.D_.push(t);const n=td(e);n.Jo()&&n.P_&&n.I_(t.mutations)}function Wh(e){return Mh(e)&&!td(e).Ho()&&e.D_.length>0}function Hh(e){td(e).start()}async function Qh(e){td(e).d_()}async function Yh(e){const t=td(e);for(const n of e.D_)t.I_(n.mutations)}async function Jh(e,t,n){const r=e.D_.shift(),i=Wa.from(r,t,n);await jh(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await zh(e)}async function Xh(e,t){t&&td(e).P_&&await async function(e,t){if(function(e){return Xa(e)&&e!==Br.ABORTED}(t.code)){const n=e.D_.shift();td(e).Zo(),await jh(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await zh(e)}}(e,t),Wh(e)&&Hh(e)}async function $h(e,t){const n=Ur(e);n.asyncQueue.verifyOperationInProgress(),xr("RemoteStore","RemoteStore received new credentials");const r=Mh(n);n.v_.add(3),await Nh(n),r&&n.x_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.v_.delete(3),await kh(n)}async function Zh(e,t){const n=Ur(e);t?(n.v_.delete(2),await kh(n)):t||(n.v_.add(2),await Nh(n),n.x_.set("Unknown"))}function ed(e){return e.N_||(e.N_=function(e,t,n){const r=Ur(e);return r.R_(),new Th(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Po:Vh.bind(null,e),To:Uh.bind(null,e),u_:Bh.bind(null,e)}),e.F_.push((async t=>{t?(e.N_.Zo(),Lh(e)?Oh(e):e.x_.set("Unknown")):(await e.N_.stop(),Fh(e))}))),e.N_}function td(e){return e.L_||(e.L_=function(e,t,n){const r=Ur(e);return r.R_(),new Eh(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Po:Qh.bind(null,e),To:Xh.bind(null,e),E_:Yh.bind(null,e),T_:Jh.bind(null,e)}),e.F_.push((async t=>{t?(e.L_.Zo(),await zh(e)):(await e.L_.stop(),e.D_.length>0&&(xr("RemoteStore","Stopping write stream with ".concat(e.D_.length," pending writes")),e.D_=[]))}))),e.L_}class nd{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new jr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new nd(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new qr(Br.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function rd(e,t){if(Or("AsyncQueue","".concat(t,": ").concat(e)),Ai(e))return new qr(Br.UNAVAILABLE,"".concat(t,": ").concat(e));throw e}class id{constructor(e){this.comparator=e?(t,n)=>e(t,n)||ci.comparator(t.key,n.key):(e,t)=>ci.comparator(e.key,t.key),this.keyedMap=ra(),this.sortedSet=new gs(this.comparator)}static emptySet(e){return new id(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof id))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new id;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class sd{constructor(){this.B_=new gs(ci.comparator)}track(e){const t=e.doc.key,n=this.B_.get(t);n?0!==e.type&&3===n.type?this.B_=this.B_.insert(t,e):3===e.type&&1!==n.type?this.B_=this.B_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.B_=this.B_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.B_=this.B_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.B_=this.B_.remove(t):1===e.type&&2===n.type?this.B_=this.B_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.B_=this.B_.insert(t,{type:2,doc:e.doc}):Fr():this.B_=this.B_.insert(t,e)}k_(){const e=[];return this.B_.inorderTraversal(((t,n)=>{e.push(n)})),e}}class od{constructor(e,t,n,r,i,s,o,a,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach((e=>{s.push({type:0,doc:e})})),new od(e,t,id.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Wo(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}class ad{constructor(){this.q_=void 0,this.Q_=[]}K_(){return this.Q_.some((e=>e.U_()))}}class cd{constructor(){this.queries=new Zo((e=>Ho(e)),Wo),this.onlineState="Unknown",this.W_=new Set}}async function ud(e,t){const n=Ur(e);let r=3;const i=t.query;let s=n.queries.get(i);s?!s.K_()&&t.U_()&&(r=2):(s=new ad,r=t.U_()?0:1);try{switch(r){case 0:s.q_=await n.onListen(i,!0);break;case 1:s.q_=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(e){const n=rd(e,"Initialization of query '".concat(Qo(t.query),"' failed"));return void t.onError(n)}n.queries.set(i,s),s.Q_.push(t),t.G_(n.onlineState),s.q_&&t.z_(s.q_)&&fd(n)}async function ld(e,t){const n=Ur(e),r=t.query;let i=3;const s=n.queries.get(r);if(s){const e=s.Q_.indexOf(t);e>=0&&(s.Q_.splice(e,1),0===s.Q_.length?i=t.U_()?0:1:!s.K_()&&t.U_()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function hd(e,t){const n=Ur(e);let r=!1;for(const i of t){const e=i.query,t=n.queries.get(e);if(t){for(const e of t.Q_)e.z_(i)&&(r=!0);t.q_=i}}r&&fd(n)}function dd(e,t,n){const r=Ur(e),i=r.queries.get(t);if(i)for(const s of i.Q_)s.onError(n);r.queries.delete(t)}function fd(e){e.W_.forEach((e=>{e.next()}))}var pd,gd;(gd=pd||(pd={})).j_="default",gd.Cache="cache";class md{constructor(e,t,n){this.query=e,this.H_=t,this.J_=!1,this.Y_=null,this.onlineState="Unknown",this.options=n||{}}z_(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new od(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.J_?this.Z_(e)&&(this.H_.next(e),t=!0):this.X_(e,this.onlineState)&&(this.ea(e),t=!0),this.Y_=e,t}onError(e){this.H_.error(e)}G_(e){this.onlineState=e;let t=!1;return this.Y_&&!this.J_&&this.X_(this.Y_,e)&&(this.ea(this.Y_),t=!0),t}X_(e,t){if(!e.fromCache)return!0;if(!this.U_())return!0;const n="Offline"!==t;return(!this.options.ta||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Z_(e){if(e.docChanges.length>0)return!0;const t=this.Y_&&this.Y_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ea(e){e=od.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.J_=!0,this.H_.next(e)}U_(){return this.options.source!==pd.Cache}}class yd{constructor(e,t){this.na=e,this.byteLength=t}ra(){return"metadata"in this.na}}class vd{constructor(e){this.serializer=e}Ps(e){return kc(this.serializer,e)}Is(e){return e.metadata.exists?Oc(this.serializer,e.document,!1):no.newNoDocument(this.Ps(e.metadata.name),this.Ts(e.metadata.readTime))}Ts(e){return Tc(e)}}class wd{constructor(e,t,n){this.ia=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=_d(e)}sa(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.na.namedQuery)this.queries.push(e.na.namedQuery);else if(e.na.documentMetadata){this.documents.push({metadata:e.na.documentMetadata}),e.na.documentMetadata.exists||++t;const n=si.fromString(e.na.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.na.document&&(this.documents[this.documents.length-1].document=e.na.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}oa(e){const t=new Map,n=new vd(this.serializer);for(const r of e)if(r.metadata.queries){const e=n.Ps(r.metadata.name);for(const n of r.metadata.queries){const r=(t.get(n)||la()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const i=Ur(e);let s=la(),o=ta();for(const u of n){const e=t.Ps(u.metadata.name);u.document&&(s=s.add(e));const n=t.Is(u);n.setReadTime(t.Ts(u.metadata.readTime)),o=o.insert(e,n)}const a=i.os.newChangeBuffer({trackRemovals:!0}),c=await Hl(i,function(e){return jo(Vo(si.fromString("__bundle__/docs/".concat(e))))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",(e=>Gl(e,a,o).next((t=>(a.apply(e),t))).next((t=>i.Qr.removeMatchingKeysForTargetId(e,c.targetId).next((()=>i.Qr.addMatchingKeys(e,s,c.targetId))).next((()=>i.localDocuments.getLocalViewOfDocuments(e,t.cs,t.ls))).next((()=>t.cs))))))}(this.localStore,new vd(this.serializer),this.documents,this.ia.id),t=this.oa(this.documents);for(const n of this.queries)await Zl(this.localStore,n,t.get(n.name));return this.progress.taskState="Success",{progress:this.progress,_a:this.collectionGroups,aa:e}}}function _d(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class Id{constructor(e){this.key=e}}class bd{constructor(e){this.key=e}}class Td{constructor(e,t){this.query=e,this.ua=t,this.ca=null,this.hasCachedResults=!1,this.current=!1,this.la=la(),this.mutatedKeys=la(),this.ha=Xo(e),this.Pa=new id(this.ha)}get Ia(){return this.ua}Ta(e,t){const n=t?t.Ea:new sd,r=t?t.Pa:this.Pa;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const u=r.get(e),l=Yo(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.da(u,l)||(n.track({type:2,doc:l}),f=!0,(a&&this.ha(l,a)>0||c&&this.ha(l,c)<0)&&(o=!0)):!u&&l?(n.track({type:0,doc:l}),f=!0):u&&!l&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(l?(s=s.add(l),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{Pa:s,Ea:n,Xi:o,mutatedKeys:i}}da(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){const i=this.Pa;this.Pa=e.Pa,this.mutatedKeys=e.mutatedKeys;const s=e.Ea.k_();s.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Fr()}};return n(e)-n(t)}(e.type,t.type)||this.ha(e.doc,t.doc))),this.Aa(n),r=null!=r&&r;const o=t&&!r?this.Ra():[],a=0===this.la.size&&this.current&&!r?1:0,c=a!==this.ca;return this.ca=a,0!==s.length||c?{snapshot:new od(this.query,e.Pa,i,s,e.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),Va:o}:{Va:o}}G_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Pa:this.Pa,Ea:new sd,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{Va:[]}}ma(e){return!this.ua.has(e)&&!!this.Pa.has(e)&&!this.Pa.get(e).hasLocalMutations}Aa(e){e&&(e.addedDocuments.forEach((e=>this.ua=this.ua.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.ua=this.ua.delete(e))),this.current=e.current)}Ra(){if(!this.current)return[];const e=this.la;this.la=la(),this.Pa.forEach((e=>{this.ma(e.key)&&(this.la=this.la.add(e.key))}));const t=[];return e.forEach((e=>{this.la.has(e)||t.push(new bd(e))})),this.la.forEach((n=>{e.has(n)||t.push(new Id(n))})),t}fa(e){this.ua=e.hs,this.la=la();const t=this.Ta(e.documents);return this.applyChanges(t,!0)}ga(){return od.fromInitialDocuments(this.query,this.Pa,this.mutatedKeys,0===this.ca,this.hasCachedResults)}}class Ed{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Sd{constructor(e){this.key=e,this.pa=!1}}class Ad{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.ya={},this.wa=new Zo((e=>Ho(e)),Wo),this.Sa=new Map,this.ba=new Set,this.Da=new gs(ci.comparator),this.Ca=new Map,this.va=new bl,this.Fa={},this.Ma=new Map,this.xa=Xu.Ln(),this.onlineState="Unknown",this.Oa=void 0}get isPrimaryClient(){return!0===this.Oa}}async function Cd(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=nf(e);let i;const s=r.wa.get(t);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ga()):i=await Nd(r,t,n,!0),i}async function kd(e,t){const n=nf(e);await Nd(n,t,!0,!1)}async function Nd(e,t,n,r){const i=await Hl(e.localStore,jo(t)),s=i.targetId,o=n?e.sharedClientState.addLocalQueryTarget(s):"not-current";let a;return r&&(a=await Dd(e,t,s,"current"===o,i.resumeToken)),e.isPrimaryClient&&n&&Dh(e.remoteStore,i),a}async function Dd(e,t,n,r,i){e.Na=(t,n,r)=>async function(e,t,n,r){let i=t.view.Ta(n);i.Xi&&(i=await Yl(e.localStore,t.query,!1).then((e=>{let{documents:n}=e;return t.view.Ta(n,i)})));const s=r&&r.targetChanges.get(t.targetId),o=r&&null!=r.targetMismatches.get(t.targetId),a=t.view.applyChanges(i,e.isPrimaryClient,s,o);return jd(e,t.targetId,a.Va),a.snapshot}(e,t,n,r);const s=await Yl(e.localStore,t,!0),o=new Td(t,s.hs),a=o.Ta(s.documents),c=ac.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=o.applyChanges(a,e.isPrimaryClient,c);jd(e,n,u.Va);const l=new Ed(t,n,o);return e.wa.set(t,l),e.Sa.has(n)?e.Sa.get(n).push(t):e.Sa.set(n,[t]),u.snapshot}async function Rd(e,t,n){const r=Ur(e),i=r.wa.get(t),s=r.Sa.get(i.targetId);if(s.length>1)return r.Sa.set(i.targetId,s.filter((e=>!Wo(e,t)))),void r.wa.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await Ql(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),n&&Rh(r.remoteStore,i.targetId),Bd(r,i.targetId)})).catch(_i)):(Bd(r,i.targetId),await Ql(r.localStore,i.targetId,!0))}async function Pd(e,t){const n=Ur(e),r=n.wa.get(t),i=n.Sa.get(r.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),Rh(n.remoteStore,r.targetId))}async function xd(e,t){const n=Ur(e);try{const e=await function(e,t){const n=Ur(e),r=t.snapshotVersion;let i=n.ns;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const s=n.os.newChangeBuffer({trackRemovals:!0});i=n.ns;const o=[];t.targetChanges.forEach(((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.Qr.removeMatchingKeys(e,s.removedDocuments,a).next((()=>n.Qr.addMatchingKeys(e,s.addedDocuments,a))));let u=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?u=u.withResumeToken(Ts.EMPTY_BYTE_STRING,ri.min()).withLastLimboFreeSnapshotVersion(ri.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.Qr.updateTargetData(e,u))}));let a=ta(),c=la();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(Gl(e,s,t.documentUpdates).next((e=>{a=e.cs,c=e.ls}))),!r.isEqual(ri.min())){const t=n.Qr.getLastRemoteSnapshotVersion(e).next((t=>n.Qr.setTargetsMetadata(e,e.currentSequenceNumber,r)));o.push(t)}return Ii.waitFor(o).next((()=>s.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,a,c))).next((()=>a))})).then((e=>(n.ns=i,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.Ca.get(t);r&&(Vr(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.pa=!0:e.modifiedDocuments.size>0?Vr(r.pa):e.removedDocuments.size>0&&(Vr(r.pa),r.pa=!1))})),await Gd(n,e,t)}catch(e){await _i(e)}}function Od(e,t,n){const r=Ur(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.wa.forEach(((n,r)=>{const i=r.view.G_(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){const n=Ur(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const i of n.Q_)i.G_(t)&&(r=!0)})),r&&fd(n)}(r.eventManager,t),e.length&&r.ya.u_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Ld(e,t,n){const r=Ur(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Ca.get(t),s=i&&i.key;if(s){let e=new gs(ci.comparator);e=e.insert(s,no.newNoDocument(s,ri.min()));const n=la().add(s),i=new oc(ri.min(),new Map,new gs(Zr),e,n);await xd(r,i),r.Da=r.Da.remove(s),r.Ca.delete(t),Kd(r)}else await Ql(r.localStore,t,!1).then((()=>Bd(r,t,n))).catch(_i)}async function Md(e,t){const n=Ur(e),r=t.batch.batchId;try{const e=await function(e,t){const n=Ur(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),i=n.os.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=Ii.resolve();return s.forEach((e=>{o=o.next((()=>r.getEntry(t,e))).next((t=>{const s=n.docVersions.get(e);Vr(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=la();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(n.localStore,t);Ud(n,r,null),Vd(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Gd(n,e)}catch(e){await _i(e)}}async function Fd(e,t,n){const r=Ur(e);try{const e=await function(e,t){const n=Ur(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(Vr(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(r.localStore,t);Ud(r,t,n),Vd(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await Gd(r,e)}catch(n){await _i(n)}}function Vd(e,t){(e.Ma.get(t)||[]).forEach((e=>{e.resolve()})),e.Ma.delete(t)}function Ud(e,t,n){const r=Ur(e);let i=r.Fa[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Fa[r.currentUser.toKey()]=i}}function Bd(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Sa.get(t))e.wa.delete(r),n&&e.ya.La(r,n);e.Sa.delete(t),e.isPrimaryClient&&e.va.Vr(t).forEach((t=>{e.va.containsKey(t)||qd(e,t)}))}function qd(e,t){e.ba.delete(t.path.canonicalString());const n=e.Da.get(t);null!==n&&(Rh(e.remoteStore,n),e.Da=e.Da.remove(t),e.Ca.delete(n),Kd(e))}function jd(e,t,n){for(const r of n)r instanceof Id?(e.va.addReference(r.key,t),zd(e,r)):r instanceof bd?(xr("SyncEngine","Document no longer in limbo: "+r.key),e.va.removeReference(r.key,t),e.va.containsKey(r.key)||qd(e,r.key)):Fr()}function zd(e,t){const n=t.key,r=n.path.canonicalString();e.Da.get(n)||e.ba.has(r)||(xr("SyncEngine","New document in limbo: "+n),e.ba.add(r),Kd(e))}function Kd(e){for(;e.ba.size>0&&e.Da.size<e.maxConcurrentLimboResolutions;){const t=e.ba.values().next().value;e.ba.delete(t);const n=new ci(si.fromString(t)),r=e.xa.next();e.Ca.set(r,new Sd(n)),e.Da=e.Da.insert(n,r),Dh(e.remoteStore,new Yc(jo(Vo(n.path)),r,"TargetPurposeLimboResolution",xi._e))}}async function Gd(e,t,n){const r=Ur(e),i=[],s=[],o=[];r.wa.isEmpty()||(r.wa.forEach(((e,a)=>{o.push(r.Na(a,t,n).then((e=>{if((e||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){i.push(e);const t=Vl.Ki(a.targetId,e);s.push(t)}})))})),await Promise.all(o),r.ya.u_(i),await async function(e,t){const n=Ur(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>Ii.forEach(t,(t=>Ii.forEach(t.qi,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>Ii.forEach(t.Qi,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!Ai(e))throw e;xr("LocalStore","Failed to update sequence numbers: "+e)}for(const r of t){const e=r.targetId;if(!r.fromCache){const t=n.ns.get(e),r=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(r);n.ns=n.ns.insert(e,i)}}}(r.localStore,s))}async function Wd(e,t){const n=Ur(e);if(!n.currentUser.isEqual(t)){xr("SyncEngine","User change. New user:",t.toKey());const e=await zl(n.localStore,t);n.currentUser=t,function(e,t){e.Ma.forEach((e=>{e.forEach((e=>{e.reject(new qr(Br.CANCELLED,t))}))})),e.Ma.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Gd(n,e.us)}}function Hd(e,t){const n=Ur(e),r=n.Ca.get(t);if(r&&r.pa)return la().add(r.key);{let e=la();const r=n.Sa.get(t);if(!r)return e;for(const t of r){const r=n.wa.get(t);e=e.unionWith(r.view.Ia)}return e}}async function Qd(e,t){const n=Ur(e),r=await Yl(n.localStore,t.query,!0),i=t.view.fa(r);return n.isPrimaryClient&&jd(n,t.targetId,i.Va),i}async function Yd(e,t){const n=Ur(e);return Xl(n.localStore,t).then((e=>Gd(n,e)))}async function Jd(e,t,n,r){const i=Ur(e),s=await function(e,t){const n=Ur(e),r=Ur(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",(e=>r.vn(e,t).next((t=>t?n.localDocuments.getDocuments(e,t):Ii.resolve(null)))))}(i.localStore,t);null!==s?("pending"===n?await zh(i.remoteStore):"acknowledged"===n||"rejected"===n?(Ud(i,t,r||null),Vd(i,t),function(e,t){Ur(Ur(e).mutationQueue).Mn(t)}(i.localStore,t)):Fr(),await Gd(i,s)):xr("SyncEngine","Cannot apply mutation batch with id: "+t)}async function Xd(e,t,n){const r=Ur(e),i=[],s=[];for(const o of t){let e;const t=r.Sa.get(o);if(t&&0!==t.length){e=await Hl(r.localStore,jo(t[0]));for(const e of t){const t=r.wa.get(e),n=await Qd(r,t);n.snapshot&&s.push(n.snapshot)}}else{const t=await Jl(r.localStore,o);e=await Hl(r.localStore,t),await Dd(r,$d(t),o,!1,e.resumeToken)}i.push(e)}return r.ya.u_(s),i}function $d(e){return Fo(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function Zd(e){return function(e){return Ur(Ur(e).persistence).Bi()}(Ur(e).localStore)}async function ef(e,t,n,r){const i=Ur(e);if(i.Oa)return void xr("SyncEngine","Ignoring unexpected query state notification.");const s=i.Sa.get(t);if(s&&s.length>0)switch(n){case"current":case"not-current":{const e=await Xl(i.localStore,Jo(s[0])),r=oc.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,Ts.EMPTY_BYTE_STRING);await Gd(i,e,r);break}case"rejected":await Ql(i.localStore,t,!0),Bd(i,t,r);break;default:Fr()}}async function tf(e,t,n){const r=nf(e);if(r.Oa){for(const e of t){if(r.Sa.has(e)&&r.sharedClientState.isActiveQueryTarget(e)){xr("SyncEngine","Adding an already active target "+e);continue}const t=await Jl(r.localStore,e),n=await Hl(r.localStore,t);await Dd(r,$d(t),n.targetId,!1,n.resumeToken),Dh(r.remoteStore,n)}for(const e of n)r.Sa.has(e)&&await Ql(r.localStore,e,!1).then((()=>{Rh(r.remoteStore,e),Bd(r,e)})).catch(_i)}}function nf(e){const t=Ur(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=xd.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Hd.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Ld.bind(null,t),t.ya.u_=hd.bind(null,t.eventManager),t.ya.La=dd.bind(null,t.eventManager),t}function rf(e){const t=Ur(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Md.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Fd.bind(null,t),t}class sf{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=_h(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return jl(this.persistence,new Bl,e.initialUser,this.serializer)}createPersistence(e){return new kl(Dl.Hr,this.serializer)}createSharedClientState(e){return new uh}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class of extends sf{constructor(e,t,n){super(),this.ka=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.ka.initialize(this,e),await rf(this.ka.syncEngine),await zh(this.ka.remoteStore),await this.persistence.fi((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}createLocalStore(e){return jl(this.persistence,new Bl,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){const n=this.persistence.referenceDelegate.garbageCollector;return new il(n,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const n=new Pi(t,this.persistence);return new Ri(e.asyncQueue,n)}createPersistence(e){const t=Fl(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?zu.withCacheSize(this.cacheSizeBytes):zu.DEFAULT;return new Ol(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,vh(),wh(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new uh}}class af extends of{constructor(e,t){super(e,t,!1),this.ka=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.ka.syncEngine;this.sharedClientState instanceof ch&&(this.sharedClientState.syncEngine={Zs:Jd.bind(null,t),Xs:ef.bind(null,t),eo:tf.bind(null,t),Bi:Zd.bind(null,t),Ys:Yd.bind(null,t)},await this.sharedClientState.start()),await this.persistence.fi((async e=>{await async function(e,t){const n=Ur(e);if(nf(n),rf(n),!0===t&&!0!==n.Oa){const e=n.sharedClientState.getAllActiveQueryTargets(),t=await Xd(n,e.toArray());n.Oa=!0,await Zh(n.remoteStore,!0);for(const r of t)Dh(n.remoteStore,r)}else if(!1===t&&!1!==n.Oa){const e=[];let t=Promise.resolve();n.Sa.forEach(((r,i)=>{n.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then((()=>(Bd(n,i),Ql(n.localStore,i,!0)))),Rh(n.remoteStore,i)})),await t,await Xd(n,e),function(e){const t=Ur(e);t.Ca.forEach(((e,n)=>{Rh(t.remoteStore,n)})),t.va.mr(),t.Ca=new Map,t.Da=new gs(ci.comparator)}(n),n.Oa=!1,await Zh(n.remoteStore,!1)}}(this.ka.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())}))}createSharedClientState(e){const t=vh();if(!ch.D(t))throw new qr(Br.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Fl(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new ch(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class cf{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Od(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=Wd.bind(null,this.syncEngine),await Zh(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new cd}createDatastore(e){const t=_h(e.databaseInfo.databaseId),n=function(e){return new yh(e)}(e.databaseInfo);return function(e,t,n,r){return new Sh(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,r,i){return new Ch(e,t,n,r,i)}(this.localStore,this.datastore,e.asyncQueue,(e=>Od(this.syncEngine,e,0)),hh.D()?new hh:new lh)}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new Ad(e,t,n,r,i,s);return o&&(a.Oa=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e;await async function(e){const t=Ur(e);xr("RemoteStore","RemoteStore shutting down."),t.v_.add(5),await Nh(t),t.M_.shutdown(),t.x_.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate()}}function uf(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10240,n=0;return{async read(){if(n<e.byteLength){const r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}class lf{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.qa(this.observer.next,e)}error(e){this.observer.error?this.qa(this.observer.error,e):Or("Uncaught Error in snapshot listener:",e.toString())}Qa(){this.muted=!0}qa(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class hf{constructor(e,t){this.Ka=e,this.serializer=t,this.metadata=new jr,this.buffer=new Uint8Array,this.$a=new TextDecoder("utf-8"),this.Ua().then((e=>{e&&e.ra()?this.metadata.resolve(e.na.metadata):this.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             ".concat(JSON.stringify(null==e?void 0:e.na))))}),(e=>this.metadata.reject(e)))}close(){return this.Ka.cancel()}async getMetadata(){return this.metadata.promise}async Ba(){return await this.getMetadata(),this.Ua()}async Ua(){const e=await this.Wa();if(null===e)return null;const t=this.$a.decode(e),n=Number(t);isNaN(n)&&this.Ga("length string (".concat(t,") is not valid number"));const r=await this.za(n);return new yd(JSON.parse(r),e.length+n)}ja(){return this.buffer.findIndex((e=>e==="{".charCodeAt(0)))}async Wa(){for(;this.ja()<0&&!await this.Ha(););if(0===this.buffer.length)return null;const e=this.ja();e<0&&this.Ga("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async za(e){for(;this.buffer.length<e;)await this.Ha()&&this.Ga("Reached the end of bundle when more is expected.");const t=this.$a.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Ga(e){throw this.Ka.cancel(),new Error("Invalid bundle format: ".concat(e))}async Ha(){const e=await this.Ka.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class df{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new qr(Br.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(e,t){const n=Ur(e),r={documents:t.map((e=>Cc(n.serializer,e)))},i=await n.vo("BatchGetDocuments",n.serializer.databaseId,si.emptyPath(),r,t.length),s=new Map;i.forEach((e=>{const t=function(e,t){return"found"in t?function(e,t){Vr(!!t.found),t.found.name,t.found.updateTime;const n=kc(e,t.found.name),r=Tc(t.found.updateTime),i=t.found.createTime?Tc(t.found.createTime):ri.min(),s=new eo({mapValue:{fields:t.found.fields}});return no.newFoundDocument(n,r,i,s)}(e,t):"missing"in t?function(e,t){Vr(!!t.missing),Vr(!!t.readTime);const n=kc(e,t.missing),r=Tc(t.readTime);return no.newNoDocument(n,r)}(e,t):Fr()}(n.serializer,e);s.set(t.key.toString(),t)}));const o=[];return t.forEach((e=>{const t=s.get(e.toString());Vr(!!t),o.push(t)})),o}(this.datastore,e);return t.forEach((e=>this.recordVersion(e))),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new za(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach((t=>{e.delete(t.key.toString())})),e.forEach(((e,t)=>{const n=ci.fromPath(t);this.mutations.push(new Ka(n,this.precondition(n)))})),await async function(e,t){const n=Ur(e),r={writes:t.map((e=>Lc(n.serializer,e)))};await n.So("Commit",n.serializer.databaseId,si.emptyPath(),r)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Fr();t=ri.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new qr(Br.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(ri.min())?Da.exists(!1):Da.updateTime(t):Da.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(ri.min()))throw new qr(Br.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Da.updateTime(t)}return Da.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class ff{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.Ja=n.maxAttempts,this.jo=new Ih(this.asyncQueue,"transaction_retry")}Ya(){this.Ja-=1,this.Za()}Za(){this.jo.qo((async()=>{const e=new df(this.datastore),t=this.Xa(e);t&&t.then((t=>{this.asyncQueue.enqueueAndForget((()=>e.commit().then((()=>{this.deferred.resolve(t)})).catch((e=>{this.eu(e)}))))})).catch((e=>{this.eu(e)}))}))}Xa(e){try{const t=this.updateFunction(e);return!Oi(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}eu(e){this.Ja>0&&this.tu(e)?(this.Ja-=1,this.asyncQueue.enqueueAndForget((()=>(this.Za(),Promise.resolve())))):this.deferred.reject(e)}tu(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!Xa(t)}return!1}}class pf{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=Nr.UNAUTHENTICATED,this.clientId=$r.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{xr("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(xr("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new qr(Br.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new jr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=rd(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function gf(e,t){e.asyncQueue.verifyOperationInProgress(),xr("FirestoreClient","Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await zl(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function mf(e,t){e.asyncQueue.verifyOperationInProgress();const n=await vf(e);xr("FirestoreClient","Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener((e=>$h(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>$h(t.remoteStore,n))),e._onlineComponents=t}function yf(e){return"FirebaseError"===e.name?e.code===Br.FAILED_PRECONDITION||e.code===Br.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}async function vf(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){xr("FirestoreClient","Using user provided OfflineComponentProvider");try{await gf(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!yf(n))throw n;Lr("Error using user provided cache. Falling back to memory cache: "+n),await gf(e,new sf)}}else xr("FirestoreClient","Using default OfflineComponentProvider"),await gf(e,new sf);return e._offlineComponents}async function wf(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(xr("FirestoreClient","Using user provided OnlineComponentProvider"),await mf(e,e._uninitializedComponentsProvider._online)):(xr("FirestoreClient","Using default OnlineComponentProvider"),await mf(e,new cf))),e._onlineComponents}function _f(e){return vf(e).then((e=>e.persistence))}function If(e){return vf(e).then((e=>e.localStore))}function bf(e){return wf(e).then((e=>e.remoteStore))}function Tf(e){return wf(e).then((e=>e.syncEngine))}function Ef(e){return wf(e).then((e=>e.datastore))}async function Sf(e){const t=await wf(e),n=t.eventManager;return n.onListen=Cd.bind(null,t.syncEngine),n.onUnlisten=Rd.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=kd.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=Pd.bind(null,t.syncEngine),n}function Af(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=new jr;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new lf({next:s=>{t.enqueueAndForget((()=>ld(e,o)));const a=s.docs.has(n);!a&&s.fromCache?i.reject(new qr(Br.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&r&&"server"===r.source?i.reject(new qr(Br.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),o=new md(Vo(n.path),s,{includeMetadataChanges:!0,ta:!0});return ud(e,o)}(await Sf(e),e.asyncQueue,t,n,r))),r.promise}function Cf(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=new jr;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new lf({next:n=>{t.enqueueAndForget((()=>ld(e,o))),n.fromCache&&"server"===r.source?i.reject(new qr(Br.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new md(n,s,{includeMetadataChanges:!0,ta:!0});return ud(e,o)}(await Sf(e),e.asyncQueue,t,n,r))),r.promise}function kf(e,t,n,r){const i=function(e,t){let n;return n="string"==typeof e?ec().encode(e):e,function(e,t){return new hf(e,t)}(function(e,t){if(e instanceof Uint8Array)return uf(e,t);if(e instanceof ArrayBuffer)return uf(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),t)}(n,_h(t));e.asyncQueue.enqueueAndForget((async()=>{!function(e,t,n){const r=Ur(e);(async function(e,t,n){try{const r=await t.getMetadata();if(await function(e,t){const n=Ur(e),r=Tc(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(e=>n.$r.getBundleMetadata(e,t.id))).then((e=>!!e&&e.createTime.compareTo(r)>=0))}(e.localStore,r))return await t.close(),n._completeWith(function(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(r)),Promise.resolve(new Set);n._updateProgress(_d(r));const i=new wd(r,e.localStore,t.serializer);let s=await t.Ba();for(;s;){const e=await i.sa(s);e&&n._updateProgress(e),s=await t.Ba()}const o=await i.complete();return await Gd(e,o.aa,void 0),await function(e,t){const n=Ur(e);return n.persistence.runTransaction("Save bundle","readwrite",(e=>n.$r.saveBundleMetadata(e,t)))}(e.localStore,r),n._completeWith(o.progress),Promise.resolve(o._a)}catch(e){return Lr("SyncEngine","Loading bundle failed with ".concat(e)),n._failWith(e),Promise.resolve(new Set)}})(r,t,n).then((e=>{r.sharedClientState.notifyBundleLoaded(e)}))}(await Tf(e),i,r)}))}function Nf(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const Df=new Map;function Rf(e,t,n){if(!n)throw new qr(Br.INVALID_ARGUMENT,"Function ".concat(e,"() cannot be called with an empty ").concat(t,"."))}function Pf(e,t,n,r){if(!0===t&&!0===r)throw new qr(Br.INVALID_ARGUMENT,"".concat(e," and ").concat(n," cannot be used together."))}function xf(e){if(!ci.isDocumentKey(e))throw new qr(Br.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(e," has ").concat(e.length,"."))}function Of(e){if(ci.isDocumentKey(e))throw new qr(Br.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but ".concat(e," has ").concat(e.length,"."))}function Lf(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e="".concat(e.substring(0,20),"...")),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?"a custom ".concat(t," object"):"an object"}}return"function"==typeof e?"a function":Fr()}function Mf(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new qr(Br.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Lf(e);throw new qr(Br.INVALID_ARGUMENT,"Expected type '".concat(t.name,"', but it was: ").concat(n))}}return e}function Ff(e,t){if(t<=0)throw new qr(Br.INVALID_ARGUMENT,"Function ".concat(e,"() requires a positive number, but it was: ").concat(t,"."))}class Vf{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new qr(Br.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new qr(Br.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Pf("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Nf(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new qr(Br.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (must not be NaN)"));if(e.timeoutSeconds<5)throw new qr(Br.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (minimum allowed value is 5)"));if(e.timeoutSeconds>30)throw new qr(Br.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (maximum allowed value is 30)"))}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Uf{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Vf({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new qr(Br.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new qr(Br.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Vf(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Kr;switch(e.type){case"firstParty":return new Qr(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new qr(Br.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Df.get(e);t&&(xr("ComponentProvider","Removing Datastore"),Df.delete(e),t.terminate())}(this),Promise.resolve()}}function Bf(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};var i;const s=(e=Mf(e,Uf))._getSettings(),o="".concat(t,":").concat(n);if("firestore.googleapis.com"!==s.host&&s.host!==o&&Lr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=Nr.MOCK_USER;else{t=(0,c.Fy)(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new qr(Br.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Nr(s)}e._authCredentials=new Gr(new zr(t,n))}}class qf{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new qf(this.firestore,e,this._query)}}class jf{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new zf(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new jf(this.firestore,e,this._key)}}class zf extends qf{constructor(e,t,n){super(e,t,Vo(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new jf(this.firestore,null,new ci(e))}withConverter(e){return new zf(this.firestore,e,this._path)}}function Kf(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=(0,c.Ku)(e),Rf("collection","path",t),e instanceof Uf){const n=si.fromString(t,...r);return Of(n),new zf(e,null,n)}{if(!(e instanceof jf||e instanceof zf))throw new qr(Br.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(si.fromString(t,...r));return Of(n),new zf(e.firestore,null,n)}}function Gf(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=(0,c.Ku)(e),1===arguments.length&&(t=$r.newId()),Rf("doc","path",t),e instanceof Uf){const n=si.fromString(t,...r);return xf(n),new jf(e,null,new ci(n))}{if(!(e instanceof jf||e instanceof zf))throw new qr(Br.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(si.fromString(t,...r));return xf(n),new jf(e.firestore,e instanceof zf?e.converter:null,new ci(n))}}function Wf(e,t){return e=(0,c.Ku)(e),t=(0,c.Ku)(t),(e instanceof jf||e instanceof zf)&&(t instanceof jf||t instanceof zf)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function Hf(e,t){return e=(0,c.Ku)(e),t=(0,c.Ku)(t),e instanceof qf&&t instanceof qf&&e.firestore===t.firestore&&Wo(e._query,t._query)&&e.converter===t.converter}class Qf{constructor(){this.nu=Promise.resolve(),this.ru=[],this.iu=!1,this.su=[],this.ou=null,this._u=!1,this.au=!1,this.uu=[],this.jo=new Ih(this,"async_queue_retry"),this.cu=()=>{const e=wh();e&&xr("AsyncQueue","Visibility state changed to "+e.visibilityState),this.jo.Ko()};const e=wh();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.cu)}get isShuttingDown(){return this.iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.lu(),this.hu(e)}enterRestrictedMode(e){if(!this.iu){this.iu=!0,this.au=e||!1;const t=wh();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.cu)}}enqueue(e){if(this.lu(),this.iu)return new Promise((()=>{}));const t=new jr;return this.hu((()=>this.iu&&this.au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.ru.push(e),this.Pu())))}async Pu(){if(0!==this.ru.length){try{await this.ru[0](),this.ru.shift(),this.jo.reset()}catch(e){if(!Ai(e))throw e;xr("AsyncQueue","Operation failed with retryable error: "+e)}this.ru.length>0&&this.jo.qo((()=>this.Pu()))}}hu(e){const t=this.nu.then((()=>(this._u=!0,e().catch((e=>{this.ou=e,this._u=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw Or("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this._u=!1,e))))));return this.nu=t,t}enqueueAfterDelay(e,t,n){this.lu(),this.uu.indexOf(e)>-1&&(t=0);const r=nd.createAndSchedule(this,e,t,n,(e=>this.Iu(e)));return this.su.push(r),r}lu(){this.ou&&Fr()}verifyOperationInProgress(){}async Tu(){let e;do{e=this.nu,await e}while(e!==this.nu)}Eu(e){for(const t of this.su)if(t.timerId===e)return!0;return!1}du(e){return this.Tu().then((()=>{this.su.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.su)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tu()}))}Au(e){this.uu.push(e)}Iu(e){const t=this.su.indexOf(e);this.su.splice(t,1)}}function Yf(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const r of t)if(r in n&&"function"==typeof n[r])return!0;return!1}(e,["next","error","complete"])}class Jf{constructor(){this._progressObserver={},this._taskCompletionResolver=new jr,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class Xf extends Uf{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new Qf,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Zf(this),this._firestoreClient.terminate()}}function $f(e){return e._firestoreClient||Zf(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function Zf(e){var t,n,r;const i=e._freezeSettings(),s=function(e,t,n,r){return new Rs(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,Nf(r.experimentalLongPollingOptions),r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._firestoreClient=new pf(e._authCredentials,e._appCheckCredentials,e._queue,s),(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function ep(e,t,n){const r=new jr;return e.asyncQueue.enqueue((async()=>{try{await gf(e,n),await mf(e,t),r.resolve()}catch(e){const n=e;if(!yf(n))throw n;Lr("Error enabling indexeddb cache. Falling back to memory cache: "+n),r.reject(n)}})).then((()=>r.promise))}function tp(e){return function(e){const t=new jr;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t){const n=Ur(e);Mh(n.remoteStore)||xr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(e){const t=Ur(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e)))}(n.localStore);if(-1===e)return void t.resolve();const r=n.Ma.get(e)||[];r.push(t),n.Ma.set(e,r)}catch(e){const n=rd(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await Tf(e),t))),t.promise}($f(e=Mf(e,Xf)))}function np(e){return function(e){return e.asyncQueue.enqueue((async()=>{const t=await _f(e),n=await bf(e);return t.setNetworkEnabled(!0),function(e){const t=Ur(e);return t.v_.delete(0),kh(t)}(n)}))}($f(e=Mf(e,Xf)))}function rp(e){return function(e){return e.asyncQueue.enqueue((async()=>{const t=await _f(e),n=await bf(e);return t.setNetworkEnabled(!1),async function(e){const t=Ur(e);t.v_.add(0),await Nh(t),t.x_.set("Offline")}(n)}))}($f(e=Mf(e,Xf)))}function ip(e,t){return function(e,t){return e.asyncQueue.enqueue((async()=>function(e,t){const n=Ur(e);return n.persistence.runTransaction("Get named query","readonly",(e=>n.$r.getNamedQuery(e,t)))}(await If(e),t)))}($f(e=Mf(e,Xf)),t).then((t=>t?new qf(e,null,t.query):null))}function sp(e){if(e._initialized||e._terminated)throw new qr(Br.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class op{constructor(e){this._byteString=e}static fromBase64String(e){try{return new op(Ts.fromBase64String(e))}catch(e){throw new qr(Br.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new op(Ts.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class ap{constructor(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(let r=0;r<t.length;++r)if(0===t[r].length)throw new qr(Br.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ai(t)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class cp{constructor(e){this._methodName=e}}class up{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new qr(Br.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new qr(Br.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Zr(this._lat,e._lat)||Zr(this._long,e._long)}}const lp=/^__.*__$/;class hp{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Ua(e,this.data,this.fieldMask,t,this.fieldTransforms):new Va(e,this.data,t,this.fieldTransforms)}}class dp{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Ua(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function fp(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Fr()}}class pp{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Ru(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Vu(){return this.settings.Vu}mu(e){return new pp(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}fu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.mu({path:n,gu:!1});return r.pu(e),r}yu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.mu({path:n,gu:!1});return r.Ru(),r}wu(e){return this.mu({path:void 0,gu:!0})}Su(e){return Op(e,this.settings.methodName,this.settings.bu||!1,this.path,this.settings.Du)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}Ru(){if(this.path)for(let e=0;e<this.path.length;e++)this.pu(this.path.get(e))}pu(e){if(0===e.length)throw this.Su("Document fields must not be empty");if(fp(this.Vu)&&lp.test(e))throw this.Su('Document fields cannot begin and end with "__"')}}class gp{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||_h(e)}Cu(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new pp({Vu:e,methodName:t,Du:n,path:ai.emptyPath(),gu:!1,bu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function mp(e){const t=e._freezeSettings(),n=_h(e._databaseId);return new gp(e._databaseId,!!t.ignoreUndefinedProperties,n)}function yp(e,t,n,r,i){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const o=e.Cu(s.merge||s.mergeFields?2:0,t,n,i);Dp("Data must be an object, but it was:",o,r);const a=kp(r,o);let c,u;if(s.merge)c=new Is(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=Rp(t,r,n);if(!o.contains(i))throw new qr(Br.INVALID_ARGUMENT,"Field '".concat(i,"' is specified in your field mask but missing from your input data."));Lp(e,i)||e.push(i)}c=new Is(e),u=o.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,u=o.fieldTransforms;return new hp(new eo(a),c,u)}class vp extends cp{_toFieldTransform(e){if(2!==e.Vu)throw 1===e.Vu?e.Su("".concat(this._methodName,"() can only appear at the top level of your update data")):e.Su("".concat(this._methodName,"() cannot be used with set() unless you pass {merge:true}"));return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof vp}}function wp(e,t,n){return new pp({Vu:3,Du:t.settings.Du,methodName:e._methodName,gu:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class _p extends cp{_toFieldTransform(e){return new ka(e.path,new _a)}isEqual(e){return e instanceof _p}}class Ip extends cp{constructor(e,t){super(e),this.vu=t}_toFieldTransform(e){const t=wp(this,e,!0),n=this.vu.map((e=>Cp(e,t))),r=new Ia(n);return new ka(e.path,r)}isEqual(e){return e instanceof Ip&&(0,c.bD)(this.vu,e.vu)}}class bp extends cp{constructor(e,t){super(e),this.vu=t}_toFieldTransform(e){const t=wp(this,e,!0),n=this.vu.map((e=>Cp(e,t))),r=new Ta(n);return new ka(e.path,r)}isEqual(e){return e instanceof bp&&(0,c.bD)(this.vu,e.vu)}}class Tp extends cp{constructor(e,t){super(e),this.Fu=t}_toFieldTransform(e){const t=new Sa(e.serializer,ga(e.serializer,this.Fu));return new ka(e.path,t)}isEqual(e){return e instanceof Tp&&this.Fu===e.Fu}}function Ep(e,t,n,r){const i=e.Cu(1,t,n);Dp("Data must be an object, but it was:",i,r);const s=[],o=eo.empty();fs(r,((e,r)=>{const a=xp(t,e,n);r=(0,c.Ku)(r);const u=i.yu(a);if(r instanceof vp)s.push(a);else{const e=Cp(r,u);null!=e&&(s.push(a),o.set(a,e))}}));const a=new Is(s);return new dp(o,a,i.fieldTransforms)}function Sp(e,t,n,r,i,s){const o=e.Cu(1,t,n),a=[Rp(t,r,n)],u=[i];if(s.length%2!=0)throw new qr(Br.INVALID_ARGUMENT,"Function ".concat(t,"() needs to be called with an even number of arguments that alternate between field names and values."));for(let c=0;c<s.length;c+=2)a.push(Rp(t,s[c])),u.push(s[c+1]);const l=[],h=eo.empty();for(let f=a.length-1;f>=0;--f)if(!Lp(l,a[f])){const e=a[f];let t=u[f];t=(0,c.Ku)(t);const n=o.yu(e);if(t instanceof vp)l.push(e);else{const r=Cp(t,n);null!=r&&(l.push(e),h.set(e,r))}}const d=new Is(l);return new dp(h,d,o.fieldTransforms)}function Ap(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return Cp(n,e.Cu(r?4:3,t))}function Cp(e,t){if(Np(e=(0,c.Ku)(e)))return Dp("Unsupported field value:",t,e),kp(e,t);if(e instanceof cp)return function(e,t){if(!fp(t.Vu))throw t.Su("".concat(e._methodName,"() can only be used with update() and set()"));if(!t.path)throw t.Su("".concat(e._methodName,"() is not currently supported inside arrays"));const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.gu&&4!==t.Vu)throw t.Su("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=Cp(i,t.wu(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=(0,c.Ku)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return ga(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=ni.fromDate(e);return{timestampValue:_c(t.serializer,n)}}if(e instanceof ni){const n=new ni(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:_c(t.serializer,n)}}if(e instanceof up)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof op)return{bytesValue:Ic(t.serializer,e._byteString)};if(e instanceof jf){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Su("Document reference is for database ".concat(r.projectId,"/").concat(r.database," but should be for database ").concat(n.projectId,"/").concat(n.database));return{referenceValue:Ec(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.Su("Unsupported field value: ".concat(Lf(e)))}(e,t)}function kp(e,t){const n={};return ps(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):fs(e,((e,r)=>{const i=Cp(r,t.fu(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function Np(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof ni||e instanceof up||e instanceof op||e instanceof jf||e instanceof cp)}function Dp(e,t,n){if(!Np(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=Lf(n);throw"an object"===r?t.Su(e+" a custom object"):t.Su(e+" "+r)}}function Rp(e,t,n){if((t=(0,c.Ku)(t))instanceof ap)return t._internalPath;if("string"==typeof t)return xp(e,t);throw Op("Field path arguments must be of type string or ",e,!1,void 0,n)}const Pp=new RegExp("[~\\*/\\[\\]]");function xp(e,t,n){if(t.search(Pp)>=0)throw Op("Invalid field path (".concat(t,"). Paths must not contain '~', '*', '/', '[', or ']'"),e,!1,void 0,n);try{return new ap(...t.split("."))._internalPath}catch(I){throw Op("Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),e,!1,void 0,n)}}function Op(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a="Function ".concat(t,"() called with invalid data");n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=" in field ".concat(r)),o&&(c+=" in document ".concat(i)),c+=")"),new qr(Br.INVALID_ARGUMENT,a+e+c)}function Lp(e,t){return e.some((e=>e.isEqual(t)))}class Mp{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new jf(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Fp(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Vp("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Fp extends Mp{data(){return super.data()}}function Vp(e,t){return"string"==typeof t?xp(e,t):t instanceof ap?t._internalPath:t._delegate._internalPath}function Up(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new qr(Br.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Bp{}class qp extends Bp{}function jp(e,t){let n=[];for(var r=arguments.length,i=new Array(r>2?r-2:0),s=2;s<r;s++)i[s-2]=arguments[s];t instanceof Bp&&n.push(t),n=n.concat(i),function(e){const t=e.filter((e=>e instanceof Kp)).length,n=e.filter((e=>e instanceof zp)).length;if(t>1||t>0&&n>0)throw new qr(Br.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const o of n)e=o._apply(e);return e}class zp extends qp{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new zp(e,t,n)}_apply(e){const t=this._parse(e);return $p(e._query,t),new qf(e.firestore,e.converter,Ko(e._query,t))}_parse(e){const t=mp(e.firestore),n=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new qr(Br.INVALID_ARGUMENT,"Invalid Query. You can't perform '".concat(s,"' queries on documentId()."));if("in"===s||"not-in"===s){Xp(o,s);const t=[];for(const n of o)t.push(Jp(r,e,n));a={arrayValue:{values:t}}}else a=Jp(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||Xp(o,s),a=Ap(n,t,o,"in"===s||"not-in"===s);return uo.create(i,s,a)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value);return n}}class Kp extends Bp{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Kp(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:lo.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const i of r)$p(n,i),n=Ko(n,i)}(e._query,t),new qf(e.firestore,e.converter,Ko(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Gp extends qp{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Gp(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new qr(Br.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new qr(Br.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new oo(t,n)}(e._query,this._field,this._direction);return new qf(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new Mo(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}class Wp extends qp{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new Wp(e,t,n)}_apply(e){return new qf(e.firestore,e.converter,Go(e._query,this._limit,this._limitType))}}class Hp extends qp{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new Hp(e,t,n)}_apply(e){const t=Yp(e,this.type,this._docOrFields,this._inclusive);return new qf(e.firestore,e.converter,function(e,t){return new Mo(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}class Qp extends qp{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new Qp(e,t,n)}_apply(e){const t=Yp(e,this.type,this._docOrFields,this._inclusive);return new qf(e.firestore,e.converter,function(e,t){return new Mo(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}function Yp(e,t,n,r){if(n[0]=(0,c.Ku)(n[0]),n[0]instanceof Mp)return function(e,t,n,r,i){if(!r)throw new qr(Br.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for ".concat(n,"()."));const s=[];for(const o of qo(e))if(o.field.isKeyField())s.push(js(t,r.key));else{const e=r.data.field(o.field);if(ks(e))throw new qr(Br.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=o.field.canonicalString();throw new qr(Br.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '".concat(e,"' (used as the orderBy) does not exist."))}s.push(e)}return new ro(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{const i=mp(e.firestore);return function(e,t,n,r,i,s){const o=e.explicitOrderBy;if(i.length>o.length)throw new qr(Br.INVALID_ARGUMENT,"Too many arguments provided to ".concat(r,"(). The number of arguments must be less than or equal to the number of orderBy() clauses"));const a=[];for(let c=0;c<i.length;c++){const s=i[c];if(o[c].field.isKeyField()){if("string"!=typeof s)throw new qr(Br.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in ".concat(r,"(), but got a ").concat(typeof s));if(!Bo(e)&&-1!==s.indexOf("/"))throw new qr(Br.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by documentId(), the value passed to ".concat(r,"() must be a plain document ID, but '").concat(s,"' contains a slash."));const n=e.path.child(si.fromString(s));if(!ci.isDocumentKey(n))throw new qr(Br.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by documentId(), the value passed to ".concat(r,"() must result in a valid document path, but '").concat(n,"' is not because it contains an odd number of segments."));const i=new ci(n);a.push(js(t,i))}else{const e=Ap(n,r,s);a.push(e)}}return new ro(a,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}function Jp(e,t,n){if("string"==typeof(n=(0,c.Ku)(n))){if(""===n)throw new qr(Br.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Bo(t)&&-1!==n.indexOf("/"))throw new qr(Br.INVALID_ARGUMENT,"Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '".concat(n,"' contains a '/' character."));const r=t.path.child(si.fromString(n));if(!ci.isDocumentKey(r))throw new qr(Br.INVALID_ARGUMENT,"Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '".concat(r,"' is not because it has an odd number of segments (").concat(r.length,")."));return js(e,new ci(r))}if(n instanceof jf)return js(e,n._key);throw new qr(Br.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ".concat(Lf(n),"."))}function Xp(e,t){if(!Array.isArray(e)||0===e.length)throw new qr(Br.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '".concat(t.toString(),"' filters."))}function $p(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new qr(Br.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '".concat(t.op.toString(),"' filter.")):new qr(Br.INVALID_ARGUMENT,"Invalid query. You cannot use '".concat(t.op.toString(),"' filters with '").concat(n.toString(),"' filters."))}class Zp{convertValue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(Ls(e)){case 0:return null;case 1:return e.booleanValue;case 2:return As(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Cs(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Fr()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";const n={};return fs(e,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertGeoPoint(e){return new up(As(e.latitude),As(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Ns(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Ds(e));default:return null}}convertTimestamp(e){const t=Ss(e);return new ni(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=si.fromString(e);Vr(Qc(n));const r=new Ps(n.get(1),n.get(3)),i=new ci(n.popFirst(5));return r.isEqual(t)||Or("Document ".concat(i," contains a document reference within a different database (").concat(r.projectId,"/").concat(r.database,") which is not supported. It will be treated as a reference in the current database (").concat(t.projectId,"/").concat(t.database,") instead.")),i}}function eg(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class tg extends Zp{constructor(e){super(),this.firestore=e}convertBytes(e){return new op(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new jf(this.firestore,null,t)}}class ng{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class rg extends Mp{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){const t=new ig(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){const n=this._document.data.field(Vp("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class ig extends rg{data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return super.data(e)}}class sg{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new ng(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new ig(this._firestore,this._userDataWriter,n.key,n,new ng(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(){const e=!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new qr(Br.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const r=new ig(e._firestore,e._userDataWriter,n.doc.key,n.doc,new ng(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const r=new ig(e._firestore,e._userDataWriter,t.doc.key,t.doc,new ng(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:og(t.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function og(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Fr()}}function ag(e,t){return e instanceof rg&&t instanceof rg?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof sg&&t instanceof sg&&e._firestore===t._firestore&&Hf(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}class cg extends Zp{constructor(e){super(),this.firestore=e}convertBytes(e){return new op(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new jf(this.firestore,null,t)}}function ug(e){e=Mf(e,jf);const t=Mf(e.firestore,Xf),n=$f(t),r=new cg(t);return function(e,t){const n=new jr;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const r=await function(e,t){const n=Ur(e);return n.persistence.runTransaction("read document","readonly",(e=>n.localDocuments.getDocument(e,t)))}(e,t);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new qr(Br.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){const r=rd(e,"Failed to get document '".concat(t," from cache"));n.reject(r)}}(await If(e),t,n))),n.promise}(n,e._key).then((n=>new rg(t,r,e._key,n,new ng(null!==n&&n.hasLocalMutations,!0),e.converter)))}function lg(e){e=Mf(e,qf);const t=Mf(e.firestore,Xf),n=$f(t),r=new cg(t);return function(e,t){const n=new jr;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const r=await Yl(e,t,!0),i=new Td(t,r.hs),s=i.Ta(r.documents),o=i.applyChanges(s,!1);n.resolve(o.snapshot)}catch(e){const r=rd(e,"Failed to execute query '".concat(t," against cache"));n.reject(r)}}(await If(e),t,n))),n.promise}(n,e._query).then((n=>new sg(t,r,e,n)))}function hg(e,t,n){e=Mf(e,jf);const r=Mf(e.firestore,Xf),i=eg(e.converter,t,n);return gg(r,[yp(mp(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Da.none())])}function dg(e,t,n){e=Mf(e,jf);const r=Mf(e.firestore,Xf),i=mp(r);let s;for(var o=arguments.length,a=new Array(o>3?o-3:0),u=3;u<o;u++)a[u-3]=arguments[u];return s="string"==typeof(t=(0,c.Ku)(t))||t instanceof ap?Sp(i,"updateDoc",e._key,t,n,a):Ep(i,"updateDoc",e._key,t),gg(r,[s.toMutation(e._key,Da.exists(!0))])}function fg(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i,s,o;e=(0,c.Ku)(e);let a={includeMetadataChanges:!1,source:"default"},u=0;"object"!=typeof n[u]||Yf(n[u])||(a=n[u],u++);const l={includeMetadataChanges:a.includeMetadataChanges,source:a.source};if(Yf(n[u])){const e=n[u];n[u]=null===(i=e.next)||void 0===i?void 0:i.bind(e),n[u+1]=null===(s=e.error)||void 0===s?void 0:s.bind(e),n[u+2]=null===(o=e.complete)||void 0===o?void 0:o.bind(e)}let h,d,f;if(e instanceof jf)d=Mf(e.firestore,Xf),f=Vo(e._key.path),h={next:t=>{n[u]&&n[u](mg(d,e,t))},error:n[u+1],complete:n[u+2]};else{const t=Mf(e,qf);d=Mf(t.firestore,Xf),f=t._query;const r=new cg(d);h={next:e=>{n[u]&&n[u](new sg(d,r,t,e))},error:n[u+1],complete:n[u+2]},Up(e._query)}return function(e,t,n,r){const i=new lf(r),s=new md(t,i,n);return e.asyncQueue.enqueueAndForget((async()=>ud(await Sf(e),s))),()=>{i.Qa(),e.asyncQueue.enqueueAndForget((async()=>ld(await Sf(e),s)))}}($f(d),f,l,h)}function pg(e,t){return function(e,t){const n=new lf(t);return e.asyncQueue.enqueueAndForget((async()=>function(e,t){Ur(e).W_.add(t),t.next()}(await Sf(e),n))),()=>{n.Qa(),e.asyncQueue.enqueueAndForget((async()=>function(e,t){Ur(e).W_.delete(t)}(await Sf(e),n)))}}($f(e=Mf(e,Xf)),Yf(t)?t:{next:t})}function gg(e,t){return function(e,t){const n=new jr;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const r=rf(e);try{const e=await function(e,t){const n=Ur(e),r=ni.now(),i=t.reduce(((e,t)=>e.add(t.key)),la());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let a=ta(),c=la();return n.os.getEntries(e,i).next((e=>{a=e,a.forEach(((e,t)=>{t.isValidDocument()||(c=c.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,a))).next((i=>{s=i;const o=[];for(const e of t){const t=Ma(e,s.get(e.key).overlayedDocument);null!=t&&o.push(new Ua(e.key,t,to(t.value.mapValue),Da.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)})).next((t=>{o=t;const r=t.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:ia(s)})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Fa[e.currentUser.toKey()];r||(r=new gs(Zr)),r=r.insert(t,n),e.Fa[e.currentUser.toKey()]=r}(r,e.batchId,n),await Gd(r,e.changes),await zh(r.remoteStore)}catch(e){const t=rd(e,"Failed to persist write");n.reject(t)}}(await Tf(e),t,n))),n.promise}($f(e),t)}function mg(e,t,n){const r=n.docs.get(t._key),i=new cg(e);return new rg(e,i,t._key,r,new ng(n.hasPendingWrites,n.fromCache),t.converter)}const yg={maxAttempts:5};class vg{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=mp(e)}set(e,t,n){this._verifyNotCommitted();const r=wg(e,this._firestore),i=eg(r.converter,t,n),s=yp(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,Da.none())),this}update(e,t,n){this._verifyNotCommitted();const r=wg(e,this._firestore);let i;for(var s=arguments.length,o=new Array(s>3?s-3:0),a=3;a<s;a++)o[a-3]=arguments[a];return i="string"==typeof(t=(0,c.Ku)(t))||t instanceof ap?Sp(this._dataReader,"WriteBatch.update",r._key,t,n,o):Ep(this._dataReader,"WriteBatch.update",r._key,t),this._mutations.push(i.toMutation(r._key,Da.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=wg(e,this._firestore);return this._mutations=this._mutations.concat(new za(t._key,Da.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new qr(Br.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function wg(e,t){if((e=(0,c.Ku)(e)).firestore!==t)throw new qr(Br.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class _g extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=mp(e)}get(e){const t=wg(e,this._firestore),n=new tg(this._firestore);return this._transaction.lookup([t._key]).then((e=>{if(!e||1!==e.length)return Fr();const r=e[0];if(r.isFoundDocument())return new Mp(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new Mp(this._firestore,n,t._key,null,t.converter);throw Fr()}))}set(e,t,n){const r=wg(e,this._firestore),i=eg(r.converter,t,n),s=yp(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n){const r=wg(e,this._firestore);let i;for(var s=arguments.length,o=new Array(s>3?s-3:0),a=3;a<s;a++)o[a-3]=arguments[a];return i="string"==typeof(t=(0,c.Ku)(t))||t instanceof ap?Sp(this._dataReader,"Transaction.update",r._key,t,n,o):Ep(this._dataReader,"Transaction.update",r._key,t),this._transaction.update(r._key,i),this}delete(e){const t=wg(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=wg(e,this._firestore),n=new cg(this._firestore);return super.get(e).then((e=>new rg(this._firestore,n,t._key,e._document,new ng(!1,!1),t.converter)))}}new WeakMap;!function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(e){Dr=e}(s.SDK_VERSION),(0,s._registerComponent)(new o.uA("firestore",((e,n)=>{let{instanceIdentifier:r,options:i}=n;const s=e.getProvider("app").getImmediate(),o=new Xf(new Wr(e.getProvider("auth-internal")),new Jr(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new qr(Br.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ps(e.options.projectId,t)}(s,r),s);return i=Object.assign({useFetchStreams:t},i),o._setSettings(i),o}),"PUBLIC").setMultipleInstances(!0)),(0,s.registerVersion)(kr,"4.5.1",e),(0,s.registerVersion)(kr,"4.5.1","esm2017")}();function Ig(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new qr("invalid-argument","Invalid options passed to function ".concat(e,"(): You cannot ")+'specify both "merge" and "mergeFields".');return t}function bg(){if("undefined"===typeof Uint8Array)throw new qr("unimplemented","Uint8Arrays are not available in this environment.")}function Tg(){if("undefined"==typeof atob)throw new qr("unimplemented","Blobs are unavailable in Firestore in this environment.")}class Eg{constructor(e){this._delegate=e}static fromBase64String(e){return Tg(),new Eg(op.fromBase64String(e))}static fromUint8Array(e){return bg(),new Eg(op.fromUint8Array(e))}toBase64(){return Tg(),this._delegate.toBase64()}toUint8Array(){return bg(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Sg(e){return function(e,t){if("object"!==typeof e||null===e)return!1;const n=e;for(const r of t)if(r in n&&"function"===typeof n[r])return!0;return!1}(e,["next","error","complete"])}class Ag{enableIndexedDbPersistence(e,t){return function(e,t){sp(e=Mf(e,Xf));const n=$f(e);if(n._uninitializedComponentsProvider)throw new qr(Br.FAILED_PRECONDITION,"SDK cache is already specified.");Lr("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const r=e._freezeSettings(),i=new cf;return ep(n,i,new of(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function(e){sp(e=Mf(e,Xf));const t=$f(e);if(t._uninitializedComponentsProvider)throw new qr(Br.FAILED_PRECONDITION,"SDK cache is already specified.");Lr("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=e._freezeSettings(),r=new cf;return ep(t,r,new af(r,n.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function(e){if(e._initialized&&!e._terminated)throw new qr(Br.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new jr;return e._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await async function(e){if(!Ti.D())return Promise.resolve();const t=e+"main";await Ti.delete(t)}(Fl(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}(e._delegate)}}class Cg{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof Ps||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();e.merge||t.host===e.host||Lr("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Bf(this._delegate,e,t,n)}enableNetwork(){return np(this._delegate)}disableNetwork(){return rp(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,Pf("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return tp(this._delegate)}onSnapshotsInSync(e){return pg(this._delegate,e)}get app(){if(!this._appCompat)throw new qr("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new qg(this,Kf(this._delegate,e))}catch(t){throw xg(t,"collection()","Firestore.collection()")}}doc(e){try{return new Pg(this,Gf(this._delegate,e))}catch(t){throw xg(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Vg(this,function(e,t){if(e=Mf(e,Uf),Rf("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new qr(Br.INVALID_ARGUMENT,"Invalid collection ID '".concat(t,"' passed to function collectionGroup(). Collection IDs must not contain '/'."));return new qf(e,null,function(e){return new Mo(si.emptyPath(),e)}(t))}(this._delegate,e))}catch(t){throw xg(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function(e,t,n){e=Mf(e,Xf);const r=Object.assign(Object.assign({},yg),n);return function(e){if(e.maxAttempts<1)throw new qr(Br.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(e,t,n){const r=new jr;return e.asyncQueue.enqueueAndForget((async()=>{const i=await Ef(e);new ff(e.asyncQueue,i,n,t,r).Ya()})),r.promise}($f(e),(n=>t(new _g(e,n))),r)}(this._delegate,(t=>e(new Ng(this,t))))}batch(){return $f(this._delegate),new Dg(new vg(this._delegate,(e=>gg(this._delegate,e))))}loadBundle(e){return function(e,t){const n=$f(e=Mf(e,Xf)),r=new Jf;return kf(n,e._databaseId,t,r),r}(this._delegate,e)}namedQuery(e){return ip(this._delegate,e).then((e=>e?new Vg(this,e):null))}}class kg extends Zp{constructor(e){super(),this.firestore=e}convertBytes(e){return new Eg(new op(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return Pg.forKey(t,this.firestore,null)}}class Ng{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new kg(e)}get(e){const t=jg(e);return this._delegate.get(t).then((e=>new Mg(this._firestore,new rg(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter))))}set(e,t,n){const r=jg(e);return n?(Ig("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n){for(var r=arguments.length,i=new Array(r>3?r-3:0),s=3;s<r;s++)i[s-3]=arguments[s];const o=jg(e);return 2===arguments.length?this._delegate.update(o,t):this._delegate.update(o,t,n,...i),this}delete(e){const t=jg(e);return this._delegate.delete(t),this}}class Dg{constructor(e){this._delegate=e}set(e,t,n){const r=jg(e);return n?(Ig("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n){for(var r=arguments.length,i=new Array(r>3?r-3:0),s=3;s<r;s++)i[s-3]=arguments[s];const o=jg(e);return 2===arguments.length?this._delegate.update(o,t):this._delegate.update(o,t,n,...i),this}delete(e){const t=jg(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class Rg{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){const n=new ig(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Fg(this._firestore,n),null!==t&&void 0!==t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=Rg.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let i=r.get(t);return i||(i=new Rg(e,new kg(e),t),r.set(t,i)),i}}Rg.INSTANCES=new WeakMap;class Pg{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new kg(e)}static forPath(e,t,n){if(e.length%2!==0)throw new qr("invalid-argument","Invalid document reference. Document references must have an even number of segments, but "+"".concat(e.canonicalString()," has ").concat(e.length));return new Pg(t,new jf(t._delegate,n,new ci(e)))}static forKey(e,t,n){return new Pg(t,new jf(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new qg(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new qg(this.firestore,Kf(this._delegate,e))}catch(t){throw xg(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,c.Ku)(e))instanceof jf&&Wf(this._delegate,e)}set(e,t){t=Ig("DocumentReference.set",t);try{return t?hg(this._delegate,e,t):hg(this._delegate,e)}catch(n){throw xg(n,"setDoc()","DocumentReference.set()")}}update(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];try{return 1===arguments.length?dg(this._delegate,e):dg(this._delegate,e,t,...r)}catch(s){throw xg(s,"updateDoc()","DocumentReference.update()")}}delete(){return gg(Mf((e=this._delegate).firestore,Xf),[new za(e._key,Da.none())]);var e}onSnapshot(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=Og(t),i=Lg(t,(e=>new Mg(this.firestore,new rg(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter))));return fg(this._delegate,r,i)}get(e){let t;return t="cache"===(null===e||void 0===e?void 0:e.source)?ug(this._delegate):"server"===(null===e||void 0===e?void 0:e.source)?function(e){e=Mf(e,jf);const t=Mf(e.firestore,Xf);return Af($f(t),e._key,{source:"server"}).then((n=>mg(t,e,n)))}(this._delegate):function(e){e=Mf(e,jf);const t=Mf(e.firestore,Xf);return Af($f(t),e._key).then((n=>mg(t,e,n)))}(this._delegate),t.then((e=>new Mg(this.firestore,new rg(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter))))}withConverter(e){return new Pg(this.firestore,e?this._delegate.withConverter(Rg.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function xg(e,t,n){return e.message=e.message.replace(t,n),e}function Og(e){for(const t of e)if("object"===typeof t&&!Sg(t))return t;return{}}function Lg(e,t){var n,r;let i;return i=Sg(e[0])?e[0]:Sg(e[1])?e[1]:"function"===typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{i.next&&i.next(t(e))},error:null===(n=i.error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}class Mg{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Pg(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return ag(this._delegate,e._delegate)}}class Fg extends Mg{data(e){const t=this._delegate.data(e);return this._delegate._converter||void 0!==t||Fr(),t}}class Vg{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new kg(e)}where(e,t,n){try{return new Vg(this.firestore,jp(this._delegate,function(e,t,n){const r=t,i=Vp("where",e);return zp._create(i,r,n)}(e,t,n)))}catch(r){throw xg(r,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new Vg(this.firestore,jp(this._delegate,function(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",n=Vp("orderBy",e);return Gp._create(n,t)}(e,t)))}catch(n){throw xg(n,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new Vg(this.firestore,jp(this._delegate,(Ff("limit",t=e),Wp._create("limit",t,"F"))))}catch(t){throw xg(t,"limit()","Query.limit()")}var t}limitToLast(e){try{return new Vg(this.firestore,jp(this._delegate,(Ff("limitToLast",t=e),Wp._create("limitToLast",t,"L"))))}catch(t){throw xg(t,"limitToLast()","Query.limitToLast()")}var t}startAt(){try{return new Vg(this.firestore,jp(this._delegate,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Hp._create("startAt",t,!0)}(...arguments)))}catch(e){throw xg(e,"startAt()","Query.startAt()")}}startAfter(){try{return new Vg(this.firestore,jp(this._delegate,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Hp._create("startAfter",t,!1)}(...arguments)))}catch(e){throw xg(e,"startAfter()","Query.startAfter()")}}endBefore(){try{return new Vg(this.firestore,jp(this._delegate,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Qp._create("endBefore",t,!1)}(...arguments)))}catch(e){throw xg(e,"endBefore()","Query.endBefore()")}}endAt(){try{return new Vg(this.firestore,jp(this._delegate,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Qp._create("endAt",t,!0)}(...arguments)))}catch(e){throw xg(e,"endAt()","Query.endAt()")}}isEqual(e){return Hf(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null===e||void 0===e?void 0:e.source)?lg(this._delegate):"server"===(null===e||void 0===e?void 0:e.source)?function(e){e=Mf(e,qf);const t=Mf(e.firestore,Xf),n=$f(t),r=new cg(t);return Cf(n,e._query,{source:"server"}).then((n=>new sg(t,r,e,n)))}(this._delegate):function(e){e=Mf(e,qf);const t=Mf(e.firestore,Xf),n=$f(t),r=new cg(t);return Up(e._query),Cf(n,e._query).then((n=>new sg(t,r,e,n)))}(this._delegate),t.then((e=>new Bg(this.firestore,new sg(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot))))}onSnapshot(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=Og(t),i=Lg(t,(e=>new Bg(this.firestore,new sg(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot))));return fg(this._delegate,r,i)}withConverter(e){return new Vg(this.firestore,e?this._delegate.withConverter(Rg.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class Ug{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Fg(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Bg{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Vg(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map((e=>new Fg(this._firestore,e)))}docChanges(e){return this._delegate.docChanges(e).map((e=>new Ug(this._firestore,e)))}forEach(e,t){this._delegate.forEach((n=>{e.call(t,new Fg(this._firestore,n))}))}isEqual(e){return ag(this._delegate,e._delegate)}}class qg extends Vg{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new Pg(this.firestore,e):null}doc(e){try{return new Pg(this.firestore,void 0===e?Gf(this._delegate):Gf(this._delegate,e))}catch(t){throw xg(t,"doc()","CollectionReference.doc()")}}add(e){return function(e,t){const n=Mf(e.firestore,Xf),r=Gf(e),i=eg(e.converter,t);return gg(n,[yp(mp(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,Da.exists(!1))]).then((()=>r))}(this._delegate,e).then((e=>new Pg(this.firestore,e)))}isEqual(e){return Wf(this._delegate,e._delegate)}withConverter(e){return new qg(this.firestore,e?this._delegate.withConverter(Rg.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function jg(e){return Mf(e,jf)}class zg{constructor(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._delegate=new ap(...t)}static documentId(){return new zg(ai.keyField().canonicalString())}isEqual(e){return(e=(0,c.Ku)(e))instanceof ap&&this._delegate._internalPath.isEqual(e._internalPath)}}class Kg{constructor(e){this._delegate=e}static serverTimestamp(){const e=new _p("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new Kg(e)}static delete(){const e=new vp("deleteField");return e._methodName="FieldValue.delete",new Kg(e)}static arrayUnion(){const e=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Ip("arrayUnion",t)}(...arguments);return e._methodName="FieldValue.arrayUnion",new Kg(e)}static arrayRemove(){const e=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new bp("arrayRemove",t)}(...arguments);return e._methodName="FieldValue.arrayRemove",new Kg(e)}static increment(e){const t=new Tp("increment",e);return t._methodName="FieldValue.increment",new Kg(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const Gg={Firestore:Cg,GeoPoint:up,Timestamp:ni,Blob:Eg,Transaction:Ng,WriteBatch:Dg,DocumentReference:Pg,DocumentSnapshot:Mg,Query:Vg,QueryDocumentSnapshot:Fg,QuerySnapshot:Bg,CollectionReference:qg,FieldPath:zg,FieldValue:Kg,setLogLevel:function(e){var t;t=e,Rr.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};!function(e){var t;t=(e,t)=>new Cg(e,t,new Ag),e.INTERNAL.registerComponent(new o.uA("firestore-compat",(e=>{const n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("firestore").getImmediate();return t(n,r)}),"PUBLIC").setServiceProps(Object.assign({},Gg))),e.registerVersion("@firebase/firestore-compat","0.3.28")}(i.A)}}]);
//# sourceMappingURL=692.368c4a27.chunk.js.map